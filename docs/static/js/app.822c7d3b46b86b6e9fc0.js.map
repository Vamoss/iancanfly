{"version":3,"sources":["webpack:///./static/js/Math.js","webpack:///./src/js/resources/Resource.js","webpack:///./src/js/ships/Ship.js","webpack:///./src/js/ships/Parachute.js","webpack:///./src/js/ships/Balloon.js","webpack:///./src/js/ships/Plane.js","webpack:///./src/js/ships/Spaceship.js","webpack:///./src/js/ships/Ovni.js","webpack:///./src/js/resources/Coin.js","webpack:///./src/js/particles/ParticleManager.js","webpack:///./src/app.js","webpack:///./src/js/main.js","webpack:///./static/js/GLTFLoader.js"],"names":["Math","clamp","value","min","max","map","x","a1","a2","b1","b2","Resource","modelUrl","scale","rotation","audioUrl","audioListener","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default","this","_this","__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default","__proto__","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default","call","model","sound","loadModel","loadAudio","t","GLTFLoader","load","gltf","scene","children","clone","set","lookAt","xhr","error","console","THREE","Audio","AudioLoader","buffer","setBuffer","setLoop","setVolume","require","Ship","velocity","audioPlay","classCallCheck_default","possibleConstructorReturn_default","get_prototype_of_default","center","setFromObject","getCenter","emit","play","Parachute","Balloon","PI","Ovni","Coin","ParticleManager","camera","_scene","_camera","prevCamX","position","prevCamY","y","prevCamZ","z","maxParticles","spread","particles","p","particle","random","vertices","push","pMaterial","color","size","loadTexture","blending","transparent","particleSystem","sortParticles","add","name","xDiff","yDiff","zDiff","i","geometry","length","verticesNeedUpdate","Main","userId","Date","getTime","localStorage","getItem","setItem","amplitude","Amplitude","currentLevel","mouseX","mouseY","prevMouseX","prevMouseY","diffX","diffY","audioList","url","maxX","maxY","velX","minAltitude","altitude","curAltitude","destPos","raycaster","far","direction","normalize","coins","coin","paused","levels","ship","skyColor","decay","Plane","Spaceship","window","innerWidth","innerHeight","_renderer","setPixelRatio","devicePixelRatio","setSize","document","body","appendChild","domElement","light","dirLight","material","emissive","ground","on","altimeterEl","getElementById","addEventListener","onMouseMove","bind","onMouseDown","onMouseUp","onKeyDown","onKeyUp","onWindowResize","initAccelerometer","animate","event","pageX","pageY","e","keyCode","aspect","updateProjectionMatrix","timestamp","innerHTML","round","nextLevel","progress","c","removeCoin","oldModelPos","dir","subVectors","distanceToSquared","onResourceCollide","update","lerp","background","fog","prevLevel","render","requestAnimationFrame","startLevel","level","log","track","copy","isPlaying","stop","resource","increase","index","indexOf","splice","remove","a","sort","b","currentAudio","counter","source","onended","accelerationIncludingGravity","eventType","eventProperties","data","event_type","user_id","event_properties","manager","undefined","DefaultLoadingManager","prototype","constructor","crossOrigin","onLoad","onProgress","onError","scope","path","LoaderUtils","extractUrlBase","loader","FileLoader","setResponseType","parse","setCrossOrigin","setPath","content","extensions","decodeText","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","headerView","DataView","BINARY_EXTENSION_HEADER_LENGTH","header","magic","slice","version","getUint32","Error","chunkView","chunkIndex","byteLength","chunkLength","chunkType","BINARY_EXTENSION_CHUNK_TYPES","JSON","contentArray","BIN","byteOffset","json","asset","extensionsUsed","KHR_LIGHTS","lights","lightId","lightNode","Color","fromArray","type","DirectionalLight","PointLight","SpotLight","AmbientLight","constantAttenuation","intensity","linearAttenuation","distance","quadraticAttenuation","fallOffAngle","angle","fallOffExponent","warn","KHR_MATERIALS_COMMON","GLTFMaterialsCommonExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","specularGlossinessParams","getMaterialType","ShaderMaterial","extendParams","params","parser","pbrSpecularGlossiness","shader","ShaderLib","uniforms","UniformsUtils","specularMapParsFragmentChunk","join","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","fragmentShader","replace","roughness","metalness","roughnessMap","metalnessMap","specular","setHex","glossiness","specularMap","glossinessMap","vertexShader","defines","STANDARD","opacity","pending","Array","isArray","diffuseFactor","array","diffuseTexture","assignTexture","glossinessFactor","specularFactor","specularGlossinessTexture","specGlossIndex","Promise","all","createMaterial","isGLTFSpecularGlossinessMaterial","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMap","envMapIntensity","refractionRatio","derivatives","cloneMaterial","target","il","refreshUniforms","renderer","group","uvScaleMap","offset","repeat","diffuse","multiplyScalar","isWebGLRenderTarget","texture","matrix","matrixAutoUpdate","setUvTransform","uvTransform","offsetRepeat","flipEnvMap","isCubeTexture","USE_GLOSSINESSMAP","USE_ROUGHNESSMAP","GLTFParser","scenes","cameras","animations","MeshPhongMaterial","MeshLambertMaterial","MeshBasicMaterial","materialParams","khrMaterial","keys","materialValues","forEach","v","specularTexture","shininessFactor","shininess","WEBGL_CONSTANTS","WEBGL_COMPONENT_TYPES","Number","Matrix3","Matrix4","Vector2","Vector3","Vector4","Texture","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","Float32Array","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipMapNearestFilter","9985","LinearMipMapNearestFilter","9986","NearestMipMapLinearFilter","9987","LinearMipMapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TEXTURE_FORMATS","6406","AlphaFormat","6407","RGBFormat","6408","RGBAFormat","6409","LuminanceFormat","6410","LuminanceAlphaFormat","WEBGL_TEXTURE_DATATYPES","UnsignedByteType","32819","UnsignedShort4444Type","32820","UnsignedShort5551Type","33635","UnsignedShort565Type","WEBGL_TYPE_SIZES","BackSide","FrontSide","NeverDepth","LessDepth","EqualDepth","LessEqualDepth","GreaterEqualDepth","NotEqualDepth","AlwaysDepth","AddEquation","SubtractEquation","ReverseSubtractEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","InterpolateSmooth","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","resolveURL","test","addMorphTargets","mesh","meshDef","primitiveDef","accessors","targets","morphAttributes","normal","morphTargets","positionAttribute","normalAttribute","attributeName","POSITION","attributes","j","jl","count","setXYZ","getX","getY","getZ","NORMAL","morphNormals","updateMorphTargets","morphTargetInfluences","isPrimitiveEqual","indices","attribA","attribB","keysA","Object","keysB","key","getCachedGeometry","cache","newPrimitive","cached","primitive","options","objects","get","object","removeAll","primitiveCache","textureLoader","TextureLoader","fileLoader","markDefs","getMultiDependencies","then","dependencies","catch","nodeDefs","nodes","skinDefs","skins","meshDefs","meshes","meshReferences","meshUses","skinIndex","skinLength","joints","isBone","nodeIndex","nodeLength","nodeDef","skin","isSkinnedMesh","getDependency","cacheKey","dependency","charAt","toUpperCase","getDependencies","defs","def","types","results","pendings","loadBuffer","bufferIndex","bufferDef","buffers","uri","resolve","reject","loadBufferView","bufferViewIndex","bufferViewDef","bufferViews","loadAccessor","accessorIndex","accessorDef","pendingBufferViews","bufferView","sparse","values","bufferAttribute","itemSize","TypedArray","componentType","elementBytes","BYTES_PER_ELEMENT","itemBytes","byteStride","normalized","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setArray","setX","setY","setZ","setW","textureIndex","URL","webkitURL","textureDef","textures","images","sourceURI","isObjectURL","blob","Blob","mimeType","createObjectURL","Loader","Handlers","revokeObjectURL","flipY","format","internalFormat","sampler","samplers","magFilter","minFilter","wrapS","wrapT","textureName","loadMaterial","materialIndex","materialType","materialDef","materials","materialExtensions","khcExtension","sgExtension","pbrMetallicRoughness","MeshStandardMaterial","metallicRoughness","baseColorFactor","baseColorTexture","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","side","DoubleSide","alphaMode","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","encoding","sRGBEncoding","extras","userData","loadGeometries","primitives","geometries","BufferGeometry","attributeId","addAttribute","setIndex","loadMesh","meshIndex","Group","depthTest","uv2","uv","useVertexColors","useFlatShading","useSkinning","useMorphTargets","vertexColors","VertexColors","needsUpdate","flatShading","mode","SkinnedMesh","skinning","Mesh","drawMode","TriangleStripDrawMode","TriangleFanDrawMode","LineSegments","Line","LineLoop","Points","onBeforeRender","loadCamera","cameraIndex","cameraDef","aspectRatio","xfov","yfov","PerspectiveCamera","radToDeg","znear","zfar","OrthographicCamera","xmag","ymag","loadSkin","skinDef","skinEntry","inverseBindMatrices","accessor","loadAnimation","animationIndex","animationDef","tracks","channels","channel","node","id","input","parameters","output","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","uuid","interpolation","outputAccessorValues","getW","targetNames","traverse","isMesh","AnimationUtils","arraySlice","AnimationClip","loadNode","Bone","isGroup","child","Object3D","PropertyBinding","sanitizeNodeName","applyMatrix","quaternion","loadScene","buildNodeHierachy","nodeId","parentObject","allNodes","bones","boneInverses","jointId","jointNode","mat","Skeleton","matrixWorld","sceneIndex","sceneDef","Scene","nodeIds","__webpack_exports__"],"mappings":"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","file":"static/js/app.822c7d3b46b86b6e9fc0.js","sourcesContent":["Math.clamp = function ( value, min, max ) {\n\treturn Math.max( min, Math.min( max, value ) );\n}\n\nMath.map = function ( x, a1, a2, b1, b2 ) {\n\treturn b1 + ( x - a1 ) * ( b2 - b1 ) / ( a2 - a1 );\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./static/js/Math.js\n// module id = 0gDO\n// module chunks = 1","import GLTFLoader from '../../../static/js/GLTFLoader'\nconst EventEmitter = require('events')\n\nclass Resource extends EventEmitter {\n  constructor (modelUrl, scale, rotation, audioUrl, audioListener) {\n    super()\n\n    this.modelUrl = modelUrl\n    this.scale = scale\n    this.rotation = rotation\n    this.audioUrl = audioUrl\n    this.audioListener = audioListener\n    this.model = null\n    this.sound = null\n\n    this.loadModel()\n    this.loadAudio()\n  }\n\n  loadModel () {\n    var t = this\n    var loader = new GLTFLoader()\n    loader.load('static/models/' + t.modelUrl, function (gltf) {\n      t.model = gltf.scene.children[0].clone()\n      t.model.scale.set(t.scale, t.scale, t.scale)\n      t.model.lookAt(0, t.rotation, 0)\n    },\n    function (xhr) {\n      // console.log((xhr.loaded / xhr.total * 100) + '% loaded')\n    },\n    function (error) {\n      console.error('GLTF LOADER:', error)\n    })\n  }\n\n  loadAudio () {\n    var t = this\n    // eslint-disable-next-line\n    this.sound = new THREE.Audio(this.audioListener)\n    // eslint-disable-next-line\n    var audioLoader = new THREE.AudioLoader()\n    audioLoader.load(this.audioUrl, function (buffer) {\n      t.sound.setBuffer(buffer)\n      t.sound.setLoop(false)\n      t.sound.setVolume(0.5)\n    })\n  }\n}\n\nexport default Resource\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/resources/Resource.js","import * as THREE from 'three'\nimport GLTFLoader from '../../../static/js/GLTFLoader'\nconst EventEmitter = require('events')\n\nclass Ship extends EventEmitter {\n  constructor (modelUrl, scale, rotation, velocity, audioUrl, audioListener, audioPlay) {\n    super()\n\n    this.modelUrl = modelUrl\n    this.scale = scale\n    this.rotation = rotation\n    this.velocity = velocity\n    this.audioUrl = audioUrl\n    this.audioListener = audioListener\n    this.audioPlay = audioPlay\n    this.model = null\n    this.sound = null\n    this.center = new THREE.Vector3(0, 0, 0)\n\n    this.loadModel()\n    this.loadAudio()\n  }\n\n  loadModel () {\n    var t = this\n    // eslint-disable-next-line\n    var loader = new GLTFLoader()\n    loader.load('static/models/' + this.modelUrl, function (gltf) {\n      t.model = gltf.scene.children[0]\n      t.model.scale.set(t.scale, t.scale, t.scale)\n      t.center = new THREE.Box3().setFromObject(t.model).getCenter()\n      t.emit('onModelLoaded', t.model)\n    },\n    function (xhr) {\n      // console.log((xhr.loaded / xhr.total * 100) + '% loaded')\n    },\n    function (error) {\n      console.error('GLTF LOADER:', error)\n    })\n  }\n\n  loadAudio () {\n    var t = this\n    // eslint-disable-next-line\n    this.sound = new THREE.Audio(this.audioListener)\n    var audioLoader = new THREE.AudioLoader()\n    audioLoader.load(this.audioUrl, function (buffer) {\n      t.sound.setBuffer(buffer)\n      t.sound.setLoop(true)\n      t.sound.setVolume(0.3)\n      if (t.audioPlay) {\n        t.sound.play()\n      }\n    })\n  }\n}\n\nexport default Ship\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Ship.js","import Ship from './Ship'\n\nclass Parachute extends Ship {\n  constructor (audioListener) {\n    super('parachute.gltf', 2.5, 0, 1, 'static/audios/205966__kangaroovindaloo__medium-wind.ogg', audioListener, true)\n  }\n}\n\nexport default Parachute\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Parachute.js","import Ship from './Ship'\n\nclass Balloon extends Ship {\n  constructor (audioListener) {\n    super('balloon.gltf', 2.5, 0, 1, 'static/audios/205966__kangaroovindaloo__medium-wind.ogg', audioListener, false)\n  }\n}\n\nexport default Balloon\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Balloon.js","import Ship from './Ship'\n\nclass Parachute extends Ship {\n  constructor (audioListener) {\n    super('plane.gltf', 6, Math.PI + Math.PI * 0.5, 2, 'static/audios/218352__photomonster__motorcycle-nsumax-1954-engine.ogg', audioListener, false)\n  }\n}\n\nexport default Parachute\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Plane.js","import Ship from './Ship'\n\nclass Parachute extends Ship {\n  constructor (audioListener) {\n    super('spaceship.gltf', 30, Math.PI, 3, 'static/audios/42233__noisecollector__spaceswamp.ogg', audioListener, false)\n  }\n}\n\nexport default Parachute\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Spaceship.js","import Ship from './Ship'\n\nclass Ovni extends Ship {\n  constructor (audioListener) {\n    super('ovni.gltf', 30, Math.PI, 2, 'static/audios/42233__noisecollector__spaceswamp.ogg', audioListener, false)\n  }\n}\n\nexport default Ovni\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Ovni.js","import Resource from './Resource'\n\nclass Coin extends Resource {\n  constructor (audioListener) {\n    super('coin.gltf', 30, 1, 'static/audios/135936__bradwesson__collectcoin.ogg', audioListener)\n  }\n}\n\nexport default Coin\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/resources/Coin.js","import * as THREE from 'three'\r\nconst EventEmitter = require('events')\r\n\r\nclass ParticleManager extends EventEmitter {\r\n  constructor (scene, camera) {\r\n    super()\r\n\r\n    this._scene = scene\r\n    this._camera = camera\r\n    this.prevCamX = this._camera.position.x\r\n    this.prevCamY = this._camera.position.y\r\n    this.prevCamZ = this._camera.position.z\r\n\r\n    this.maxParticles = 1000\r\n\r\n    this.spread = 300\r\n\r\n    this.particles = new THREE.Geometry()\r\n\r\n    for (let p = 0; p < this.maxParticles; p++) {\r\n      let particle = new THREE.Vector3(\r\n        Math.random() * this.spread - this.spread * 0.3,\r\n        Math.random() * this.spread - this.spread * 0.5,\r\n        Math.random() * 500\r\n      )\r\n\r\n      this.particles.vertices.push(particle)\r\n    }\r\n\r\n    let pMaterial = new THREE.PointsMaterial({\r\n      color: 0xFFFFFF,\r\n      size: 2,\r\n      map: THREE.ImageUtils.loadTexture(\r\n        'static/textures/particle.png'\r\n      ),\r\n      blending: THREE.AdditiveBlending,\r\n      transparent: true\r\n    })\r\n    this.particleSystem = new THREE.Points(this.particles, pMaterial)\r\n    this.particleSystem.sortParticles = true\r\n\r\n    this._scene.add(this.particleSystem)\r\n  }\r\n\r\n  set (name) {\r\n    if (name === 'Star') {\r\n\r\n    }\r\n  }\r\n\r\n  update () {\r\n    let xDiff = this._camera.position.x - this.prevCamX\r\n    let yDiff = this._camera.position.y - this.prevCamY\r\n    let zDiff = this._camera.position.z - this.prevCamZ\r\n\r\n    this.prevCamX = this._camera.position.x\r\n    this.prevCamY = this._camera.position.y\r\n    this.prevCamZ = this._camera.position.z\r\n\r\n    this.particleSystem.position.set(this._camera.position.x, this._camera.position.y, this._camera.position.z)\r\n\r\n    for (let i = 0; i < this.particleSystem.geometry.vertices.length; i++) {\r\n      let particle = this.particleSystem.geometry.vertices[i]\r\n      particle.x -= xDiff\r\n      particle.y -= yDiff\r\n      particle.z -= zDiff\r\n\r\n      if (particle.z < -30) {\r\n        particle.x = Math.random() * this.spread - this.spread * 0.3\r\n        particle.y = Math.random() * this.spread - this.spread * 0.5\r\n        particle.z = 500 + Math.random() * 500\r\n      }\r\n    }\r\n\r\n    this.particleSystem.geometry.verticesNeedUpdate = true\r\n  }\r\n}\r\n\r\nexport default ParticleManager\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/particles/ParticleManager.js","import './css/style.css'\nimport Main from './js/main'\n// import Main from './js/mainWagner'\n// import Main from './js/mainVR'\n\n// eslint-disable-next-line\nnew Main()\n\n\n\n// WEBPACK FOOTER //\n// ./src/app.js","import * as THREE from 'three'\r\n// import * as Stats from 'stats.js'\r\nimport Parachute from './ships/Parachute'\r\nimport Balloon from './ships/Balloon'\r\nimport Plane from './ships/Plane'\r\nimport Spaceship from './ships/Spaceship'\r\n// import Spaceship2 from './ships/Spaceship2'\r\nimport Ovni from './ships/Ovni'\r\nimport Coin from './resources/Coin'\r\nimport '../../static/js/GLTFLoader'\r\nimport '../../static/js/Math'\r\nimport ParticleManager from './particles/ParticleManager'\r\nimport Amplitude from 'amplitude'\r\n// import shaderVert from 'shaders/custom.vert'\r\n// import shaderFrag from 'shaders/custom.frag'\r\n\r\nclass Main {\r\n  constructor () {\r\n    var t = this\r\n\r\n    this.userId = new Date().getTime()\r\n    if (localStorage.getItem('userId')) {\r\n      this.userId = localStorage.getItem('userId')\r\n    } else {\r\n      localStorage.setItem('userId', this.userId)\r\n    }\r\n    this.amplitude = new Amplitude('82e23a024491264ca4d730a9297d4073')\r\n\r\n    this.currentLevel = 0\r\n\r\n    this.mouseX = 0\r\n    this.mouseY = 0\r\n    this.prevMouseX = this.mouseX\r\n    this.prevMouseY = this.mouseY\r\n    this.diffX = 0\r\n    this.diffY = 0\r\n\r\n    this.audioList = [\r\n      {\r\n        url: 'static/audios/Black-Eyed-Peas-I-Got-A-Feeling.ogg',\r\n        sound: null\r\n      },\r\n      {\r\n        url: 'static/audios/Eiffel65-Blue.ogg',\r\n        sound: null\r\n      },\r\n      {\r\n        url: 'static/audios/Enegetic-Game-Theme.ogg',\r\n        sound: null\r\n      },\r\n      {\r\n        url: 'static/audios/Imagine Dragons - Radioactive (Harder).ogg',\r\n        sound: null\r\n      }\r\n    ]\r\n    this.audioListener = new THREE.AudioListener()\r\n\r\n    this.maxX = 80\r\n    this.maxY = 50\r\n    this.velX = 1.5\r\n    this.minAltitude = 200 // meters\r\n    this.altitude = this.minAltitude\r\n    this.curAltitude = this.altitude\r\n    this.destPos = new THREE.Vector2()\r\n    this.raycaster = new THREE.Raycaster()\r\n    this.raycaster.far = 2\r\n    this.direction = new THREE.Vector3(0, 0, 10)\r\n    this.direction.normalize()\r\n    this.coins = []\r\n    this.coin = new Coin(this.audioListener)\r\n    this.paused = false\r\n\r\n    this.levels = [\r\n      {\r\n        ship: new Parachute(this.audioListener),\r\n        altitude: this.minAltitude,\r\n        skyColor: new THREE.Color(0xcaf8f1),\r\n        decay: 0.03,\r\n        coins: 20\r\n      },\r\n      {\r\n        ship: new Balloon(this.audioListener),\r\n        altitude: 400,\r\n        skyColor: new THREE.Color(0xaaffff),\r\n        decay: 0.04,\r\n        coins: 18\r\n      },\r\n      {\r\n        ship: new Plane(this.audioListener),\r\n        altitude: 600,\r\n        skyColor: new THREE.Color(0xf26dd9),\r\n        decay: 0.06,\r\n        coins: 15\r\n      },\r\n      {\r\n        ship: new Spaceship(this.audioListener),\r\n        altitude: 800,\r\n        skyColor: new THREE.Color(0xff933a),\r\n        decay: 0.12,\r\n        coins: 12\r\n      },\r\n      /*\r\n      {\r\n        ship: new Spaceship2(this.audioListener),\r\n        altitude: 1000,\r\n        skyColor: new THREE.Color(0x000000),\r\n        decay: 0.12,\r\n        coins: 10\r\n      },\r\n      */\r\n      {\r\n        ship: new Ovni(this.audioListener),\r\n        altitude: 1000,\r\n        skyColor: new THREE.Color(0x000000),\r\n        decay: 0.12,\r\n        coins: 8\r\n      }\r\n    ]\r\n\r\n    this._camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000)\r\n    this._camera.position.set(-100, this.altitude + 50, 0)\r\n    this._camera.lookAt(0, this.altitude, 100)\r\n    this._camera.add(this.audioListener)\r\n\r\n    this._scene = new THREE.Scene()\r\n\r\n    this._renderer = new THREE.WebGLRenderer()\r\n    this._renderer.setPixelRatio(window.devicePixelRatio)\r\n    this._renderer.setSize(window.innerWidth, window.innerHeight)\r\n    document.body.appendChild(this._renderer.domElement)\r\n\r\n    /*\r\n    this.stats = new Stats()\r\n    this.stats.showPanel(0)// fps,\r\n    // this.stats.showPanel(1)// ms\r\n    // this.stats.showPanel(2)// mb\r\n    document.body.appendChild(this.stats.dom)\r\n    */\r\n\r\n    // for inspection debug\r\n    // window.scene = this._scene\r\n    // window.THREE = THREE\r\n\r\n    // 'ovni.gltf' 100\r\n    // 'balloon.gltf' 10\r\n\r\n    var light = new THREE.HemisphereLight(0xbbbbff, 0x444422)\r\n    light.name = 'Hemisphere Light'\r\n    light.position.set(0, 1, 0)\r\n    t._scene.add(light)\r\n\r\n    var dirLight = new THREE.DirectionalLight(0xffffff)\r\n    dirLight.name = 'Point Light'\r\n    dirLight.position.set(-10, 6, -10)\r\n    t._scene.add(dirLight)\r\n\r\n    this.particles = new ParticleManager(this._scene, this._camera)\r\n\r\n    const geometry = new THREE.SphereGeometry(1, 320, 320)\r\n    const material = new THREE.MeshPhongMaterial({color: 0x008800, emissive: 0x00ff00})\r\n    /*\r\n    const material2 = new THREE.ShaderMaterial({\r\n      vertexShader: shaderVert,\r\n      fragmentShader: shaderFrag\r\n    })\r\n    */\r\n    this.ground = new THREE.Mesh(geometry, material)\r\n    this.ground.name = 'Ground'\r\n    this._scene.add(this.ground)\r\n\r\n    const earthRadius = 6000000 // 6000 km\r\n    this.ground.scale.set(earthRadius, earthRadius, earthRadius)\r\n    this.ground.position.y = -earthRadius\r\n    this.ground.rotation.z = Math.PI * 0.5\r\n\r\n    // add ship models to scene\r\n    for (var i = 0; i < this.levels.length; i++) {\r\n      this.levels[i].ship.on('onModelLoaded', function (model) {\r\n        t._scene.add(model)\r\n        model.position.y = t.altitude\r\n      })\r\n    }\r\n\r\n    this.altimeterEl = document.getElementById('altimeter')\r\n\r\n    this._renderer.domElement.addEventListener('mousemove', this.onMouseMove.bind(this), false)\r\n    this._renderer.domElement.addEventListener('mousedown', this.onMouseDown.bind(this), false)\r\n    this._renderer.domElement.addEventListener('mouseup', this.onMouseUp.bind(this), false)\r\n    this._renderer.domElement.addEventListener('touchstart', this.onMouseDown.bind(this), false)\r\n    this._renderer.domElement.addEventListener('touchend', this.onMouseUp.bind(this), false)\r\n\r\n    document.addEventListener('keydown', this.onKeyDown.bind(this), false)\r\n    document.addEventListener('keyup', this.onKeyUp.bind(this), false)\r\n\r\n    window.addEventListener('resize', this.onWindowResize.bind(this), false)\r\n\r\n    this.loadAudio()\r\n    this.initAccelerometer()\r\n    this.animate()\r\n  }\r\n\r\n  onMouseMove (event) {\r\n    this.mouseX = event.pageX\r\n    this.mouseY = event.pageY\r\n  }\r\n\r\n  onMouseDown () {\r\n    // this.nextLevel()\r\n    // this.altitude = this.levels[this.currentLevel].altitude + 100\r\n  }\r\n\r\n  onMouseUp () {\r\n  }\r\n\r\n  onKeyDown (e) {\r\n    if (e.keyCode === 32) this.paused = !this.paused\r\n  }\r\n\r\n  onKeyUp (e) {\r\n  }\r\n\r\n  onWindowResize () {\r\n    this._camera.aspect = window.innerWidth / window.innerHeight\r\n    this._camera.updateProjectionMatrix()\r\n\r\n    this._renderer.setSize(window.innerWidth, window.innerHeight)\r\n  }\r\n\r\n  animate (timestamp) {\r\n    // this.stats.begin()\r\n\r\n    if (!this.paused) {\r\n      // mouse\r\n      this.diffX += (this.mouseX - this.prevMouseX) / 100\r\n      this.diffY += (this.mouseY - this.prevMouseY) / 100\r\n      this.diffX = Math.clamp(this.diffX, -1, 1)\r\n      this.diffY = Math.clamp(this.diffY, -1, 1)\r\n      this.prevMouseX = this.mouseX\r\n      this.prevMouseY = this.mouseY\r\n\r\n      // altitude\r\n      this.altitude -= this.levels[this.currentLevel].decay\r\n      if (this.altitude < this.minAltitude) this.altitude = this.minAltitude\r\n      this.curAltitude += (this.altitude - this.curAltitude) * 0.05\r\n\r\n      this.altimeterEl.innerHTML = Math.round(this.curAltitude)\r\n\r\n      let nextLevel = this.currentLevel + 1\r\n      if (nextLevel >= this.levels.length) {\r\n        nextLevel = this.currentLevel\r\n      }\r\n      let progress = (this.curAltitude - this.levels[this.currentLevel].altitude) / (this.levels[nextLevel].altitude - this.levels[this.currentLevel].altitude)\r\n      progress = THREE.Math.clamp(progress, 0, 1)\r\n\r\n      // instantiate coins\r\n      if (this.coin.model) {\r\n        if (this.coins.length < this.levels[this.currentLevel].coins && Math.random() > 0.97) {\r\n          var coin = this.coin.model.clone()\r\n          coin.rotation.z = Math.random() * Math.PI\r\n          coin.position.set(\r\n            (Math.random() - 0.5) * 2 * this.maxX,\r\n            Math.random() * (this.maxY - 20) + 20 + this.curAltitude,\r\n            this._camera.position.z + 500 + Math.random() * 300)\r\n          this._scene.add(coin)\r\n          this.coins.push(coin)\r\n        }\r\n      }\r\n\r\n      // update or remove coins\r\n      for (var c = this.coins.length - 1; c >= 0; c--) {\r\n        if (this.coins[c].position.z < this._camera.position.z) {\r\n          this.removeCoin(this.coins[c])\r\n        } else {\r\n          this.coins[c].rotation.z += 0.02\r\n        }\r\n      }\r\n\r\n      var model = this.levels[this.currentLevel].ship.model\r\n      if (model) {\r\n        var oldModelPos = model.position.clone()\r\n\r\n        // position\r\n        this.destPos.x = Math.map(-this.diffX, -1, 1, -this.maxX, this.maxX)\r\n        this.destPos.y = Math.map(-this.diffY, -1, 1, 0, this.maxY) + this.curAltitude\r\n        model.position.x += (this.destPos.x - model.position.x) * 0.05\r\n        model.position.y += (this.destPos.y - model.position.y) * 0.05\r\n        model.position.z += this.levels[this.currentLevel].ship.velocity * this.velX\r\n\r\n        // camera\r\n        this._camera.position.z = model.position.z - 50\r\n        this._camera.position.y = this.curAltitude + 50\r\n\r\n        // ground\r\n        this.ground.position.z = model.position.z\r\n        // this.ground.rotation.x += 0.00005\r\n\r\n        // direction\r\n        var dir = new THREE.Vector3()\r\n        dir.subVectors(model.position, oldModelPos)\r\n        dir.add(model.position)\r\n        model.lookAt(dir)\r\n        model.rotation.y += this.levels[this.currentLevel].ship.rotation\r\n\r\n        // collider\r\n        var position = model.position.clone().add(this.levels[this.currentLevel].ship.center)\r\n        for (var i = this.coins.length - 1; i >= 0; i--) {\r\n          if (position.distanceToSquared(this.coins[i].position) < 300) {\r\n            this.onResourceCollide(this.coins[i])\r\n          }\r\n        }\r\n      // if model\r\n      }\r\n\r\n      this.particles.update()\r\n\r\n      // color\r\n      let skyColor = this.levels[this.currentLevel].skyColor.clone()\r\n      skyColor.lerp(this.levels[nextLevel].skyColor, progress)\r\n      this._scene.background = skyColor\r\n      this._scene.fog = new THREE.FogExp2(skyColor, 0.003)\r\n\r\n      // console.log(progress)\r\n      if (progress <= 0) {\r\n        this.prevLevel()\r\n      } else if (progress >= 1) {\r\n        this.nextLevel()\r\n      }\r\n\r\n    // if !this.paused\r\n    }\r\n\r\n    this._renderer.render(this._scene, this._camera)\r\n\r\n    // this.stats.end()\r\n\r\n    requestAnimationFrame(this.animate.bind(this))\r\n  }\r\n\r\n  nextLevel () {\r\n    var nextLevel = this.currentLevel + 1\r\n    if (nextLevel >= this.levels.length) nextLevel = this.currentLevel\r\n\r\n    if (nextLevel === this.currentLevel) return\r\n\r\n    this.startLevel(nextLevel)\r\n  }\r\n\r\n  prevLevel () {\r\n    var prevLevel = this.currentLevel - 1\r\n    if (prevLevel <= 0) prevLevel = 0\r\n\r\n    if (prevLevel === this.currentLevel) return\r\n\r\n    this.startLevel(prevLevel)\r\n  }\r\n\r\n  startLevel (level) {\r\n    console.log('startLevel', level)\r\n\r\n    this.track('change_level', {level: level})\r\n\r\n    this.levels[level].ship.model.position.copy(this.levels[this.currentLevel].ship.model.position)\r\n    if (this.levels[this.currentLevel].ship.sound.isPlaying) {\r\n      this.levels[this.currentLevel].ship.sound.stop()\r\n    }\r\n    this.currentLevel = level\r\n    this.levels[this.currentLevel].ship.sound.play()\r\n  }\r\n\r\n  onResourceCollide (resource) {\r\n    var increase = 20\r\n\r\n    // bonus = fast coin catch\r\n    if (this.curAltitude < this.altitude) increase *= 2\r\n\r\n    this.altitude += increase * (this.currentLevel + 1)\r\n\r\n    this.coin.sound.play()\r\n\r\n    this.removeCoin(resource)\r\n\r\n    this.track('get_resource')\r\n  }\r\n\r\n  removeCoin (coin) {\r\n    var index = this.coins.indexOf(coin)\r\n    if (index > -1) {\r\n      this.coins.splice(index, 1)\r\n    }\r\n\r\n    this._scene.remove(coin)\r\n  }\r\n\r\n  loadAudio () {\r\n    this.audioList = this.audioList\r\n      .map((a) => ({sort: Math.random(), value: a}))\r\n      .sort((a, b) => a.sort - b.sort)\r\n      .map((a) => a.value)\r\n\r\n    this.currentAudio = 0\r\n    let counter = -1\r\n    let t = this\r\n\r\n    this.audioList.map((a) => {\r\n      a.index = ++counter\r\n      a.sound = new THREE.Audio(this.audioListener)\r\n      var audioLoader = new THREE.AudioLoader()\r\n      audioLoader.load(a.url, function (buffer) {\r\n        a.sound.setBuffer(buffer)\r\n        a.sound.setLoop(false)\r\n        a.sound.setVolume(0.5)\r\n        if (a.index === 0) {\r\n          a.sound.play()\r\n          a.sound.source.onended = () => {\r\n            console.log('audio ended', t.currentAudio, t.audioList.length, a.index)\r\n            t.currentAudio++\r\n            if (t.currentAudio >= t.audioList.length) t.currentAudio = 0\r\n            console.log('audio ended', t.currentAudio, t.audioList.length, a.index)\r\n\r\n            t.audioList[t.currentAudio].sound.play()\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  initAccelerometer () {\r\n    let t = this\r\n    window.addEventListener('devicemotion', function (event) {\r\n      let x = event.accelerationIncludingGravity.x\r\n      let y = event.accelerationIncludingGravity.y\r\n      if (x !== 0 || y !== 0) {\r\n        if (window.innerWidth > window.innerHeight) {\r\n          t.mouseX = -y * 30\r\n          t.mouseY = x * 30\r\n        } else {\r\n          t.mouseX = x * 30\r\n          t.mouseY = -y * 30\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  track (eventType, eventProperties) {\r\n    let data = {event_type: eventType, user_id: this.userId}\r\n    if (eventProperties) data.event_properties = eventProperties\r\n    this.amplitude.track(data)\r\n  }\r\n}\r\n\r\nexport default Main\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/main.js","/**\r\n * @author Rich Tibbett / https://github.com/richtr\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Tony Parisi / http://www.tonyparisi.com/\r\n * @author Takahiro / https://github.com/takahirox\r\n * @author Don McCurdy / https://www.donmccurdy.com\r\n */\r\n\r\nconst GLTFLoader = ( function () {\r\n\r\n\tfunction GLTFLoader( manager ) {\r\n\r\n\t\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n\t}\r\n\r\n\tGLTFLoader.prototype = {\r\n\r\n\t\tconstructor: GLTFLoader,\r\n\r\n\t\tcrossOrigin: 'Anonymous',\r\n\r\n\t\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tvar path = this.path !== undefined ? this.path : THREE.LoaderUtils.extractUrlBase( url );\r\n\r\n\t\t\tvar loader = new THREE.FileLoader( scope.manager );\r\n\r\n\t\t\tloader.setResponseType( 'arraybuffer' );\r\n\r\n\t\t\tloader.load( url, function ( data ) {\r\n\r\n\t\t\t\ttry {\r\n\r\n\t\t\t\t\tscope.parse( data, path, onLoad, onError );\r\n\r\n\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\tif ( onError !== undefined ) {\r\n\r\n\t\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tthrow e;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, onProgress, onError );\r\n\r\n\t\t},\r\n\r\n\t\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\t\tthis.crossOrigin = value;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tsetPath: function ( value ) {\r\n\r\n\t\t\tthis.path = value;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tparse: function ( data, path, onLoad, onError ) {\r\n\r\n\t\t\tvar content;\r\n\t\t\tvar extensions = {};\r\n\r\n\t\t\tif ( typeof data === 'string' ) {\r\n\r\n\t\t\t\tcontent = data;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar magic = THREE.LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\r\n\r\n\t\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\t\t\ttry {\r\n\r\n\t\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\r\n\r\n\t\t\t\t\t} catch ( error ) {\r\n\r\n\t\t\t\t\t\tif ( onError ) onError( error );\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcontent = THREE.LoaderUtils.decodeText( new Uint8Array( data ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar json = JSON.parse( content );\r\n\r\n\t\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\r\n\r\n\t\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.' ) );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( json.extensionsUsed ) {\r\n\r\n\t\t\t\tif ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_LIGHTS ) >= 0 ) {\r\n\r\n\t\t\t\t\textensions[ EXTENSIONS.KHR_LIGHTS ] = new GLTFLightsExtension( json );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_COMMON ) >= 0 ) {\r\n\r\n\t\t\t\t\textensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] = new GLTFMaterialsCommonExtension( json );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ) >= 0 ) {\r\n\r\n\t\t\t\t\textensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// console.time( 'GLTFLoader' );\r\n\r\n\t\t\tvar parser = new GLTFParser( json, extensions, {\r\n\r\n\t\t\t\tpath: path || this.path || '',\r\n\t\t\t\tcrossOrigin: this.crossOrigin,\r\n\t\t\t\tmanager: this.manager\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tparser.parse( function ( scene, scenes, cameras, animations, asset ) {\r\n\r\n\t\t\t\t// console.timeEnd( 'GLTFLoader' );\r\n\r\n\t\t\t\tvar glTF = {\r\n\t\t\t\t\tscene: scene,\r\n\t\t\t\t\tscenes: scenes,\r\n\t\t\t\t\tcameras: cameras,\r\n\t\t\t\t\tanimations: animations,\r\n\t\t\t\t\tasset: asset\r\n\t\t\t\t};\r\n\r\n\t\t\t\tonLoad( glTF );\r\n\r\n\t\t\t}, onError );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t/* GLTFREGISTRY */\r\n\r\n\tfunction GLTFRegistry() {\r\n\r\n\t\tvar objects = {};\r\n\r\n\t\treturn\t{\r\n\r\n\t\t\tget: function ( key ) {\r\n\r\n\t\t\t\treturn objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tadd: function ( key, object ) {\r\n\r\n\t\t\t\tobjects[ key ] = object;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremove: function ( key ) {\r\n\r\n\t\t\t\tdelete objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremoveAll: function () {\r\n\r\n\t\t\t\tobjects = {};\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** EXTENSIONS ***********/\r\n\t/*********************************/\r\n\r\n\tvar EXTENSIONS = {\r\n\t\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\r\n\t\tKHR_LIGHTS: 'KHR_lights',\r\n\t\tKHR_MATERIALS_COMMON: 'KHR_materials_common',\r\n\t\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness'\r\n\t};\r\n\r\n\t/**\r\n\t * Lights Extension\r\n\t *\r\n\t * Specification: PENDING\r\n\t */\r\n\tfunction GLTFLightsExtension( json ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS;\r\n\r\n\t\tthis.lights = {};\r\n\r\n\t\tvar extension = ( json.extensions && json.extensions[ EXTENSIONS.KHR_LIGHTS ] ) || {};\r\n\t\tvar lights = extension.lights || {};\r\n\r\n\t\tfor ( var lightId in lights ) {\r\n\r\n\t\t\tvar light = lights[ lightId ];\r\n\t\t\tvar lightNode;\r\n\r\n\t\t\tvar color = new THREE.Color().fromArray( light.color );\r\n\r\n\t\t\tswitch ( light.type ) {\r\n\r\n\t\t\t\tcase 'directional':\r\n\t\t\t\t\tlightNode = new THREE.DirectionalLight( color );\r\n\t\t\t\t\tlightNode.position.set( 0, 0, 1 );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'point':\r\n\t\t\t\t\tlightNode = new THREE.PointLight( color );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'spot':\r\n\t\t\t\t\tlightNode = new THREE.SpotLight( color );\r\n\t\t\t\t\tlightNode.position.set( 0, 0, 1 );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'ambient':\r\n\t\t\t\t\tlightNode = new THREE.AmbientLight( color );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( lightNode ) {\r\n\r\n\t\t\t\tif ( light.constantAttenuation !== undefined ) {\r\n\r\n\t\t\t\t\tlightNode.intensity = light.constantAttenuation;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( light.linearAttenuation !== undefined ) {\r\n\r\n\t\t\t\t\tlightNode.distance = 1 / light.linearAttenuation;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( light.quadraticAttenuation !== undefined ) {\r\n\r\n\t\t\t\t\tlightNode.decay = light.quadraticAttenuation;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( light.fallOffAngle !== undefined ) {\r\n\r\n\t\t\t\t\tlightNode.angle = light.fallOffAngle;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( light.fallOffExponent !== undefined ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader:: light.fallOffExponent not currently supported.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlightNode.name = light.name || ( 'light_' + lightId );\r\n\t\t\t\tthis.lights[ lightId ] = lightNode;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Common Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_common\r\n\t */\r\n\tfunction GLTFMaterialsCommonExtension( json ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_COMMON;\r\n\r\n\t}\r\n\r\n\tGLTFMaterialsCommonExtension.prototype.getMaterialType = function ( material ) {\r\n\r\n\t\tvar khrMaterial = material.extensions[ this.name ];\r\n\r\n\t\tswitch ( khrMaterial.type ) {\r\n\r\n\t\t\tcase 'commonBlinn' :\r\n\t\t\tcase 'commonPhong' :\r\n\t\t\t\treturn THREE.MeshPhongMaterial;\r\n\r\n\t\t\tcase 'commonLambert' :\r\n\t\t\t\treturn THREE.MeshLambertMaterial;\r\n\r\n\t\t\tcase 'commonConstant' :\r\n\t\t\tdefault :\r\n\t\t\t\treturn THREE.MeshBasicMaterial;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tGLTFMaterialsCommonExtension.prototype.extendParams = function ( materialParams, material, parser ) {\r\n\r\n\t\tvar khrMaterial = material.extensions[ this.name ];\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tvar keys = [];\r\n\r\n\t\t// TODO: Currently ignored: 'ambientFactor', 'ambientTexture'\r\n\t\tswitch ( khrMaterial.type ) {\r\n\r\n\t\t\tcase 'commonBlinn' :\r\n\t\t\tcase 'commonPhong' :\r\n\t\t\t\tkeys.push( 'diffuseFactor', 'diffuseTexture', 'specularFactor', 'specularTexture', 'shininessFactor' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'commonLambert' :\r\n\t\t\t\tkeys.push( 'diffuseFactor', 'diffuseTexture' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'commonConstant' :\r\n\t\t\tdefault :\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tvar materialValues = {};\r\n\r\n\t\tkeys.forEach( function ( v ) {\r\n\r\n\t\t\tif ( khrMaterial[ v ] !== undefined ) materialValues[ v ] = khrMaterial[ v ];\r\n\r\n\t\t} );\r\n\r\n\t\tif ( materialValues.diffuseFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.color = new THREE.Color().fromArray( materialValues.diffuseFactor );\r\n\t\t\tmaterialParams.opacity = materialValues.diffuseFactor[ 3 ];\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialValues.diffuseTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'map', materialValues.diffuseTexture.index ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialValues.specularFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.specular = new THREE.Color().fromArray( materialValues.specularFactor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialValues.specularTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularMap', materialValues.specularTexture.index ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialValues.shininessFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.shininess = materialValues.shininessFactor;\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/* BINARY EXTENSION */\r\n\r\n\tvar BINARY_EXTENSION_BUFFER_NAME = 'binary_glTF';\r\n\tvar BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\r\n\tvar BINARY_EXTENSION_HEADER_LENGTH = 12;\r\n\tvar BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\r\n\r\n\tfunction GLTFBinaryExtension( data ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\r\n\t\tthis.content = null;\r\n\t\tthis.body = null;\r\n\r\n\t\tvar headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\r\n\r\n\t\tthis.header = {\r\n\t\t\tmagic: THREE.LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\r\n\t\t\tversion: headerView.getUint32( 4, true ),\r\n\t\t\tlength: headerView.getUint32( 8, true )\r\n\t\t};\r\n\r\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\r\n\r\n\t\t} else if ( this.header.version < 2.0 ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.' );\r\n\r\n\t\t}\r\n\r\n\t\tvar chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\r\n\t\tvar chunkIndex = 0;\r\n\r\n\t\twhile ( chunkIndex < chunkView.byteLength ) {\r\n\r\n\t\t\tvar chunkLength = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tvar chunkType = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\r\n\r\n\t\t\t\tvar contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\r\n\t\t\t\tthis.content = THREE.LoaderUtils.decodeText( contentArray );\r\n\r\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\r\n\r\n\t\t\t\tvar byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\r\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Clients must ignore chunks with unknown types.\r\n\r\n\t\t\tchunkIndex += chunkLength;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.content === null ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specular-Glossiness Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_pbrSpecularGlossiness\r\n\t */\r\n\tfunction GLTFMaterialsPbrSpecularGlossinessExtension() {\r\n\r\n\t\treturn {\r\n\r\n\t\t\tname: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\r\n\r\n\t\t\tspecularGlossinessParams: [\r\n\t\t\t\t'color',\r\n\t\t\t\t'map',\r\n\t\t\t\t'lightMap',\r\n\t\t\t\t'lightMapIntensity',\r\n\t\t\t\t'aoMap',\r\n\t\t\t\t'aoMapIntensity',\r\n\t\t\t\t'emissive',\r\n\t\t\t\t'emissiveIntensity',\r\n\t\t\t\t'emissiveMap',\r\n\t\t\t\t'bumpMap',\r\n\t\t\t\t'bumpScale',\r\n\t\t\t\t'normalMap',\r\n\t\t\t\t'displacementMap',\r\n\t\t\t\t'displacementScale',\r\n\t\t\t\t'displacementBias',\r\n\t\t\t\t'specularMap',\r\n\t\t\t\t'specular',\r\n\t\t\t\t'glossinessMap',\r\n\t\t\t\t'glossiness',\r\n\t\t\t\t'alphaMap',\r\n\t\t\t\t'envMap',\r\n\t\t\t\t'envMapIntensity',\r\n\t\t\t\t'refractionRatio',\r\n\t\t\t],\r\n\r\n\t\t\tgetMaterialType: function () {\r\n\r\n\t\t\t\treturn THREE.ShaderMaterial;\r\n\r\n\t\t\t},\r\n\r\n\t\t\textendParams: function ( params, material, parser ) {\r\n\r\n\t\t\t\tvar pbrSpecularGlossiness = material.extensions[ this.name ];\r\n\r\n\t\t\t\tvar shader = THREE.ShaderLib[ 'standard' ];\r\n\r\n\t\t\t\tvar uniforms = THREE.UniformsUtils.clone( shader.uniforms );\r\n\r\n\t\t\t\tvar specularMapParsFragmentChunk = [\r\n\t\t\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t\t\t'\tuniform sampler2D specularMap;',\r\n\t\t\t\t\t'#endif'\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar glossinessMapParsFragmentChunk = [\r\n\t\t\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t\t\t'\tuniform sampler2D glossinessMap;',\r\n\t\t\t\t\t'#endif'\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar specularMapFragmentChunk = [\r\n\t\t\t\t\t'vec3 specularFactor = specular;',\r\n\t\t\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\r\n\t\t\t\t\t'\ttexelSpecular = sRGBToLinear( texelSpecular );',\r\n\t\t\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\r\n\t\t\t\t\t'#endif'\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar glossinessMapFragmentChunk = [\r\n\t\t\t\t\t'float glossinessFactor = glossiness;',\r\n\t\t\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\r\n\t\t\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\r\n\t\t\t\t\t'#endif'\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar lightPhysicalFragmentChunk = [\r\n\t\t\t\t\t'PhysicalMaterial material;',\r\n\t\t\t\t\t'material.diffuseColor = diffuseColor.rgb;',\r\n\t\t\t\t\t'material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );',\r\n\t\t\t\t\t'material.specularColor = specularFactor.rgb;',\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar fragmentShader = shader.fragmentShader\r\n\t\t\t\t\t.replace( '#include <specularmap_fragment>', '' )\r\n\t\t\t\t\t.replace( 'uniform float roughness;', 'uniform vec3 specular;' )\r\n\t\t\t\t\t.replace( 'uniform float metalness;', 'uniform float glossiness;' )\r\n\t\t\t\t\t.replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\r\n\t\t\t\t\t.replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\r\n\t\t\t\t\t.replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\r\n\t\t\t\t\t.replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\r\n\t\t\t\t\t.replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\r\n\r\n\t\t\t\tdelete uniforms.roughness;\r\n\t\t\t\tdelete uniforms.metalness;\r\n\t\t\t\tdelete uniforms.roughnessMap;\r\n\t\t\t\tdelete uniforms.metalnessMap;\r\n\r\n\t\t\t\tuniforms.specular = { value: new THREE.Color().setHex( 0x111111 ) };\r\n\t\t\t\tuniforms.glossiness = { value: 0.5 };\r\n\t\t\t\tuniforms.specularMap = { value: null };\r\n\t\t\t\tuniforms.glossinessMap = { value: null };\r\n\r\n\t\t\t\tparams.vertexShader = shader.vertexShader;\r\n\t\t\t\tparams.fragmentShader = fragmentShader;\r\n\t\t\t\tparams.uniforms = uniforms;\r\n\t\t\t\tparams.defines = { 'STANDARD': '' };\r\n\r\n\t\t\t\tparams.color = new THREE.Color( 1.0, 1.0, 1.0 );\r\n\t\t\t\tparams.opacity = 1.0;\r\n\r\n\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\r\n\r\n\t\t\t\t\tvar array = pbrSpecularGlossiness.diffuseFactor;\r\n\r\n\t\t\t\t\tparams.color.fromArray( array );\r\n\t\t\t\t\tparams.opacity = array[ 3 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\r\n\r\n\t\t\t\t\tpending.push( parser.assignTexture( params, 'map', pbrSpecularGlossiness.diffuseTexture.index ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparams.emissive = new THREE.Color( 0.0, 0.0, 0.0 );\r\n\t\t\t\tparams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\r\n\t\t\t\tparams.specular = new THREE.Color( 1.0, 1.0, 1.0 );\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\r\n\r\n\t\t\t\t\tparams.specular.fromArray( pbrSpecularGlossiness.specularFactor );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\r\n\r\n\t\t\t\t\tvar specGlossIndex = pbrSpecularGlossiness.specularGlossinessTexture.index;\r\n\t\t\t\t\tpending.push( parser.assignTexture( params, 'glossinessMap', specGlossIndex ) );\r\n\t\t\t\t\tpending.push( parser.assignTexture( params, 'specularMap', specGlossIndex ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Promise.all( pending );\r\n\r\n\t\t\t},\r\n\r\n\t\t\tcreateMaterial: function ( params ) {\r\n\r\n\t\t\t\t// setup material properties based on MeshStandardMaterial for Specular-Glossiness\r\n\r\n\t\t\t\tvar material = new THREE.ShaderMaterial( {\r\n\t\t\t\t\tdefines: params.defines,\r\n\t\t\t\t\tvertexShader: params.vertexShader,\r\n\t\t\t\t\tfragmentShader: params.fragmentShader,\r\n\t\t\t\t\tuniforms: params.uniforms,\r\n\t\t\t\t\tfog: true,\r\n\t\t\t\t\tlights: true,\r\n\t\t\t\t\topacity: params.opacity,\r\n\t\t\t\t\ttransparent: params.transparent\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tmaterial.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n\t\t\t\tmaterial.color = params.color;\r\n\r\n\t\t\t\tmaterial.map = params.map === undefined ? null : params.map;\r\n\r\n\t\t\t\tmaterial.lightMap = null;\r\n\t\t\t\tmaterial.lightMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.aoMap = params.aoMap === undefined ? null : params.aoMap;\r\n\t\t\t\tmaterial.aoMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.emissive = params.emissive;\r\n\t\t\t\tmaterial.emissiveIntensity = 1.0;\r\n\t\t\t\tmaterial.emissiveMap = params.emissiveMap === undefined ? null : params.emissiveMap;\r\n\r\n\t\t\t\tmaterial.bumpMap = params.bumpMap === undefined ? null : params.bumpMap;\r\n\t\t\t\tmaterial.bumpScale = 1;\r\n\r\n\t\t\t\tmaterial.normalMap = params.normalMap === undefined ? null : params.normalMap;\r\n\t\t\t\tif ( params.normalScale ) material.normalScale = params.normalScale;\r\n\r\n\t\t\t\tmaterial.displacementMap = null;\r\n\t\t\t\tmaterial.displacementScale = 1;\r\n\t\t\t\tmaterial.displacementBias = 0;\r\n\r\n\t\t\t\tmaterial.specularMap = params.specularMap === undefined ? null : params.specularMap;\r\n\t\t\t\tmaterial.specular = params.specular;\r\n\r\n\t\t\t\tmaterial.glossinessMap = params.glossinessMap === undefined ? null : params.glossinessMap;\r\n\t\t\t\tmaterial.glossiness = params.glossiness;\r\n\r\n\t\t\t\tmaterial.alphaMap = null;\r\n\r\n\t\t\t\tmaterial.envMap = params.envMap === undefined ? null : params.envMap;\r\n\t\t\t\tmaterial.envMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.refractionRatio = 0.98;\r\n\r\n\t\t\t\tmaterial.extensions.derivatives = true;\r\n\r\n\t\t\t\treturn material;\r\n\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Clones a GLTFSpecularGlossinessMaterial instance. The ShaderMaterial.copy() method can\r\n\t\t\t * copy only properties it knows about or inherits, and misses many properties that would\r\n\t\t\t * normally be defined by MeshStandardMaterial.\r\n\t\t\t *\r\n\t\t\t * This method allows GLTFSpecularGlossinessMaterials to be cloned in the process of\r\n\t\t\t * loading a glTF model, but cloning later (e.g. by the user) would require these changes\r\n\t\t\t * AND also updating `.onBeforeRender` on the parent mesh.\r\n\t\t\t *\r\n\t\t\t * @param  {THREE.ShaderMaterial} source\r\n\t\t\t * @return {THREE.ShaderMaterial}\r\n\t\t\t */\r\n\t\t\tcloneMaterial: function ( source ) {\r\n\r\n\t\t\t\tvar target = source.clone();\r\n\r\n\t\t\t\ttarget.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n\t\t\t\tvar params = this.specularGlossinessParams;\r\n\r\n\t\t\t\tfor ( var i = 0, il = params.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\ttarget[ params[ i ] ] = source[ params[ i ] ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn target;\r\n\r\n\t\t\t},\r\n\r\n\t\t\t// Here's based on refreshUniformsCommon() and refreshUniformsStandard() in WebGLRenderer.\r\n\t\t\trefreshUniforms: function ( renderer, scene, camera, geometry, material, group ) {\r\n\r\n\t\t\t\tvar uniforms = material.uniforms;\r\n\t\t\t\tvar defines = material.defines;\r\n\r\n\t\t\t\tuniforms.opacity.value = material.opacity;\r\n\r\n\t\t\t\tuniforms.diffuse.value.copy( material.color );\r\n\t\t\t\tuniforms.emissive.value.copy( material.emissive ).multiplyScalar( material.emissiveIntensity );\r\n\r\n\t\t\t\tuniforms.map.value = material.map;\r\n\t\t\t\tuniforms.specularMap.value = material.specularMap;\r\n\t\t\t\tuniforms.alphaMap.value = material.alphaMap;\r\n\r\n\t\t\t\tuniforms.lightMap.value = material.lightMap;\r\n\t\t\t\tuniforms.lightMapIntensity.value = material.lightMapIntensity;\r\n\r\n\t\t\t\tuniforms.aoMap.value = material.aoMap;\r\n\t\t\t\tuniforms.aoMapIntensity.value = material.aoMapIntensity;\r\n\r\n\t\t\t\t// uv repeat and offset setting priorities\r\n\t\t\t\t// 1. color map\r\n\t\t\t\t// 2. specular map\r\n\t\t\t\t// 3. normal map\r\n\t\t\t\t// 4. bump map\r\n\t\t\t\t// 5. alpha map\r\n\t\t\t\t// 6. emissive map\r\n\r\n\t\t\t\tvar uvScaleMap;\r\n\r\n\t\t\t\tif ( material.map ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.map;\r\n\r\n\t\t\t\t} else if ( material.specularMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.specularMap;\r\n\r\n\t\t\t\t} else if ( material.displacementMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.displacementMap;\r\n\r\n\t\t\t\t} else if ( material.normalMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.normalMap;\r\n\r\n\t\t\t\t} else if ( material.bumpMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.bumpMap;\r\n\r\n\t\t\t\t} else if ( material.glossinessMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.glossinessMap;\r\n\r\n\t\t\t\t} else if ( material.alphaMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.alphaMap;\r\n\r\n\t\t\t\t} else if ( material.emissiveMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.emissiveMap;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( uvScaleMap !== undefined ) {\r\n\r\n\t\t\t\t\t// backwards compatibility\r\n\t\t\t\t\tif ( uvScaleMap.isWebGLRenderTarget ) {\r\n\r\n\t\t\t\t\t\tuvScaleMap = uvScaleMap.texture;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar offset;\r\n\t\t\t\t\tvar repeat;\r\n\r\n\t\t\t\t\tif ( uvScaleMap.matrix !== undefined ) {\r\n\r\n\t\t\t\t\t\t// > r88.\r\n\r\n\t\t\t\t\t\tif ( uvScaleMap.matrixAutoUpdate === true ) {\r\n\r\n\t\t\t\t\t\t\toffset = uvScaleMap.offset;\r\n\t\t\t\t\t\t\trepeat = uvScaleMap.repeat;\r\n\t\t\t\t\t\t\tvar rotation = uvScaleMap.rotation;\r\n\t\t\t\t\t\t\tvar center = uvScaleMap.center;\r\n\r\n\t\t\t\t\t\t\tuvScaleMap.matrix.setUvTransform( offset.x, offset.y, repeat.x, repeat.y, rotation, center.x, center.y );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tuniforms.uvTransform.value.copy( uvScaleMap.matrix );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// <= r87. Remove when reasonable.\r\n\r\n\t\t\t\t\t\toffset = uvScaleMap.offset;\r\n\t\t\t\t\t\trepeat = uvScaleMap.repeat;\r\n\r\n\t\t\t\t\t\tuniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuniforms.envMap.value = material.envMap;\r\n\t\t\t\tuniforms.envMapIntensity.value = material.envMapIntensity;\r\n\t\t\t\tuniforms.flipEnvMap.value = ( material.envMap && material.envMap.isCubeTexture ) ? - 1 : 1;\r\n\r\n\t\t\t\tuniforms.refractionRatio.value = material.refractionRatio;\r\n\r\n\t\t\t\tuniforms.specular.value.copy( material.specular );\r\n\t\t\t\tuniforms.glossiness.value = material.glossiness;\r\n\r\n\t\t\t\tuniforms.glossinessMap.value = material.glossinessMap;\r\n\r\n\t\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\r\n\t\t\t\tuniforms.bumpMap.value = material.bumpMap;\r\n\t\t\t\tuniforms.normalMap.value = material.normalMap;\r\n\r\n\t\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t\t\tif ( uniforms.glossinessMap.value !== null && defines.USE_GLOSSINESSMAP === undefined ) {\r\n\r\n\t\t\t\t\tdefines.USE_GLOSSINESSMAP = '';\r\n\t\t\t\t\t// set USE_ROUGHNESSMAP to enable vUv\r\n\t\t\t\t\tdefines.USE_ROUGHNESSMAP = '';\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( uniforms.glossinessMap.value === null && defines.USE_GLOSSINESSMAP !== undefined ) {\r\n\r\n\t\t\t\t\tdelete defines.USE_GLOSSINESSMAP;\r\n\t\t\t\t\tdelete defines.USE_ROUGHNESSMAP;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** INTERNALS ************/\r\n\t/*********************************/\r\n\r\n\t/* CONSTANTS */\r\n\r\n\tvar WEBGL_CONSTANTS = {\r\n\t\tFLOAT: 5126,\r\n\t\t//FLOAT_MAT2: 35674,\r\n\t\tFLOAT_MAT3: 35675,\r\n\t\tFLOAT_MAT4: 35676,\r\n\t\tFLOAT_VEC2: 35664,\r\n\t\tFLOAT_VEC3: 35665,\r\n\t\tFLOAT_VEC4: 35666,\r\n\t\tLINEAR: 9729,\r\n\t\tREPEAT: 10497,\r\n\t\tSAMPLER_2D: 35678,\r\n\t\tPOINTS: 0,\r\n\t\tLINES: 1,\r\n\t\tLINE_LOOP: 2,\r\n\t\tLINE_STRIP: 3,\r\n\t\tTRIANGLES: 4,\r\n\t\tTRIANGLE_STRIP: 5,\r\n\t\tTRIANGLE_FAN: 6,\r\n\t\tUNSIGNED_BYTE: 5121,\r\n\t\tUNSIGNED_SHORT: 5123\r\n\t};\r\n\r\n\tvar WEBGL_TYPE = {\r\n\t\t5126: Number,\r\n\t\t//35674: THREE.Matrix2,\r\n\t\t35675: THREE.Matrix3,\r\n\t\t35676: THREE.Matrix4,\r\n\t\t35664: THREE.Vector2,\r\n\t\t35665: THREE.Vector3,\r\n\t\t35666: THREE.Vector4,\r\n\t\t35678: THREE.Texture\r\n\t};\r\n\r\n\tvar WEBGL_COMPONENT_TYPES = {\r\n\t\t5120: Int8Array,\r\n\t\t5121: Uint8Array,\r\n\t\t5122: Int16Array,\r\n\t\t5123: Uint16Array,\r\n\t\t5125: Uint32Array,\r\n\t\t5126: Float32Array\r\n\t};\r\n\r\n\tvar WEBGL_FILTERS = {\r\n\t\t9728: THREE.NearestFilter,\r\n\t\t9729: THREE.LinearFilter,\r\n\t\t9984: THREE.NearestMipMapNearestFilter,\r\n\t\t9985: THREE.LinearMipMapNearestFilter,\r\n\t\t9986: THREE.NearestMipMapLinearFilter,\r\n\t\t9987: THREE.LinearMipMapLinearFilter\r\n\t};\r\n\r\n\tvar WEBGL_WRAPPINGS = {\r\n\t\t33071: THREE.ClampToEdgeWrapping,\r\n\t\t33648: THREE.MirroredRepeatWrapping,\r\n\t\t10497: THREE.RepeatWrapping\r\n\t};\r\n\r\n\tvar WEBGL_TEXTURE_FORMATS = {\r\n\t\t6406: THREE.AlphaFormat,\r\n\t\t6407: THREE.RGBFormat,\r\n\t\t6408: THREE.RGBAFormat,\r\n\t\t6409: THREE.LuminanceFormat,\r\n\t\t6410: THREE.LuminanceAlphaFormat\r\n\t};\r\n\r\n\tvar WEBGL_TEXTURE_DATATYPES = {\r\n\t\t5121: THREE.UnsignedByteType,\r\n\t\t32819: THREE.UnsignedShort4444Type,\r\n\t\t32820: THREE.UnsignedShort5551Type,\r\n\t\t33635: THREE.UnsignedShort565Type\r\n\t};\r\n\r\n\tvar WEBGL_SIDES = {\r\n\t\t1028: THREE.BackSide, // Culling front\r\n\t\t1029: THREE.FrontSide // Culling back\r\n\t\t//1032: THREE.NoSide   // Culling front and back, what to do?\r\n\t};\r\n\r\n\tvar WEBGL_DEPTH_FUNCS = {\r\n\t\t512: THREE.NeverDepth,\r\n\t\t513: THREE.LessDepth,\r\n\t\t514: THREE.EqualDepth,\r\n\t\t515: THREE.LessEqualDepth,\r\n\t\t516: THREE.GreaterEqualDepth,\r\n\t\t517: THREE.NotEqualDepth,\r\n\t\t518: THREE.GreaterEqualDepth,\r\n\t\t519: THREE.AlwaysDepth\r\n\t};\r\n\r\n\tvar WEBGL_BLEND_EQUATIONS = {\r\n\t\t32774: THREE.AddEquation,\r\n\t\t32778: THREE.SubtractEquation,\r\n\t\t32779: THREE.ReverseSubtractEquation\r\n\t};\r\n\r\n\tvar WEBGL_BLEND_FUNCS = {\r\n\t\t0: THREE.ZeroFactor,\r\n\t\t1: THREE.OneFactor,\r\n\t\t768: THREE.SrcColorFactor,\r\n\t\t769: THREE.OneMinusSrcColorFactor,\r\n\t\t770: THREE.SrcAlphaFactor,\r\n\t\t771: THREE.OneMinusSrcAlphaFactor,\r\n\t\t772: THREE.DstAlphaFactor,\r\n\t\t773: THREE.OneMinusDstAlphaFactor,\r\n\t\t774: THREE.DstColorFactor,\r\n\t\t775: THREE.OneMinusDstColorFactor,\r\n\t\t776: THREE.SrcAlphaSaturateFactor\r\n\t\t// The followings are not supported by Three.js yet\r\n\t\t//32769: CONSTANT_COLOR,\r\n\t\t//32770: ONE_MINUS_CONSTANT_COLOR,\r\n\t\t//32771: CONSTANT_ALPHA,\r\n\t\t//32772: ONE_MINUS_CONSTANT_COLOR\r\n\t};\r\n\r\n\tvar WEBGL_TYPE_SIZES = {\r\n\t\t'SCALAR': 1,\r\n\t\t'VEC2': 2,\r\n\t\t'VEC3': 3,\r\n\t\t'VEC4': 4,\r\n\t\t'MAT2': 4,\r\n\t\t'MAT3': 9,\r\n\t\t'MAT4': 16\r\n\t};\r\n\r\n\tvar PATH_PROPERTIES = {\r\n\t\tscale: 'scale',\r\n\t\ttranslation: 'position',\r\n\t\trotation: 'quaternion',\r\n\t\tweights: 'morphTargetInfluences'\r\n\t};\r\n\r\n\tvar INTERPOLATION = {\r\n\t\tCUBICSPLINE: THREE.InterpolateSmooth,\r\n\t\tLINEAR: THREE.InterpolateLinear,\r\n\t\tSTEP: THREE.InterpolateDiscrete\r\n\t};\r\n\r\n\tvar STATES_ENABLES = {\r\n\t\t2884: 'CULL_FACE',\r\n\t\t2929: 'DEPTH_TEST',\r\n\t\t3042: 'BLEND',\r\n\t\t3089: 'SCISSOR_TEST',\r\n\t\t32823: 'POLYGON_OFFSET_FILL',\r\n\t\t32926: 'SAMPLE_ALPHA_TO_COVERAGE'\r\n\t};\r\n\r\n\tvar ALPHA_MODES = {\r\n\t\tOPAQUE: 'OPAQUE',\r\n\t\tMASK: 'MASK',\r\n\t\tBLEND: 'BLEND'\r\n\t};\r\n\r\n\t/* UTILITY FUNCTIONS */\r\n\r\n\tfunction resolveURL( url, path ) {\r\n\r\n\t\t// Invalid URL\r\n\t\tif ( typeof url !== 'string' || url === '' ) return '';\r\n\r\n\t\t// Absolute URL http://,https://,//\r\n\t\tif ( /^(https?:)?\\/\\//i.test( url ) ) return url;\r\n\r\n\t\t// Data URI\r\n\t\tif ( /^data:.*,.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Blob URL\r\n\t\tif ( /^blob:.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Relative URL\r\n\t\treturn path + url;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\r\n\t */\r\n\tfunction createDefaultMaterial() {\r\n\r\n\t\treturn new THREE.MeshStandardMaterial( {\r\n\t\t\tcolor: 0xFFFFFF,\r\n\t\t\temissive: 0x000000,\r\n\t\t\tmetalness: 1,\r\n\t\t\troughness: 1,\r\n\t\t\ttransparent: false,\r\n\t\t\tdepthTest: true,\r\n\t\t\tside: THREE.FrontSide\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\r\n\t *\r\n\t * TODO: Implement support for morph targets on TANGENT attribute.\r\n\t *\r\n\t * @param {THREE.Mesh} mesh\r\n\t * @param {GLTF.Mesh} meshDef\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {Array<THREE.BufferAttribute>} accessors\r\n\t */\r\n\tfunction addMorphTargets( mesh, meshDef, primitiveDef, accessors ) {\r\n\r\n\t\tvar geometry = mesh.geometry;\r\n\t\tvar material = mesh.material;\r\n\r\n\t\tvar targets = primitiveDef.targets;\r\n\t\tvar morphAttributes = geometry.morphAttributes;\r\n\r\n\t\tmorphAttributes.position = [];\r\n\t\tmorphAttributes.normal = [];\r\n\r\n\t\tmaterial.morphTargets = true;\r\n\r\n\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar target = targets[ i ];\r\n\t\t\tvar attributeName = 'morphTarget' + i;\r\n\r\n\t\t\tvar positionAttribute, normalAttribute;\r\n\r\n\t\t\tif ( target.POSITION !== undefined ) {\r\n\r\n\t\t\t\t// Three.js morph formula is\r\n\t\t\t\t//   position\r\n\t\t\t\t//     + weight0 * ( morphTarget0 - position )\r\n\t\t\t\t//     + weight1 * ( morphTarget1 - position )\r\n\t\t\t\t//     ...\r\n\t\t\t\t// while the glTF one is\r\n\t\t\t\t//   position\r\n\t\t\t\t//     + weight0 * morphTarget0\r\n\t\t\t\t//     + weight1 * morphTarget1\r\n\t\t\t\t//     ...\r\n\t\t\t\t// then adding position to morphTarget.\r\n\t\t\t\t// So morphTarget value will depend on mesh's position, then cloning attribute\r\n\t\t\t\t// for the case if attribute is shared among two or more meshes.\r\n\r\n\t\t\t\tpositionAttribute = accessors[ target.POSITION ].clone();\r\n\t\t\t\tvar position = geometry.attributes.position;\r\n\r\n\t\t\t\tfor ( var j = 0, jl = positionAttribute.count; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tpositionAttribute.setXYZ(\r\n\t\t\t\t\t\tj,\r\n\t\t\t\t\t\tpositionAttribute.getX( j ) + position.getX( j ),\r\n\t\t\t\t\t\tpositionAttribute.getY( j ) + position.getY( j ),\r\n\t\t\t\t\t\tpositionAttribute.getZ( j ) + position.getZ( j )\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( geometry.attributes.position ) {\r\n\r\n\t\t\t\t// Copying the original position not to affect the final position.\r\n\t\t\t\t// See the formula above.\r\n\t\t\t\tpositionAttribute = geometry.attributes.position.clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( positionAttribute !== undefined ) {\r\n\r\n\t\t\t\tpositionAttribute.name = attributeName;\r\n\t\t\t\tmorphAttributes.position.push( positionAttribute );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( target.NORMAL !== undefined ) {\r\n\r\n\t\t\t\tmaterial.morphNormals = true;\r\n\r\n\t\t\t\t// see target.POSITION's comment\r\n\r\n\t\t\t\tnormalAttribute = accessors[ target.NORMAL ].clone();\r\n\t\t\t\tvar normal = geometry.attributes.normal;\r\n\r\n\t\t\t\tfor ( var j = 0, jl = normalAttribute.count; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tnormalAttribute.setXYZ(\r\n\t\t\t\t\t\tj,\r\n\t\t\t\t\t\tnormalAttribute.getX( j ) + normal.getX( j ),\r\n\t\t\t\t\t\tnormalAttribute.getY( j ) + normal.getY( j ),\r\n\t\t\t\t\t\tnormalAttribute.getZ( j ) + normal.getZ( j )\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( geometry.attributes.normal !== undefined ) {\r\n\r\n\t\t\t\tnormalAttribute = geometry.attributes.normal.clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( normalAttribute !== undefined ) {\r\n\r\n\t\t\t\tnormalAttribute.name = attributeName;\r\n\t\t\t\tmorphAttributes.normal.push( normalAttribute );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tmesh.updateMorphTargets();\r\n\r\n\t\tif ( meshDef.weights !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, il = meshDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction isPrimitiveEqual( a, b ) {\r\n\r\n\t\tif ( a.indices !== b.indices ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\tvar attribA = a.attributes || {};\r\n\t\tvar attribB = b.attributes || {};\r\n\t\tvar keysA = Object.keys( attribA );\r\n\t\tvar keysB = Object.keys( attribB );\r\n\r\n\t\tif ( keysA.length !== keysB.length ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = keysA.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar key = keysA[ i ];\r\n\r\n\t\t\tif ( attribA[ key ] !== attribB[ key ] ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tfunction getCachedGeometry( cache, newPrimitive ) {\r\n\r\n\t\tfor ( var i = 0, il = cache.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar cached = cache[ i ];\r\n\r\n\t\t\tif ( isPrimitiveEqual( cached.primitive, newPrimitive ) ) {\r\n\r\n\t\t\t\treturn cached.geometry;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t/* GLTF PARSER */\r\n\r\n\tfunction GLTFParser( json, extensions, options ) {\r\n\r\n\t\tthis.json = json || {};\r\n\t\tthis.extensions = extensions || {};\r\n\t\tthis.options = options || {};\r\n\r\n\t\t// loader object cache\r\n\t\tthis.cache = new GLTFRegistry();\r\n\r\n\t\t// BufferGeometry caching\r\n\t\tthis.primitiveCache = [];\r\n\r\n\t\tthis.textureLoader = new THREE.TextureLoader( this.options.manager );\r\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\r\n\r\n\t\tthis.fileLoader = new THREE.FileLoader( this.options.manager );\r\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\r\n\r\n\t}\r\n\r\n\tGLTFParser.prototype.parse = function ( onLoad, onError ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar parser = this;\r\n\r\n\t\t// Clear the loader cache\r\n\t\tthis.cache.removeAll();\r\n\r\n\t\t// Mark the special nodes/meshes in json for efficient parse\r\n\t\tthis.markDefs();\r\n\r\n\t\t// Fire the callback on complete\r\n\t\tthis.getMultiDependencies( [\r\n\r\n\t\t\t'scene',\r\n\t\t\t'animation',\r\n\t\t\t'camera'\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar scenes = dependencies.scenes || [];\r\n\t\t\tvar scene = scenes[ json.scene || 0 ];\r\n\t\t\tvar animations = dependencies.animations || [];\r\n\t\t\tvar asset = json.asset;\r\n\t\t\tvar cameras = dependencies.cameras || [];\r\n\r\n\t\t\tonLoad( scene, scenes, cameras, animations, asset );\r\n\r\n\t\t} ).catch( onError );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Marks the special nodes/meshes in json for efficient parse.\r\n\t */\r\n\tGLTFParser.prototype.markDefs = function () {\r\n\r\n\t\tvar nodeDefs = this.json.nodes || [];\r\n\t\tvar skinDefs = this.json.skins || [];\r\n\t\tvar meshDefs = this.json.meshes || [];\r\n\r\n\t\tvar meshReferences = {};\r\n\t\tvar meshUses = {};\r\n\r\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\r\n\t\t// Object3D. Use the skins' joint references to mark bones.\r\n\t\tfor ( var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\r\n\r\n\t\t\tvar joints = skinDefs[ skinIndex ].joints;\r\n\r\n\t\t\tfor ( var i = 0, il = joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Meshes can (and should) be reused by multiple nodes in a glTF asset. To\r\n\t\t// avoid having more than one THREE.Mesh with the same name, count\r\n\t\t// references and rename instances below.\r\n\t\t//\r\n\t\t// Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\r\n\t\tfor ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\r\n\r\n\t\t\tvar nodeDef = nodeDefs[ nodeIndex ];\r\n\r\n\t\t\tif ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tif ( meshReferences[ nodeDef.mesh ] === undefined ) {\r\n\r\n\t\t\t\t\tmeshReferences[ nodeDef.mesh ] = meshUses[ nodeDef.mesh ] = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmeshReferences[ nodeDef.mesh ] ++;\r\n\r\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\r\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\r\n\t\t\t\t// to mark SkinnedMesh if node has skin.\r\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\r\n\r\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.json.meshReferences = meshReferences;\r\n\t\tthis.json.meshUses = meshUses;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests the specified dependency asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @param {number} index\r\n\t * @return {Promise<Object>}\r\n\t */\r\n\tGLTFParser.prototype.getDependency = function ( type, index ) {\r\n\r\n\t\tvar cacheKey = type + ':' + index;\r\n\t\tvar dependency = this.cache.get( cacheKey );\r\n\r\n\t\tif ( ! dependency ) {\r\n\r\n\t\t\tvar fnName = 'load' + type.charAt( 0 ).toUpperCase() + type.slice( 1 );\r\n\t\t\tdependency = this[ fnName ]( index );\r\n\t\t\tthis.cache.add( cacheKey, dependency );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependency;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests all dependencies of the specified type asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @return {Promise<Array<Object>>}\r\n\t */\r\n\tGLTFParser.prototype.getDependencies = function ( type ) {\r\n\r\n\t\tvar dependencies = this.cache.get( type );\r\n\r\n\t\tif ( ! dependencies ) {\r\n\r\n\t\t\tvar parser = this;\r\n\t\t\tvar defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\r\n\r\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\r\n\r\n\t\t\t\treturn parser.getDependency( type, index );\r\n\r\n\t\t\t} ) );\r\n\r\n\t\t\tthis.cache.add( type, dependencies );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependencies;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests all multiple dependencies of the specified types asynchronously, with caching.\r\n\t * @param {Array<string>} types\r\n\t * @return {Promise<Object<Array<Object>>>}\r\n\t */\r\n\tGLTFParser.prototype.getMultiDependencies = function ( types ) {\r\n\r\n\t\tvar results = {};\r\n\t\tvar pendings = [];\r\n\r\n\t\tfor ( var i = 0, il = types.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar type = types[ i ];\r\n\t\t\tvar value = this.getDependencies( type );\r\n\r\n\t\t\tvalue = value.then( function ( key, value ) {\r\n\r\n\t\t\t\tresults[ key ] = value;\r\n\r\n\t\t\t}.bind( this, type + ( type === 'mesh' ? 'es' : 's' ) ) );\r\n\r\n\t\t\tpendings.push( value );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pendings ).then( function () {\r\n\r\n\t\t\treturn results;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBuffer = function ( bufferIndex ) {\r\n\r\n\t\tvar bufferDef = this.json.buffers[ bufferIndex ];\r\n\t\tvar loader = this.fileLoader;\r\n\r\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\r\n\r\n\t\t}\r\n\r\n\t\t// If present, GLB container is required to be the first buffer.\r\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\r\n\r\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\r\n\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\tloader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\r\n\r\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferViewIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBufferView = function ( bufferViewIndex ) {\r\n\r\n\t\tvar bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\r\n\r\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\r\n\r\n\t\t\tvar byteLength = bufferViewDef.byteLength || 0;\r\n\t\t\tvar byteOffset = bufferViewDef.byteOffset || 0;\r\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\r\n\t * @param {number} accessorIndex\r\n\t * @return {Promise<THREE.BufferAttribute|THREE.InterleavedBufferAttribute>}\r\n\t */\r\n\tGLTFParser.prototype.loadAccessor = function ( accessorIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar accessorDef = this.json.accessors[ accessorIndex ];\r\n\r\n\t\tvar pendingBufferViews = [];\r\n\r\n\t\tif ( accessorDef.bufferView !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tpendingBufferViews.push( null );\r\n\r\n\t\t}\r\n\r\n\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\r\n\r\n\t\t\tvar bufferView = bufferViews[ 0 ];\r\n\r\n\t\t\tvar itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\r\n\t\t\tvar TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\r\n\t\t\tvar elementBytes = TypedArray.BYTES_PER_ELEMENT;\r\n\t\t\tvar itemBytes = elementBytes * itemSize;\r\n\t\t\tvar byteStride = json.bufferViews[ accessorDef.bufferView ].byteStride;\r\n\t\t\tvar normalized = accessorDef.normalized === true;\r\n\t\t\tvar array, bufferAttribute;\r\n\r\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\r\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\r\n\r\n\t\t\t\t// Use the full buffer if it's interleaved.\r\n\t\t\t\tarray = new TypedArray( bufferView );\r\n\r\n\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\r\n\t\t\t\tvar ib = new THREE.InterleavedBuffer( array, byteStride / elementBytes );\r\n\r\n\t\t\t\tbufferAttribute = new THREE.InterleavedBufferAttribute( ib, itemSize, accessorDef.byteOffset / elementBytes, normalized );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( bufferView === null ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, accessorDef.byteOffset, accessorDef.count * itemSize );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new THREE.BufferAttribute( array, itemSize, normalized );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\r\n\t\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\t\tvar itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\r\n\t\t\t\tvar TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\r\n\r\n\t\t\t\tvar byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\r\n\t\t\t\tvar byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\r\n\r\n\t\t\t\tvar sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\r\n\t\t\t\tvar sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\r\n\r\n\t\t\t\tif ( bufferView !== null ) {\r\n\r\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\r\n\t\t\t\t\tbufferAttribute.setArray( bufferAttribute.array.slice() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var i = 0, il = sparseIndices.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar index = sparseIndices[ i ];\r\n\r\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\r\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\r\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\r\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\r\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn bufferAttribute;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\r\n\t * @param {number} textureIndex\r\n\t * @return {Promise<THREE.Texture>}\r\n\t */\r\n\tGLTFParser.prototype.loadTexture = function ( textureIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar options = this.options;\r\n\t\tvar textureLoader = this.textureLoader;\r\n\r\n\t\tvar URL = window.URL || window.webkitURL;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\t\tvar source = json.images[ textureDef.source ];\r\n\t\tvar sourceURI = source.uri;\r\n\t\tvar isObjectURL = false;\r\n\r\n\t\tif ( source.bufferView !== undefined ) {\r\n\r\n\t\t\t// Load binary image data from bufferView, if provided.\r\n\r\n\t\t\tsourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\r\n\r\n\t\t\t\tisObjectURL = true;\r\n\t\t\t\tvar blob = new Blob( [ bufferView ], { type: source.mimeType } );\r\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\r\n\t\t\t\treturn sourceURI;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve( sourceURI ).then( function ( sourceURI ) {\r\n\r\n\t\t\t// Load Texture resource.\r\n\r\n\t\t\tvar loader = THREE.Loader.Handlers.get( sourceURI ) || textureLoader;\r\n\r\n\t\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\t\tloader.load( resolveURL( sourceURI, options.path ), resolve, undefined, reject );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} ).then( function ( texture ) {\r\n\r\n\t\t\t// Clean up resources and configure Texture.\r\n\r\n\t\t\tif ( isObjectURL === true ) {\r\n\r\n\t\t\t\tURL.revokeObjectURL( sourceURI );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.flipY = false;\r\n\r\n\t\t\tif ( textureDef.name !== undefined ) texture.name = textureDef.name;\r\n\r\n\t\t\ttexture.format = textureDef.format !== undefined ? WEBGL_TEXTURE_FORMATS[ textureDef.format ] : THREE.RGBAFormat;\r\n\r\n\t\t\tif ( textureDef.internalFormat !== undefined && texture.format !== WEBGL_TEXTURE_FORMATS[ textureDef.internalFormat ] ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. ' +\r\n\t\t\t\t\t\t\t\t\t\t\t'internalFormat will be forced to be the same value as format.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.type = textureDef.type !== undefined ? WEBGL_TEXTURE_DATATYPES[ textureDef.type ] : THREE.UnsignedByteType;\r\n\r\n\t\t\tvar samplers = json.samplers || {};\r\n\t\t\tvar sampler = samplers[ textureDef.sampler ] || {};\r\n\r\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || THREE.LinearFilter;\r\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || THREE.LinearMipMapLinearFilter;\r\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || THREE.RepeatWrapping;\r\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || THREE.RepeatWrapping;\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Asynchronously assigns a texture to the given material parameters.\r\n\t * @param {Object} materialParams\r\n\t * @param {string} textureName\r\n\t * @param {number} textureIndex\r\n\t * @return {Promise}\r\n\t */\r\n\tGLTFParser.prototype.assignTexture = function ( materialParams, textureName, textureIndex ) {\r\n\r\n\t\treturn this.getDependency( 'texture', textureIndex ).then( function ( texture ) {\r\n\r\n\t\t\tmaterialParams[ textureName ] = texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\r\n\t * @param {number} materialIndex\r\n\t * @return {Promise<THREE.Material>}\r\n\t */\r\n\tGLTFParser.prototype.loadMaterial = function ( materialIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar materialDef = this.json.materials[ materialIndex ];\r\n\r\n\t\tvar materialType;\r\n\t\tvar materialParams = {};\r\n\t\tvar materialExtensions = materialDef.extensions || {};\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] ) {\r\n\r\n\t\t\tvar khcExtension = extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ];\r\n\t\t\tmaterialType = khcExtension.getMaterialType( materialDef );\r\n\t\t\tpending.push( khcExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\r\n\r\n\t\t\tvar sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\r\n\t\t\tmaterialType = sgExtension.getMaterialType( materialDef );\r\n\t\t\tpending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else if ( materialDef.pbrMetallicRoughness !== undefined ) {\r\n\r\n\t\t\t// Specification:\r\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\r\n\r\n\t\t\tmaterialType = THREE.MeshStandardMaterial;\r\n\r\n\t\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness;\r\n\r\n\t\t\tmaterialParams.color = new THREE.Color( 1.0, 1.0, 1.0 );\r\n\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture.index ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\r\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\r\n\r\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\r\n\r\n\t\t\t\tvar textureIndex = metallicRoughness.metallicRoughnessTexture.index;\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', textureIndex ) );\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', textureIndex ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterialType = THREE.MeshPhongMaterial;\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.doubleSided === true ) {\r\n\r\n\t\t\tmaterialParams.side = THREE.DoubleSide;\r\n\r\n\t\t}\r\n\r\n\t\tvar alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\r\n\r\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\r\n\r\n\t\t\tmaterialParams.transparent = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterialParams.transparent = false;\r\n\r\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\r\n\r\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.normalTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture.index ) );\r\n\r\n\t\t\tmaterialParams.normalScale = new THREE.Vector2( 1, 1 );\r\n\r\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.normalScale.set( materialDef.normalTexture.scale, materialDef.normalTexture.scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.occlusionTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture.index ) );\r\n\r\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveFactor !== undefined ) {\r\n\r\n\t\t\tif ( materialType === THREE.MeshBasicMaterial ) {\r\n\r\n\t\t\t\tmaterialParams.color = new THREE.Color().fromArray( materialDef.emissiveFactor );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterialParams.emissive = new THREE.Color().fromArray( materialDef.emissiveFactor );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveTexture !== undefined ) {\r\n\r\n\t\t\tif ( materialType === THREE.MeshBasicMaterial ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', materialDef.emissiveTexture.index ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture.index ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\tvar material;\r\n\r\n\t\t\tif ( materialType === THREE.ShaderMaterial ) {\r\n\r\n\t\t\t\tmaterial = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterial = new materialType( materialParams );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialDef.name !== undefined ) material.name = materialDef.name;\r\n\r\n\t\t\t// Normal map textures use OpenGL conventions:\r\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#materialnormaltexture\r\n\t\t\tif ( material.normalScale ) {\r\n\r\n\t\t\t\tmaterial.normalScale.x = - material.normalScale.x;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// emissiveTexture and baseColorTexture use sRGB encoding.\r\n\t\t\tif ( material.map ) material.map.encoding = THREE.sRGBEncoding;\r\n\t\t\tif ( material.emissiveMap ) material.emissiveMap.encoding = THREE.sRGBEncoding;\r\n\r\n\t\t\tif ( materialDef.extras ) material.userData = materialDef.extras;\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\r\n\t * @param {Array<Object>} primitives\r\n\t * @return {Promise<Array<THREE.BufferGeometry>>}\r\n\t */\r\n\tGLTFParser.prototype.loadGeometries = function ( primitives ) {\r\n\r\n\t\tvar cache = this.primitiveCache;\r\n\r\n\t\treturn this.getDependencies( 'accessor' ).then( function ( accessors ) {\r\n\r\n\t\t\tvar geometries = [];\r\n\r\n\t\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar primitive = primitives[ i ];\r\n\r\n\t\t\t\t// See if we've already created this geometry\r\n\t\t\t\tvar cached = getCachedGeometry( cache, primitive );\r\n\r\n\t\t\t\tif ( cached ) {\r\n\r\n\t\t\t\t\t// Use the cached geometry if it exists\r\n\t\t\t\t\tgeometries.push( cached );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Otherwise create a new geometry\r\n\t\t\t\t\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\t\t\t\t\tvar attributes = primitive.attributes;\r\n\r\n\t\t\t\t\tfor ( var attributeId in attributes ) {\r\n\r\n\t\t\t\t\t\tvar attributeEntry = attributes[ attributeId ];\r\n\r\n\t\t\t\t\t\tvar bufferAttribute = accessors[ attributeEntry ];\r\n\r\n\t\t\t\t\t\tswitch ( attributeId ) {\r\n\r\n\t\t\t\t\t\t\tcase 'POSITION':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'position', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'NORMAL':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'normal', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'TEXCOORD_0':\r\n\t\t\t\t\t\t\tcase 'TEXCOORD0':\r\n\t\t\t\t\t\t\tcase 'TEXCOORD':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'uv', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'TEXCOORD_1':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'uv2', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'COLOR_0':\r\n\t\t\t\t\t\t\tcase 'COLOR0':\r\n\t\t\t\t\t\t\tcase 'COLOR':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'color', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'WEIGHTS_0':\r\n\t\t\t\t\t\t\tcase 'WEIGHT': // WEIGHT semantic deprecated.\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'skinWeight', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'JOINTS_0':\r\n\t\t\t\t\t\t\tcase 'JOINT': // JOINT semantic deprecated.\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'skinIndex', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( primitive.indices !== undefined ) {\r\n\r\n\t\t\t\t\t\tgeometry.setIndex( accessors[ primitive.indices ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Cache this geometry\r\n\t\t\t\t\tcache.push( {\r\n\r\n\t\t\t\t\t\tprimitive: primitive,\r\n\t\t\t\t\t\tgeometry: geometry\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\tgeometries.push( geometry );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn geometries;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\r\n\t * @param {number} meshIndex\r\n\t * @return {Promise<THREE.Group|THREE.Mesh|THREE.SkinnedMesh>}\r\n\t */\r\n\tGLTFParser.prototype.loadMesh = function ( meshIndex ) {\r\n\r\n\t\tvar scope = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\tvar meshDef = this.json.meshes[ meshIndex ];\r\n\r\n\t\treturn this.getMultiDependencies( [\r\n\r\n\t\t\t'accessor',\r\n\t\t\t'material'\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar group = new THREE.Group();\r\n\r\n\t\t\tvar primitives = meshDef.primitives;\r\n\r\n\t\t\treturn scope.loadGeometries( primitives ).then( function ( geometries ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar primitive = primitives[ i ];\r\n\t\t\t\t\tvar geometry = geometries[ i ];\r\n\r\n\t\t\t\t\tvar material = primitive.material === undefined\r\n\t\t\t\t\t\t? createDefaultMaterial()\r\n\t\t\t\t\t\t: dependencies.materials[ primitive.material ];\r\n\r\n\t\t\t\t\tif ( material.aoMap\r\n\t\t\t\t\t\t\t&& geometry.attributes.uv2 === undefined\r\n\t\t\t\t\t\t\t&& geometry.attributes.uv !== undefined ) {\r\n\r\n\t\t\t\t\t\tconsole.log( 'THREE.GLTFLoader: Duplicating UVs to support aoMap.' );\r\n\t\t\t\t\t\tgeometry.addAttribute( 'uv2', new THREE.BufferAttribute( geometry.attributes.uv.array, 2 ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the material will be modified later on, clone it now.\r\n\t\t\t\t\tvar useVertexColors = geometry.attributes.color !== undefined;\r\n\t\t\t\t\tvar useFlatShading = geometry.attributes.normal === undefined;\r\n\t\t\t\t\tvar useSkinning = meshDef.isSkinnedMesh === true;\r\n\t\t\t\t\tvar useMorphTargets = primitive.targets !== undefined;\r\n\r\n\t\t\t\t\tif ( useVertexColors || useFlatShading || useSkinning || useMorphTargets ) {\r\n\r\n\t\t\t\t\t\tif ( material.isGLTFSpecularGlossinessMaterial ) {\r\n\r\n\t\t\t\t\t\t\tvar specGlossExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\r\n\t\t\t\t\t\t\tmaterial = specGlossExtension.cloneMaterial( material );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tmaterial = material.clone();\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( useVertexColors ) {\r\n\r\n\t\t\t\t\t\tmaterial.vertexColors = THREE.VertexColors;\r\n\t\t\t\t\t\tmaterial.needsUpdate = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( useFlatShading ) {\r\n\r\n\t\t\t\t\t\tmaterial.flatShading = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar mesh;\r\n\r\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\r\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\r\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\r\n\t\t\t\t\t\tprimitive.mode === undefined ) {\r\n\r\n\t\t\t\t\t\tif ( useSkinning ) {\r\n\r\n\t\t\t\t\t\t\tmesh = new THREE.SkinnedMesh( geometry, material );\r\n\t\t\t\t\t\t\tmaterial.skinning = true;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tmesh = new THREE.Mesh( geometry, material );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\r\n\r\n\t\t\t\t\t\t\tmesh.drawMode = THREE.TriangleStripDrawMode;\r\n\r\n\t\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\r\n\r\n\t\t\t\t\t\t\tmesh.drawMode = THREE.TriangleFanDrawMode;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\r\n\r\n\t\t\t\t\t\tmesh = new THREE.LineSegments( geometry, material );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\r\n\r\n\t\t\t\t\t\tmesh = new THREE.Line( geometry, material );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\r\n\r\n\t\t\t\t\t\tmesh = new THREE.LineLoop( geometry, material );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\r\n\r\n\t\t\t\t\t\tmesh = new THREE.Points( geometry, material );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmesh.name = meshDef.name || ( 'mesh_' + meshIndex );\r\n\r\n\t\t\t\t\tif ( useMorphTargets ) {\r\n\r\n\t\t\t\t\t\taddMorphTargets( mesh, meshDef, primitive, dependencies.accessors );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( meshDef.extras !== undefined ) mesh.userData = meshDef.extras;\r\n\t\t\t\t\tif ( primitive.extras !== undefined ) mesh.geometry.userData = primitive.extras;\r\n\r\n\t\t\t\t\t// for Specular-Glossiness.\r\n\t\t\t\t\tif ( material.isGLTFSpecularGlossinessMaterial === true ) {\r\n\r\n\t\t\t\t\t\tmesh.onBeforeRender = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].refreshUniforms;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( primitives.length > 1 ) {\r\n\r\n\t\t\t\t\t\tmesh.name += '_' + i;\r\n\r\n\t\t\t\t\t\tgroup.add( mesh );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\treturn mesh;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn group;\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\r\n\t * @param {number} cameraIndex\r\n\t * @return {Promise<THREE.Camera>}\r\n\t */\r\n\tGLTFParser.prototype.loadCamera = function ( cameraIndex ) {\r\n\r\n\t\tvar camera;\r\n\t\tvar cameraDef = this.json.cameras[ cameraIndex ];\r\n\t\tvar params = cameraDef[ cameraDef.type ];\r\n\r\n\t\tif ( ! params ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.type === 'perspective' ) {\r\n\r\n\t\t\tvar aspectRatio = params.aspectRatio || 1;\r\n\t\t\tvar xfov = params.yfov * aspectRatio;\r\n\r\n\t\t\tcamera = new THREE.PerspectiveCamera( THREE.Math.radToDeg( xfov ), aspectRatio, params.znear || 1, params.zfar || 2e6 );\r\n\r\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\r\n\r\n\t\t\tcamera = new THREE.OrthographicCamera( params.xmag / - 2, params.xmag / 2, params.ymag / 2, params.ymag / - 2, params.znear, params.zfar );\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.name !== undefined ) camera.name = cameraDef.name;\r\n\t\tif ( cameraDef.extras ) camera.userData = cameraDef.extras;\r\n\r\n\t\treturn Promise.resolve( camera );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\r\n\t * @param {number} skinIndex\r\n\t * @return {Promise<Object>}\r\n\t */\r\n\tGLTFParser.prototype.loadSkin = function ( skinIndex ) {\r\n\r\n\t\tvar skinDef = this.json.skins[ skinIndex ];\r\n\r\n\t\tvar skinEntry = { joints: skinDef.joints };\r\n\r\n\t\tif ( skinDef.inverseBindMatrices === undefined ) {\r\n\r\n\t\t\treturn Promise.resolve( skinEntry );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\r\n\r\n\t\t\tskinEntry.inverseBindMatrices = accessor;\r\n\r\n\t\t\treturn skinEntry;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\r\n\t * @param {number} animationIndex\r\n\t * @return {Promise<THREE.AnimationClip>}\r\n\t */\r\n\tGLTFParser.prototype.loadAnimation = function ( animationIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar animationDef = this.json.animations[ animationIndex ];\r\n\r\n\t\treturn this.getMultiDependencies( [\r\n\r\n\t\t\t'accessor',\r\n\t\t\t'node'\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tfor ( var i = 0, il = animationDef.channels.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar channel = animationDef.channels[ i ];\r\n\t\t\t\tvar sampler = animationDef.samplers[ channel.sampler ];\r\n\r\n\t\t\t\tif ( sampler ) {\r\n\r\n\t\t\t\t\tvar target = channel.target;\r\n\t\t\t\t\tvar name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\r\n\t\t\t\t\tvar input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\r\n\t\t\t\t\tvar output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\r\n\r\n\t\t\t\t\tvar inputAccessor = dependencies.accessors[ input ];\r\n\t\t\t\t\tvar outputAccessor = dependencies.accessors[ output ];\r\n\r\n\t\t\t\t\tvar node = dependencies.nodes[ name ];\r\n\r\n\t\t\t\t\tif ( node ) {\r\n\r\n\t\t\t\t\t\tnode.updateMatrix();\r\n\t\t\t\t\t\tnode.matrixAutoUpdate = true;\r\n\r\n\t\t\t\t\t\tvar TypedKeyframeTrack;\r\n\r\n\t\t\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\r\n\r\n\t\t\t\t\t\t\tcase PATH_PROPERTIES.weights:\r\n\r\n\t\t\t\t\t\t\t\tTypedKeyframeTrack = THREE.NumberKeyframeTrack;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase PATH_PROPERTIES.rotation:\r\n\r\n\t\t\t\t\t\t\t\tTypedKeyframeTrack = THREE.QuaternionKeyframeTrack;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase PATH_PROPERTIES.position:\r\n\t\t\t\t\t\t\tcase PATH_PROPERTIES.scale:\r\n\t\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\t\tTypedKeyframeTrack = THREE.VectorKeyframeTrack;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar targetName = node.name ? node.name : node.uuid;\r\n\r\n\t\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\r\n\r\n\t\t\t\t\t\t\tvar itemSize = outputAccessor.itemSize;\r\n\t\t\t\t\t\t\tvar TypedArray = outputAccessor.array.constructor;\r\n\t\t\t\t\t\t\tvar outputAccessorValues = new TypedArray( outputAccessor.count * itemSize / 3 );\r\n\r\n\t\t\t\t\t\t\t// Layout of keyframe output values for CUBICSPLINE animations:\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\t//   [ inTangent1, splineVertex1, outTangent1, inTangent2, splineVertex2, ... ]\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\t// THREE.KeyframeTrack infers tangents from the spline vertices when interpolating:\r\n\t\t\t\t\t\t\t// those values are extracted below. This still guarantees smooth curves, but does\r\n\t\t\t\t\t\t\t// throw away more precise information in the tangents. In the future, consider\r\n\t\t\t\t\t\t\t// re-sampling at a higher framerate using the tangents provided.\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\t// See: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\r\n\r\n\t\t\t\t\t\t\tfor ( var j = 0, jl = outputAccessor.count; j < jl; j += 3 ) {\r\n\r\n\t\t\t\t\t\t\t\toutputAccessorValues[ j * itemSize / 3 ] = outputAccessor.getX( j + 1 );\r\n\t\t\t\t\t\t\t\tif ( itemSize > 1 ) outputAccessorValues[ j * itemSize / 3 + 1 ] = outputAccessor.getY( j + 1 );\r\n\t\t\t\t\t\t\t\tif ( itemSize > 2 ) outputAccessorValues[ j * itemSize / 3 + 2 ] = outputAccessor.getZ( j + 1 );\r\n\t\t\t\t\t\t\t\tif ( itemSize > 3 ) outputAccessorValues[ j * itemSize / 3 + 3 ] = outputAccessor.getW( j + 1 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\toutputAccessor = new THREE.BufferAttribute( outputAccessorValues, itemSize / 3, outputAccessor.normalized );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : THREE.InterpolateLinear;\r\n\r\n\t\t\t\t\t\tvar targetNames = [];\r\n\r\n\t\t\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\r\n\r\n\t\t\t\t\t\t\t// node should be THREE.Group here but\r\n\t\t\t\t\t\t\t// PATH_PROPERTIES.weights(morphTargetInfluences) should be\r\n\t\t\t\t\t\t\t// the property of a mesh object under node.\r\n\t\t\t\t\t\t\t// So finding targets here.\r\n\r\n\t\t\t\t\t\t\tnode.traverse( function ( object ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( object.isMesh === true && object.material.morphTargets === true ) {\r\n\r\n\t\t\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\ttargetNames.push( targetName );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// KeyframeTrack.optimize() will modify given 'times' and 'values'\r\n\t\t\t\t\t\t// buffers before creating a truncated copy to keep. Because buffers may\r\n\t\t\t\t\t\t// be reused by other tracks, make copies here.\r\n\t\t\t\t\t\tfor ( var j = 0, jl = targetNames.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t\ttracks.push( new TypedKeyframeTrack(\r\n\t\t\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\r\n\t\t\t\t\t\t\t\tTHREE.AnimationUtils.arraySlice( inputAccessor.array, 0 ),\r\n\t\t\t\t\t\t\t\tTHREE.AnimationUtils.arraySlice( outputAccessor.array, 0 ),\r\n\t\t\t\t\t\t\t\tinterpolation\r\n\t\t\t\t\t\t\t) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar name = animationDef.name !== undefined ? animationDef.name : 'animation_' + animationIndex;\r\n\r\n\t\t\treturn new THREE.AnimationClip( name, undefined, tracks );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\r\n\t * @param {number} nodeIndex\r\n\t * @return {Promise<THREE.Object3D>}\r\n\t */\r\n\tGLTFParser.prototype.loadNode = function ( nodeIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\tvar meshReferences = this.json.meshReferences;\r\n\t\tvar meshUses = this.json.meshUses;\r\n\r\n\t\tvar nodeDef = this.json.nodes[ nodeIndex ];\r\n\r\n\t\treturn this.getMultiDependencies( [\r\n\r\n\t\t\t'mesh',\r\n\t\t\t'skin',\r\n\t\t\t'camera'\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar node;\r\n\r\n\t\t\tif ( nodeDef.isBone === true ) {\r\n\r\n\t\t\t\tnode = new THREE.Bone();\r\n\r\n\t\t\t} else if ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tvar mesh = dependencies.meshes[ nodeDef.mesh ];\r\n\r\n\t\t\t\tnode = mesh.clone();\r\n\r\n\t\t\t\t// for Specular-Glossiness\r\n\t\t\t\tif ( mesh.isGroup === true ) {\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = mesh.children.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar child = mesh.children[ i ];\r\n\r\n\t\t\t\t\t\tif ( child.material && child.material.isGLTFSpecularGlossinessMaterial === true ) {\r\n\r\n\t\t\t\t\t\t\tnode.children[ i ].onBeforeRender = child.onBeforeRender;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( mesh.material && mesh.material.isGLTFSpecularGlossinessMaterial === true ) {\r\n\r\n\t\t\t\t\t\tnode.onBeforeRender = mesh.onBeforeRender;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( meshReferences[ nodeDef.mesh ] > 1 ) {\r\n\r\n\t\t\t\t\tnode.name += '_instance_' + meshUses[ nodeDef.mesh ] ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( nodeDef.camera !== undefined ) {\r\n\r\n\t\t\t\tnode = dependencies.cameras[ nodeDef.camera ];\r\n\r\n\t\t\t} else if ( nodeDef.extensions\r\n\t\t\t\t\t && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\r\n\t\t\t\t\t && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\r\n\r\n\t\t\t\tvar lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\r\n\t\t\t\tnode = lights[ nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnode = new THREE.Object3D();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.name !== undefined ) {\r\n\r\n\t\t\t\tnode.name = THREE.PropertyBinding.sanitizeNodeName( nodeDef.name );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.extras ) node.userData = nodeDef.extras;\r\n\r\n\t\t\tif ( nodeDef.matrix !== undefined ) {\r\n\r\n\t\t\t\tvar matrix = new THREE.Matrix4();\r\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\r\n\t\t\t\tnode.applyMatrix( matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\r\n\r\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\r\n\t * @param {number} sceneIndex\r\n\t * @return {Promise<THREE.Scene>}\r\n\t */\r\n\tGLTFParser.prototype.loadScene = function () {\r\n\r\n\t\t// scene node hierachy builder\r\n\r\n\t\tfunction buildNodeHierachy( nodeId, parentObject, json, allNodes, skins ) {\r\n\r\n\t\t\tvar node = allNodes[ nodeId ];\r\n\t\t\tvar nodeDef = json.nodes[ nodeId ];\r\n\r\n\t\t\t// build skeleton here as well\r\n\r\n\t\t\tif ( nodeDef.skin !== undefined ) {\r\n\r\n\t\t\t\tvar meshes = node.isGroup === true ? node.children : [ node ];\r\n\r\n\t\t\t\tfor ( var i = 0, il = meshes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar mesh = meshes[ i ];\r\n\t\t\t\t\tvar skinEntry = skins[ nodeDef.skin ];\r\n\r\n\t\t\t\t\tvar bones = [];\r\n\t\t\t\t\tvar boneInverses = [];\r\n\r\n\t\t\t\t\tfor ( var j = 0, jl = skinEntry.joints.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\tvar jointId = skinEntry.joints[ j ];\r\n\t\t\t\t\t\tvar jointNode = allNodes[ jointId ];\r\n\r\n\t\t\t\t\t\tif ( jointNode ) {\r\n\r\n\t\t\t\t\t\t\tbones.push( jointNode );\r\n\r\n\t\t\t\t\t\t\tvar mat = new THREE.Matrix4();\r\n\r\n\t\t\t\t\t\t\tif ( skinEntry.inverseBindMatrices !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tmat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tboneInverses.push( mat );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', jointId );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmesh.bind( new THREE.Skeleton( bones, boneInverses ), mesh.matrixWorld );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// build node hierachy\r\n\r\n\t\t\tparentObject.add( node );\r\n\r\n\t\t\tif ( nodeDef.children ) {\r\n\r\n\t\t\t\tvar children = nodeDef.children;\r\n\r\n\t\t\t\tfor ( var i = 0, il = children.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar child = children[ i ];\r\n\t\t\t\t\tbuildNodeHierachy( child, node, json, allNodes, skins );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn function loadScene( sceneIndex ) {\r\n\r\n\t\t\tvar json = this.json;\r\n\t\t\tvar extensions = this.extensions;\r\n\t\t\tvar sceneDef = this.json.scenes[ sceneIndex ];\r\n\r\n\t\t\treturn this.getMultiDependencies( [\r\n\r\n\t\t\t\t'node',\r\n\t\t\t\t'skin'\r\n\r\n\t\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\t\tvar scene = new THREE.Scene();\r\n\t\t\t\tif ( sceneDef.name !== undefined ) scene.name = sceneDef.name;\r\n\r\n\t\t\t\tif ( sceneDef.extras ) scene.userData = sceneDef.extras;\r\n\r\n\t\t\t\tvar nodeIds = sceneDef.nodes || [];\r\n\r\n\t\t\t\tfor ( var i = 0, il = nodeIds.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tbuildNodeHierachy( nodeIds[ i ], scene, json, dependencies.nodes, dependencies.skins );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Ambient lighting, if present, is always attached to the scene root.\r\n\t\t\t\tif ( sceneDef.extensions\r\n\t\t\t\t\t\t && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\r\n\t\t\t\t\t\t && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\r\n\r\n\t\t\t\t\tvar lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\r\n\t\t\t\t\tscene.add( lights[ sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn scene;\r\n\r\n\t\t\t} );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\treturn GLTFLoader;\r\n\r\n} )();\r\n\r\nexport default GLTFLoader\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./static/js/GLTFLoader.js\n// module id = xkEE\n// module chunks = 1"],"sourceRoot":""}