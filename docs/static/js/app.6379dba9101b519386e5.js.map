{"version":3,"sources":["webpack:///./static/js/Math.js","webpack:///./src/js/resources/Resource.js","webpack:///./src/js/ships/Ship.js","webpack:///./src/js/ships/Parachute.js","webpack:///./src/js/ships/Balloon.js","webpack:///./src/js/ships/Plane.js","webpack:///./src/js/ships/Spaceship.js","webpack:///./src/js/ships/Ovni.js","webpack:///./src/js/resources/Coin.js","webpack:///./src/js/particles/ParticleManager.js","webpack:///./src/app.js","webpack:///./src/js/main.js","webpack:///./static/js/GLTFLoader.js"],"names":["Math","clamp","value","min","max","map","x","a1","a2","b1","b2","Resource","modelUrl","scale","rotation","audioUrl","audioListener","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default","this","_this","__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default","__proto__","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default","call","model","sound","loadModel","loadAudio","t","GLTFLoader","load","gltf","scene","children","clone","set","lookAt","xhr","error","console","THREE","Audio","AudioLoader","buffer","setBuffer","setLoop","setVolume","require","Ship","velocity","audioPlay","classCallCheck_default","possibleConstructorReturn_default","get_prototype_of_default","center","setFromObject","getCenter","emit","play","Parachute","Balloon","PI","Ovni","Coin","ParticleManager","camera","_scene","_camera","prevCamX","position","prevCamY","y","prevCamZ","z","maxParticles","spread","particles","p","particle","random","vertices","push","pMaterial","color","size","loadTexture","blending","transparent","particleSystem","sortParticles","add","name","xDiff","yDiff","zDiff","i","geometry","length","verticesNeedUpdate","Main","userId","Date","getTime","amplitude","Amplitude","currentLevel","mouseX","mouseY","prevMouseX","prevMouseY","diffX","diffY","audioList","url","maxX","maxY","velX","minAltitude","altitude","curAltitude","destPos","raycaster","far","direction","normalize","coins","coin","paused","levels","ship","skyColor","decay","Plane","Spaceship","window","innerWidth","innerHeight","_renderer","setPixelRatio","devicePixelRatio","setSize","document","body","appendChild","domElement","light","dirLight","material","emissive","ground","on","addEventListener","onMouseMove","bind","onMouseDown","onMouseUp","onKeyDown","onKeyUp","onWindowResize","initAccelerometer","animate","event","pageX","pageY","e","keyCode","aspect","updateProjectionMatrix","nextLevel","progress","c","removeCoin","oldModelPos","dir","subVectors","distanceToSquared","onResourceCollide","update","lerp","background","fog","prevLevel","render","requestAnimationFrame","startLevel","level","log","track","copy","isPlaying","stop","resource","increase","index","indexOf","splice","remove","a","sort","b","currentAudio","counter","source","onended","accelerationIncludingGravity","eventType","eventProperties","data","event_type","user_id","event_properties","manager","undefined","DefaultLoadingManager","prototype","constructor","crossOrigin","onLoad","onProgress","onError","scope","path","LoaderUtils","extractUrlBase","loader","FileLoader","setResponseType","parse","setCrossOrigin","setPath","content","extensions","decodeText","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","headerView","DataView","BINARY_EXTENSION_HEADER_LENGTH","header","magic","slice","version","getUint32","Error","chunkView","chunkIndex","byteLength","chunkLength","chunkType","BINARY_EXTENSION_CHUNK_TYPES","JSON","contentArray","BIN","byteOffset","json","asset","extensionsUsed","KHR_LIGHTS","lights","lightId","lightNode","Color","fromArray","type","DirectionalLight","PointLight","SpotLight","AmbientLight","constantAttenuation","intensity","linearAttenuation","distance","quadraticAttenuation","fallOffAngle","angle","fallOffExponent","warn","KHR_MATERIALS_COMMON","GLTFMaterialsCommonExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","specularGlossinessParams","getMaterialType","ShaderMaterial","extendParams","params","parser","pbrSpecularGlossiness","shader","ShaderLib","uniforms","UniformsUtils","specularMapParsFragmentChunk","join","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","fragmentShader","replace","roughness","metalness","roughnessMap","metalnessMap","specular","setHex","glossiness","specularMap","glossinessMap","vertexShader","defines","STANDARD","opacity","pending","Array","isArray","diffuseFactor","array","diffuseTexture","assignTexture","glossinessFactor","specularFactor","specularGlossinessTexture","specGlossIndex","Promise","all","createMaterial","isGLTFSpecularGlossinessMaterial","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMap","envMapIntensity","refractionRatio","derivatives","cloneMaterial","target","il","refreshUniforms","renderer","group","uvScaleMap","offset","repeat","diffuse","multiplyScalar","isWebGLRenderTarget","texture","matrix","matrixAutoUpdate","setUvTransform","uvTransform","offsetRepeat","flipEnvMap","isCubeTexture","USE_GLOSSINESSMAP","USE_ROUGHNESSMAP","GLTFParser","scenes","cameras","animations","MeshPhongMaterial","MeshLambertMaterial","MeshBasicMaterial","materialParams","khrMaterial","keys","materialValues","forEach","v","specularTexture","shininessFactor","shininess","WEBGL_CONSTANTS","WEBGL_COMPONENT_TYPES","Number","Matrix3","Matrix4","Vector2","Vector3","Vector4","Texture","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","Float32Array","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipMapNearestFilter","9985","LinearMipMapNearestFilter","9986","NearestMipMapLinearFilter","9987","LinearMipMapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TEXTURE_FORMATS","6406","AlphaFormat","6407","RGBFormat","6408","RGBAFormat","6409","LuminanceFormat","6410","LuminanceAlphaFormat","WEBGL_TEXTURE_DATATYPES","UnsignedByteType","32819","UnsignedShort4444Type","32820","UnsignedShort5551Type","33635","UnsignedShort565Type","WEBGL_TYPE_SIZES","BackSide","FrontSide","NeverDepth","LessDepth","EqualDepth","LessEqualDepth","GreaterEqualDepth","NotEqualDepth","AlwaysDepth","AddEquation","SubtractEquation","ReverseSubtractEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","InterpolateSmooth","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","resolveURL","test","addMorphTargets","mesh","meshDef","primitiveDef","accessors","targets","morphAttributes","normal","morphTargets","positionAttribute","normalAttribute","attributeName","POSITION","attributes","j","jl","count","setXYZ","getX","getY","getZ","NORMAL","morphNormals","updateMorphTargets","morphTargetInfluences","isPrimitiveEqual","indices","attribA","attribB","keysA","Object","keysB","key","getCachedGeometry","cache","newPrimitive","cached","primitive","options","objects","get","object","removeAll","primitiveCache","textureLoader","TextureLoader","fileLoader","markDefs","getMultiDependencies","then","dependencies","catch","nodeDefs","nodes","skinDefs","skins","meshDefs","meshes","meshReferences","meshUses","skinIndex","skinLength","joints","isBone","nodeIndex","nodeLength","nodeDef","skin","isSkinnedMesh","getDependency","cacheKey","dependency","charAt","toUpperCase","getDependencies","defs","def","types","results","pendings","loadBuffer","bufferIndex","bufferDef","buffers","uri","resolve","reject","loadBufferView","bufferViewIndex","bufferViewDef","bufferViews","loadAccessor","accessorIndex","accessorDef","pendingBufferViews","bufferView","sparse","values","bufferAttribute","itemSize","TypedArray","componentType","elementBytes","BYTES_PER_ELEMENT","itemBytes","byteStride","normalized","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setArray","setX","setY","setZ","setW","textureIndex","URL","webkitURL","textureDef","textures","images","sourceURI","isObjectURL","blob","Blob","mimeType","createObjectURL","Loader","Handlers","revokeObjectURL","flipY","format","internalFormat","sampler","samplers","magFilter","minFilter","wrapS","wrapT","textureName","loadMaterial","materialIndex","materialType","materialDef","materials","materialExtensions","khcExtension","sgExtension","pbrMetallicRoughness","MeshStandardMaterial","metallicRoughness","baseColorFactor","baseColorTexture","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","side","DoubleSide","alphaMode","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","encoding","sRGBEncoding","extras","userData","loadGeometries","primitives","geometries","BufferGeometry","attributeId","addAttribute","setIndex","loadMesh","meshIndex","Group","depthTest","uv2","uv","useVertexColors","useFlatShading","useSkinning","useMorphTargets","vertexColors","VertexColors","needsUpdate","flatShading","mode","SkinnedMesh","skinning","Mesh","drawMode","TriangleStripDrawMode","TriangleFanDrawMode","LineSegments","Line","LineLoop","Points","onBeforeRender","loadCamera","cameraIndex","cameraDef","aspectRatio","xfov","yfov","PerspectiveCamera","radToDeg","znear","zfar","OrthographicCamera","xmag","ymag","loadSkin","skinDef","skinEntry","inverseBindMatrices","accessor","loadAnimation","animationIndex","animationDef","tracks","channels","channel","node","id","input","parameters","output","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","uuid","interpolation","outputAccessorValues","getW","targetNames","traverse","isMesh","AnimationUtils","arraySlice","AnimationClip","loadNode","Bone","isGroup","child","Object3D","PropertyBinding","sanitizeNodeName","applyMatrix","quaternion","loadScene","buildNodeHierachy","nodeId","parentObject","allNodes","bones","boneInverses","jointId","jointNode","mat","Skeleton","matrixWorld","sceneIndex","sceneDef","Scene","nodeIds","__webpack_exports__"],"mappings":"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","file":"static/js/app.6379dba9101b519386e5.js","sourcesContent":["Math.clamp = function ( value, min, max ) {\n\treturn Math.max( min, Math.min( max, value ) );\n}\n\nMath.map = function ( x, a1, a2, b1, b2 ) {\n\treturn b1 + ( x - a1 ) * ( b2 - b1 ) / ( a2 - a1 );\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./static/js/Math.js\n// module id = 0gDO\n// module chunks = 1","import GLTFLoader from '../../../static/js/GLTFLoader'\nconst EventEmitter = require('events')\n\nclass Resource extends EventEmitter {\n  constructor (modelUrl, scale, rotation, audioUrl, audioListener) {\n    super()\n\n    this.modelUrl = modelUrl\n    this.scale = scale\n    this.rotation = rotation\n    this.audioUrl = audioUrl\n    this.audioListener = audioListener\n    this.model = null\n    this.sound = null\n\n    this.loadModel()\n    this.loadAudio()\n  }\n\n  loadModel () {\n    var t = this\n    var loader = new GLTFLoader()\n    loader.load('static/models/' + t.modelUrl, function (gltf) {\n      t.model = gltf.scene.children[0].clone()\n      t.model.scale.set(t.scale, t.scale, t.scale)\n      t.model.lookAt(0, t.rotation, 0)\n    },\n    function (xhr) {\n      // console.log((xhr.loaded / xhr.total * 100) + '% loaded')\n    },\n    function (error) {\n      console.error('GLTF LOADER:', error)\n    })\n  }\n\n  loadAudio () {\n    var t = this\n    // eslint-disable-next-line\n    this.sound = new THREE.Audio(this.audioListener)\n    // eslint-disable-next-line\n    var audioLoader = new THREE.AudioLoader()\n    audioLoader.load(this.audioUrl, function (buffer) {\n      t.sound.setBuffer(buffer)\n      t.sound.setLoop(false)\n      t.sound.setVolume(0.5)\n    })\n  }\n}\n\nexport default Resource\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/resources/Resource.js","import * as THREE from 'three'\nimport GLTFLoader from '../../../static/js/GLTFLoader'\nconst EventEmitter = require('events')\n\nclass Ship extends EventEmitter {\n  constructor (modelUrl, scale, rotation, velocity, audioUrl, audioListener, audioPlay) {\n    super()\n\n    this.modelUrl = modelUrl\n    this.scale = scale\n    this.rotation = rotation\n    this.velocity = velocity\n    this.audioUrl = audioUrl\n    this.audioListener = audioListener\n    this.audioPlay = audioPlay\n    this.model = null\n    this.sound = null\n    this.center = new THREE.Vector3(0, 0, 0)\n\n    this.loadModel()\n    this.loadAudio()\n  }\n\n  loadModel () {\n    var t = this\n    // eslint-disable-next-line\n    var loader = new GLTFLoader()\n    loader.load('static/models/' + this.modelUrl, function (gltf) {\n      t.model = gltf.scene.children[0]\n      t.model.scale.set(t.scale, t.scale, t.scale)\n      t.center = new THREE.Box3().setFromObject(t.model).getCenter()\n      t.emit('onModelLoaded', t.model)\n    },\n    function (xhr) {\n      // console.log((xhr.loaded / xhr.total * 100) + '% loaded')\n    },\n    function (error) {\n      console.error('GLTF LOADER:', error)\n    })\n  }\n\n  loadAudio () {\n    var t = this\n    // eslint-disable-next-line\n    this.sound = new THREE.Audio(this.audioListener)\n    var audioLoader = new THREE.AudioLoader()\n    audioLoader.load(this.audioUrl, function (buffer) {\n      t.sound.setBuffer(buffer)\n      t.sound.setLoop(true)\n      t.sound.setVolume(0.3)\n      if (t.audioPlay) {\n        t.sound.play()\n      }\n    })\n  }\n}\n\nexport default Ship\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Ship.js","import Ship from './Ship'\n\nclass Parachute extends Ship {\n  constructor (audioListener) {\n    super('parachute.gltf', 2.5, 0, 1, 'static/audios/205966__kangaroovindaloo__medium-wind.ogg', audioListener, true)\n  }\n}\n\nexport default Parachute\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Parachute.js","import Ship from './Ship'\n\nclass Balloon extends Ship {\n  constructor (audioListener) {\n    super('balloon.gltf', 2.5, 0, 1, 'static/audios/205966__kangaroovindaloo__medium-wind.ogg', audioListener, false)\n  }\n}\n\nexport default Balloon\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Balloon.js","import Ship from './Ship'\n\nclass Parachute extends Ship {\n  constructor (audioListener) {\n    super('plane.gltf', 6, Math.PI + Math.PI * 0.5, 2, 'static/audios/218352__photomonster__motorcycle-nsumax-1954-engine.ogg', audioListener, false)\n  }\n}\n\nexport default Parachute\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Plane.js","import Ship from './Ship'\n\nclass Parachute extends Ship {\n  constructor (audioListener) {\n    super('spaceship.gltf', 30, Math.PI, 3, 'static/audios/42233__noisecollector__spaceswamp.ogg', audioListener, false)\n  }\n}\n\nexport default Parachute\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Spaceship.js","import Ship from './Ship'\n\nclass Ovni extends Ship {\n  constructor (audioListener) {\n    super('ovni.gltf', 30, Math.PI, 2, 'static/audios/42233__noisecollector__spaceswamp.ogg', audioListener, false)\n  }\n}\n\nexport default Ovni\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/ships/Ovni.js","import Resource from './Resource'\n\nclass Coin extends Resource {\n  constructor (audioListener) {\n    super('coin.gltf', 30, 1, 'static/audios/135936__bradwesson__collectcoin.ogg', audioListener)\n  }\n}\n\nexport default Coin\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/resources/Coin.js","import * as THREE from 'three'\r\nconst EventEmitter = require('events')\r\n\r\nclass ParticleManager extends EventEmitter {\r\n  constructor (scene, camera) {\r\n    super()\r\n\r\n    this._scene = scene\r\n    this._camera = camera\r\n    this.prevCamX = this._camera.position.x\r\n    this.prevCamY = this._camera.position.y\r\n    this.prevCamZ = this._camera.position.z\r\n\r\n    this.maxParticles = 1000\r\n\r\n    this.spread = 300\r\n\r\n    this.particles = new THREE.Geometry()\r\n\r\n    for (let p = 0; p < this.maxParticles; p++) {\r\n      let particle = new THREE.Vector3(\r\n        Math.random() * this.spread - this.spread * 0.3,\r\n        Math.random() * this.spread - this.spread * 0.5,\r\n        Math.random() * 500\r\n      )\r\n\r\n      this.particles.vertices.push(particle)\r\n    }\r\n\r\n    let pMaterial = new THREE.PointsMaterial({\r\n      color: 0xFFFFFF,\r\n      size: 2,\r\n      map: THREE.ImageUtils.loadTexture(\r\n        'static/textures/particle.png'\r\n      ),\r\n      blending: THREE.AdditiveBlending,\r\n      transparent: true\r\n    })\r\n    this.particleSystem = new THREE.Points(this.particles, pMaterial)\r\n    this.particleSystem.sortParticles = true\r\n\r\n    this._scene.add(this.particleSystem)\r\n  }\r\n\r\n  set (name) {\r\n    if (name === 'Star') {\r\n\r\n    }\r\n  }\r\n\r\n  update () {\r\n    let xDiff = this._camera.position.x - this.prevCamX\r\n    let yDiff = this._camera.position.y - this.prevCamY\r\n    let zDiff = this._camera.position.z - this.prevCamZ\r\n\r\n    this.prevCamX = this._camera.position.x\r\n    this.prevCamY = this._camera.position.y\r\n    this.prevCamZ = this._camera.position.z\r\n\r\n    this.particleSystem.position.set(this._camera.position.x, this._camera.position.y, this._camera.position.z)\r\n\r\n    for (let i = 0; i < this.particleSystem.geometry.vertices.length; i++) {\r\n      let particle = this.particleSystem.geometry.vertices[i]\r\n      particle.x -= xDiff\r\n      particle.y -= yDiff\r\n      particle.z -= zDiff\r\n\r\n      if (particle.z < -30) {\r\n        particle.x = Math.random() * this.spread - this.spread * 0.3\r\n        particle.y = Math.random() * this.spread - this.spread * 0.5\r\n        particle.z = 500 + Math.random() * 500\r\n      }\r\n    }\r\n\r\n    this.particleSystem.geometry.verticesNeedUpdate = true\r\n  }\r\n}\r\n\r\nexport default ParticleManager\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/particles/ParticleManager.js","import './css/style.css'\nimport Main from './js/main'\n// import Main from './js/mainWagner'\n// import Main from './js/mainVR'\n\n// eslint-disable-next-line\nnew Main()\n\n\n\n// WEBPACK FOOTER //\n// ./src/app.js","import * as THREE from 'three'\r\n// import * as Stats from 'stats.js'\r\nimport Parachute from './ships/Parachute'\r\nimport Balloon from './ships/Balloon'\r\nimport Plane from './ships/Plane'\r\nimport Spaceship from './ships/Spaceship'\r\n// import Spaceship2 from './ships/Spaceship2'\r\nimport Ovni from './ships/Ovni'\r\nimport Coin from './resources/Coin'\r\nimport '../../static/js/GLTFLoader'\r\nimport '../../static/js/Math'\r\nimport ParticleManager from './particles/ParticleManager'\r\nimport Amplitude from 'amplitude'\r\n// import shaderVert from 'shaders/custom.vert'\r\n// import shaderFrag from 'shaders/custom.frag'\r\n\r\nclass Main {\r\n  constructor () {\r\n    var t = this\r\n\r\n    this.userId = new Date().getTime()\r\n    this.amplitude = new Amplitude('82e23a024491264ca4d730a9297d4073')\r\n\r\n    this.currentLevel = 0\r\n\r\n    this.mouseX = 0\r\n    this.mouseY = 0\r\n    this.prevMouseX = this.mouseX\r\n    this.prevMouseY = this.mouseY\r\n    this.diffX = 0\r\n    this.diffY = 0\r\n\r\n    this.audioList = [\r\n      {\r\n        url: 'static/audios/Black-Eyed-Peas-I-Got-A-Feeling.ogg',\r\n        sound: null\r\n      },\r\n      {\r\n        url: 'static/audios/Eiffel65-Blue.ogg',\r\n        sound: null\r\n      },\r\n      {\r\n        url: 'static/audios/Enegetic-Game-Theme.ogg',\r\n        sound: null\r\n      },\r\n      {\r\n        url: 'static/audios/Imagine Dragons - Radioactive (Harder).ogg',\r\n        sound: null\r\n      }\r\n    ]\r\n    this.audioListener = new THREE.AudioListener()\r\n\r\n    this.maxX = 80\r\n    this.maxY = 50\r\n    this.velX = 1.5\r\n    this.minAltitude = 200 // meters\r\n    this.altitude = this.minAltitude\r\n    this.curAltitude = this.altitude\r\n    this.destPos = new THREE.Vector2()\r\n    this.raycaster = new THREE.Raycaster()\r\n    this.raycaster.far = 2\r\n    this.direction = new THREE.Vector3(0, 0, 10)\r\n    this.direction.normalize()\r\n    this.coins = []\r\n    this.coin = new Coin(this.audioListener)\r\n    this.paused = false\r\n\r\n    this.levels = [\r\n      {\r\n        ship: new Parachute(this.audioListener),\r\n        altitude: this.minAltitude,\r\n        skyColor: new THREE.Color(0xcaf8f1),\r\n        decay: 0.03,\r\n        coins: 20\r\n      },\r\n      {\r\n        ship: new Balloon(this.audioListener),\r\n        altitude: 400,\r\n        skyColor: new THREE.Color(0xaaffff),\r\n        decay: 0.04,\r\n        coins: 18\r\n      },\r\n      {\r\n        ship: new Plane(this.audioListener),\r\n        altitude: 600,\r\n        skyColor: new THREE.Color(0xf26dd9),\r\n        decay: 0.06,\r\n        coins: 15\r\n      },\r\n      {\r\n        ship: new Spaceship(this.audioListener),\r\n        altitude: 800,\r\n        skyColor: new THREE.Color(0xff933a),\r\n        decay: 0.12,\r\n        coins: 12\r\n      },\r\n      /*\r\n      {\r\n        ship: new Spaceship2(this.audioListener),\r\n        altitude: 1000,\r\n        skyColor: new THREE.Color(0x000000),\r\n        decay: 0.12,\r\n        coins: 10\r\n      },\r\n      */\r\n      {\r\n        ship: new Ovni(this.audioListener),\r\n        altitude: 1000,\r\n        skyColor: new THREE.Color(0x000000),\r\n        decay: 0.12,\r\n        coins: 8\r\n      }\r\n    ]\r\n\r\n    this._camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000)\r\n    this._camera.position.set(-100, this.altitude + 50, 0)\r\n    this._camera.lookAt(0, this.altitude, 100)\r\n    this._camera.add(this.audioListener)\r\n\r\n    this._scene = new THREE.Scene()\r\n\r\n    this._renderer = new THREE.WebGLRenderer()\r\n    this._renderer.setPixelRatio(window.devicePixelRatio)\r\n    this._renderer.setSize(window.innerWidth, window.innerHeight)\r\n    document.body.appendChild(this._renderer.domElement)\r\n\r\n    /*\r\n    this.stats = new Stats()\r\n    this.stats.showPanel(0)// fps,\r\n    // this.stats.showPanel(1)// ms\r\n    // this.stats.showPanel(2)// mb\r\n    document.body.appendChild(this.stats.dom)\r\n    */\r\n\r\n    // for inspection debug\r\n    // window.scene = this._scene\r\n    // window.THREE = THREE\r\n\r\n    // 'ovni.gltf' 100\r\n    // 'balloon.gltf' 10\r\n\r\n    var light = new THREE.HemisphereLight(0xbbbbff, 0x444422)\r\n    light.name = 'Hemisphere Light'\r\n    light.position.set(0, 1, 0)\r\n    t._scene.add(light)\r\n\r\n    var dirLight = new THREE.DirectionalLight(0xffffff)\r\n    dirLight.name = 'Point Light'\r\n    dirLight.position.set(-10, 6, -10)\r\n    t._scene.add(dirLight)\r\n\r\n    this.particles = new ParticleManager(this._scene, this._camera)\r\n\r\n    const geometry = new THREE.SphereGeometry(1, 320, 320)\r\n    const material = new THREE.MeshPhongMaterial({color: 0x008800, emissive: 0x00ff00})\r\n    /*\r\n    const material2 = new THREE.ShaderMaterial({\r\n      vertexShader: shaderVert,\r\n      fragmentShader: shaderFrag\r\n    })\r\n    */\r\n    this.ground = new THREE.Mesh(geometry, material)\r\n    this.ground.name = 'Ground'\r\n    this._scene.add(this.ground)\r\n\r\n    const earthRadius = 6000000 // 6000 km\r\n    this.ground.scale.set(earthRadius, earthRadius, earthRadius)\r\n    this.ground.position.y = -earthRadius\r\n    this.ground.rotation.z = Math.PI * 0.5\r\n\r\n    // add ship models to scene\r\n    for (var i = 0; i < this.levels.length; i++) {\r\n      this.levels[i].ship.on('onModelLoaded', function (model) {\r\n        t._scene.add(model)\r\n        model.position.y = t.altitude\r\n      })\r\n    }\r\n\r\n    this._renderer.domElement.addEventListener('mousemove', this.onMouseMove.bind(this), false)\r\n    this._renderer.domElement.addEventListener('mousedown', this.onMouseDown.bind(this), false)\r\n    this._renderer.domElement.addEventListener('mouseup', this.onMouseUp.bind(this), false)\r\n    this._renderer.domElement.addEventListener('touchstart', this.onMouseDown.bind(this), false)\r\n    this._renderer.domElement.addEventListener('touchend', this.onMouseUp.bind(this), false)\r\n\r\n    document.addEventListener('keydown', this.onKeyDown.bind(this), false)\r\n    document.addEventListener('keyup', this.onKeyUp.bind(this), false)\r\n\r\n    window.addEventListener('resize', this.onWindowResize.bind(this), false)\r\n\r\n    this.loadAudio()\r\n    this.initAccelerometer()\r\n    this.animate()\r\n  }\r\n\r\n  onMouseMove (event) {\r\n    this.mouseX = event.pageX\r\n    this.mouseY = event.pageY\r\n  }\r\n\r\n  onMouseDown () {\r\n    // this.nextLevel()\r\n    // this.altitude = this.levels[this.currentLevel].altitude + 100\r\n  }\r\n\r\n  onMouseUp () {\r\n  }\r\n\r\n  onKeyDown (e) {\r\n    if (e.keyCode === 32) this.paused = !this.paused\r\n  }\r\n\r\n  onKeyUp (e) {\r\n  }\r\n\r\n  onWindowResize () {\r\n    this._camera.aspect = window.innerWidth / window.innerHeight\r\n    this._camera.updateProjectionMatrix()\r\n\r\n    this._renderer.setSize(window.innerWidth, window.innerHeight)\r\n  }\r\n\r\n  animate () {\r\n    // this.stats.begin()\r\n\r\n    if (!this.paused) {\r\n      // mouse\r\n      this.diffX += (this.mouseX - this.prevMouseX) / 100\r\n      this.diffY += (this.mouseY - this.prevMouseY) / 100\r\n      this.diffX = Math.clamp(this.diffX, -1, 1)\r\n      this.diffY = Math.clamp(this.diffY, -1, 1)\r\n      this.prevMouseX = this.mouseX\r\n      this.prevMouseY = this.mouseY\r\n\r\n      // altitude\r\n      this.altitude -= this.levels[this.currentLevel].decay\r\n      if (this.altitude < this.minAltitude) this.altitude = this.minAltitude\r\n      this.curAltitude += (this.altitude - this.curAltitude) * 0.05\r\n\r\n      let nextLevel = this.currentLevel + 1\r\n      if (nextLevel >= this.levels.length) {\r\n        nextLevel = this.currentLevel\r\n      }\r\n      let progress = (this.curAltitude - this.levels[this.currentLevel].altitude) / (this.levels[nextLevel].altitude - this.levels[this.currentLevel].altitude)\r\n      progress = THREE.Math.clamp(progress, 0, 1)\r\n\r\n      // instantiate coins\r\n      if (this.coin.model) {\r\n        if (this.coins.length < this.levels[this.currentLevel].coins && Math.random() > 0.97) {\r\n          var coin = this.coin.model.clone()\r\n          coin.rotation.z = Math.random() * Math.PI\r\n          coin.position.set(\r\n            (Math.random() - 0.5) * 2 * this.maxX,\r\n            Math.random() * (this.maxY - 20) + 20 + this.curAltitude,\r\n            this._camera.position.z + 500 + Math.random() * 300)\r\n          this._scene.add(coin)\r\n          this.coins.push(coin)\r\n        }\r\n      }\r\n\r\n      // update or remove coins\r\n      for (var c = this.coins.length - 1; c >= 0; c--) {\r\n        if (this.coins[c].position.z < this._camera.position.z) {\r\n          this.removeCoin(this.coins[c])\r\n        } else {\r\n          this.coins[c].rotation.z += 0.02\r\n        }\r\n      }\r\n\r\n      var model = this.levels[this.currentLevel].ship.model\r\n      if (model) {\r\n        var oldModelPos = model.position.clone()\r\n\r\n        // position\r\n        this.destPos.x = Math.map(-this.diffX, -1, 1, -this.maxX, this.maxX)\r\n        this.destPos.y = Math.map(-this.diffY, -1, 1, 0, this.maxY) + this.curAltitude\r\n        model.position.x += (this.destPos.x - model.position.x) * 0.05\r\n        model.position.y += (this.destPos.y - model.position.y) * 0.05\r\n        model.position.z += this.levels[this.currentLevel].ship.velocity * this.velX\r\n\r\n        // camera\r\n        this._camera.position.z = model.position.z - 50\r\n        this._camera.position.y = this.curAltitude + 50\r\n\r\n        // ground\r\n        this.ground.position.z = model.position.z\r\n        // this.ground.rotation.x += 0.00005\r\n\r\n        // direction\r\n        var dir = new THREE.Vector3()\r\n        dir.subVectors(model.position, oldModelPos)\r\n        dir.add(model.position)\r\n        model.lookAt(dir)\r\n        model.rotation.y += this.levels[this.currentLevel].ship.rotation\r\n\r\n        // collider\r\n        var position = model.position.clone().add(this.levels[this.currentLevel].ship.center)\r\n        for (var i = this.coins.length - 1; i >= 0; i--) {\r\n          if (position.distanceToSquared(this.coins[i].position) < 300) {\r\n            this.onResourceCollide(this.coins[i])\r\n          }\r\n        }\r\n      // if model\r\n      }\r\n\r\n      this.particles.update()\r\n\r\n      // color\r\n      let skyColor = this.levels[this.currentLevel].skyColor.clone()\r\n      skyColor.lerp(this.levels[nextLevel].skyColor, progress)\r\n      this._scene.background = skyColor\r\n      this._scene.fog = new THREE.FogExp2(skyColor, 0.003)\r\n\r\n      // console.log(progress)\r\n      if (progress <= 0) {\r\n        this.prevLevel()\r\n      } else if (progress >= 1) {\r\n        this.nextLevel()\r\n      }\r\n\r\n    // if !this.paused\r\n    }\r\n\r\n    this._renderer.render(this._scene, this._camera)\r\n\r\n    // this.stats.end()\r\n\r\n    requestAnimationFrame(this.animate.bind(this))\r\n  }\r\n\r\n  nextLevel () {\r\n    var nextLevel = this.currentLevel + 1\r\n    if (nextLevel >= this.levels.length) nextLevel = this.currentLevel\r\n\r\n    if (nextLevel === this.currentLevel) return\r\n\r\n    this.startLevel(nextLevel)\r\n  }\r\n\r\n  prevLevel () {\r\n    var prevLevel = this.currentLevel - 1\r\n    if (prevLevel <= 0) prevLevel = 0\r\n\r\n    if (prevLevel === this.currentLevel) return\r\n\r\n    this.startLevel(prevLevel)\r\n  }\r\n\r\n  startLevel (level) {\r\n    console.log('startLevel', level)\r\n\r\n    this.track('change_level', {level: level})\r\n\r\n    this.levels[level].ship.model.position.copy(this.levels[this.currentLevel].ship.model.position)\r\n    if (this.levels[this.currentLevel].ship.sound.isPlaying) {\r\n      this.levels[this.currentLevel].ship.sound.stop()\r\n    }\r\n    this.currentLevel = level\r\n    this.levels[this.currentLevel].ship.sound.play()\r\n  }\r\n\r\n  onResourceCollide (resource) {\r\n    var increase = 20\r\n\r\n    // bonus = fast coin catch\r\n    if (this.curAltitude < this.altitude) increase *= 2\r\n\r\n    this.altitude += increase * (this.currentLevel + 1)\r\n\r\n    this.coin.sound.play()\r\n\r\n    this.removeCoin(resource)\r\n\r\n    this.track('get_resource')\r\n  }\r\n\r\n  removeCoin (coin) {\r\n    var index = this.coins.indexOf(coin)\r\n    if (index > -1) {\r\n      this.coins.splice(index, 1)\r\n    }\r\n\r\n    this._scene.remove(coin)\r\n  }\r\n\r\n  loadAudio () {\r\n    this.audioList = this.audioList\r\n      .map((a) => ({sort: Math.random(), value: a}))\r\n      .sort((a, b) => a.sort - b.sort)\r\n      .map((a) => a.value)\r\n\r\n    this.currentAudio = 0\r\n    let counter = -1\r\n    let t = this\r\n\r\n    this.audioList.map((a) => {\r\n      a.index = ++counter\r\n      a.sound = new THREE.Audio(this.audioListener)\r\n      var audioLoader = new THREE.AudioLoader()\r\n      audioLoader.load(a.url, function (buffer) {\r\n        a.sound.setBuffer(buffer)\r\n        a.sound.setLoop(false)\r\n        a.sound.setVolume(0.5)\r\n        if (a.index === 0) {\r\n          a.sound.play()\r\n          a.sound.source.onended = () => {\r\n            console.log('audio ended', t.currentAudio, t.audioList.length, a.index)\r\n            t.currentAudio++\r\n            if (t.currentAudio >= t.audioList.length) t.currentAudio = 0\r\n            console.log('audio ended', t.currentAudio, t.audioList.length, a.index)\r\n\r\n            t.audioList[t.currentAudio].sound.play()\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  initAccelerometer () {\r\n    let t = this\r\n    window.addEventListener('devicemotion', function (event) {\r\n      let x = event.accelerationIncludingGravity.x\r\n      let y = event.accelerationIncludingGravity.y\r\n      if (x !== 0 || y !== 0) {\r\n        if (window.innerWidth > window.innerHeight) {\r\n          t.mouseX = -y * 30\r\n          t.mouseY = x * 30\r\n        } else {\r\n          t.mouseX = x * 30\r\n          t.mouseY = -y * 30\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  track (eventType, eventProperties) {\r\n    let data = {event_type: eventType, user_id: this.userId}\r\n    if (eventProperties) data.event_properties = eventProperties\r\n    this.amplitude.track(data)\r\n  }\r\n}\r\n\r\nexport default Main\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/main.js","/**\r\n * @author Rich Tibbett / https://github.com/richtr\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Tony Parisi / http://www.tonyparisi.com/\r\n * @author Takahiro / https://github.com/takahirox\r\n * @author Don McCurdy / https://www.donmccurdy.com\r\n */\r\n\r\nconst GLTFLoader = ( function () {\r\n\r\n\tfunction GLTFLoader( manager ) {\r\n\r\n\t\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n\t}\r\n\r\n\tGLTFLoader.prototype = {\r\n\r\n\t\tconstructor: GLTFLoader,\r\n\r\n\t\tcrossOrigin: 'Anonymous',\r\n\r\n\t\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tvar path = this.path !== undefined ? this.path : THREE.LoaderUtils.extractUrlBase( url );\r\n\r\n\t\t\tvar loader = new THREE.FileLoader( scope.manager );\r\n\r\n\t\t\tloader.setResponseType( 'arraybuffer' );\r\n\r\n\t\t\tloader.load( url, function ( data ) {\r\n\r\n\t\t\t\ttry {\r\n\r\n\t\t\t\t\tscope.parse( data, path, onLoad, onError );\r\n\r\n\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\tif ( onError !== undefined ) {\r\n\r\n\t\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tthrow e;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, onProgress, onError );\r\n\r\n\t\t},\r\n\r\n\t\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\t\tthis.crossOrigin = value;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tsetPath: function ( value ) {\r\n\r\n\t\t\tthis.path = value;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tparse: function ( data, path, onLoad, onError ) {\r\n\r\n\t\t\tvar content;\r\n\t\t\tvar extensions = {};\r\n\r\n\t\t\tif ( typeof data === 'string' ) {\r\n\r\n\t\t\t\tcontent = data;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar magic = THREE.LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\r\n\r\n\t\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\t\t\ttry {\r\n\r\n\t\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\r\n\r\n\t\t\t\t\t} catch ( error ) {\r\n\r\n\t\t\t\t\t\tif ( onError ) onError( error );\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcontent = THREE.LoaderUtils.decodeText( new Uint8Array( data ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar json = JSON.parse( content );\r\n\r\n\t\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\r\n\r\n\t\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.' ) );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( json.extensionsUsed ) {\r\n\r\n\t\t\t\tif ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_LIGHTS ) >= 0 ) {\r\n\r\n\t\t\t\t\textensions[ EXTENSIONS.KHR_LIGHTS ] = new GLTFLightsExtension( json );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_COMMON ) >= 0 ) {\r\n\r\n\t\t\t\t\textensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] = new GLTFMaterialsCommonExtension( json );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ) >= 0 ) {\r\n\r\n\t\t\t\t\textensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// console.time( 'GLTFLoader' );\r\n\r\n\t\t\tvar parser = new GLTFParser( json, extensions, {\r\n\r\n\t\t\t\tpath: path || this.path || '',\r\n\t\t\t\tcrossOrigin: this.crossOrigin,\r\n\t\t\t\tmanager: this.manager\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tparser.parse( function ( scene, scenes, cameras, animations, asset ) {\r\n\r\n\t\t\t\t// console.timeEnd( 'GLTFLoader' );\r\n\r\n\t\t\t\tvar glTF = {\r\n\t\t\t\t\tscene: scene,\r\n\t\t\t\t\tscenes: scenes,\r\n\t\t\t\t\tcameras: cameras,\r\n\t\t\t\t\tanimations: animations,\r\n\t\t\t\t\tasset: asset\r\n\t\t\t\t};\r\n\r\n\t\t\t\tonLoad( glTF );\r\n\r\n\t\t\t}, onError );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t/* GLTFREGISTRY */\r\n\r\n\tfunction GLTFRegistry() {\r\n\r\n\t\tvar objects = {};\r\n\r\n\t\treturn\t{\r\n\r\n\t\t\tget: function ( key ) {\r\n\r\n\t\t\t\treturn objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tadd: function ( key, object ) {\r\n\r\n\t\t\t\tobjects[ key ] = object;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremove: function ( key ) {\r\n\r\n\t\t\t\tdelete objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremoveAll: function () {\r\n\r\n\t\t\t\tobjects = {};\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** EXTENSIONS ***********/\r\n\t/*********************************/\r\n\r\n\tvar EXTENSIONS = {\r\n\t\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\r\n\t\tKHR_LIGHTS: 'KHR_lights',\r\n\t\tKHR_MATERIALS_COMMON: 'KHR_materials_common',\r\n\t\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness'\r\n\t};\r\n\r\n\t/**\r\n\t * Lights Extension\r\n\t *\r\n\t * Specification: PENDING\r\n\t */\r\n\tfunction GLTFLightsExtension( json ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS;\r\n\r\n\t\tthis.lights = {};\r\n\r\n\t\tvar extension = ( json.extensions && json.extensions[ EXTENSIONS.KHR_LIGHTS ] ) || {};\r\n\t\tvar lights = extension.lights || {};\r\n\r\n\t\tfor ( var lightId in lights ) {\r\n\r\n\t\t\tvar light = lights[ lightId ];\r\n\t\t\tvar lightNode;\r\n\r\n\t\t\tvar color = new THREE.Color().fromArray( light.color );\r\n\r\n\t\t\tswitch ( light.type ) {\r\n\r\n\t\t\t\tcase 'directional':\r\n\t\t\t\t\tlightNode = new THREE.DirectionalLight( color );\r\n\t\t\t\t\tlightNode.position.set( 0, 0, 1 );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'point':\r\n\t\t\t\t\tlightNode = new THREE.PointLight( color );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'spot':\r\n\t\t\t\t\tlightNode = new THREE.SpotLight( color );\r\n\t\t\t\t\tlightNode.position.set( 0, 0, 1 );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'ambient':\r\n\t\t\t\t\tlightNode = new THREE.AmbientLight( color );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( lightNode ) {\r\n\r\n\t\t\t\tif ( light.constantAttenuation !== undefined ) {\r\n\r\n\t\t\t\t\tlightNode.intensity = light.constantAttenuation;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( light.linearAttenuation !== undefined ) {\r\n\r\n\t\t\t\t\tlightNode.distance = 1 / light.linearAttenuation;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( light.quadraticAttenuation !== undefined ) {\r\n\r\n\t\t\t\t\tlightNode.decay = light.quadraticAttenuation;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( light.fallOffAngle !== undefined ) {\r\n\r\n\t\t\t\t\tlightNode.angle = light.fallOffAngle;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( light.fallOffExponent !== undefined ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader:: light.fallOffExponent not currently supported.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlightNode.name = light.name || ( 'light_' + lightId );\r\n\t\t\t\tthis.lights[ lightId ] = lightNode;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Common Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_common\r\n\t */\r\n\tfunction GLTFMaterialsCommonExtension( json ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_COMMON;\r\n\r\n\t}\r\n\r\n\tGLTFMaterialsCommonExtension.prototype.getMaterialType = function ( material ) {\r\n\r\n\t\tvar khrMaterial = material.extensions[ this.name ];\r\n\r\n\t\tswitch ( khrMaterial.type ) {\r\n\r\n\t\t\tcase 'commonBlinn' :\r\n\t\t\tcase 'commonPhong' :\r\n\t\t\t\treturn THREE.MeshPhongMaterial;\r\n\r\n\t\t\tcase 'commonLambert' :\r\n\t\t\t\treturn THREE.MeshLambertMaterial;\r\n\r\n\t\t\tcase 'commonConstant' :\r\n\t\t\tdefault :\r\n\t\t\t\treturn THREE.MeshBasicMaterial;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tGLTFMaterialsCommonExtension.prototype.extendParams = function ( materialParams, material, parser ) {\r\n\r\n\t\tvar khrMaterial = material.extensions[ this.name ];\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tvar keys = [];\r\n\r\n\t\t// TODO: Currently ignored: 'ambientFactor', 'ambientTexture'\r\n\t\tswitch ( khrMaterial.type ) {\r\n\r\n\t\t\tcase 'commonBlinn' :\r\n\t\t\tcase 'commonPhong' :\r\n\t\t\t\tkeys.push( 'diffuseFactor', 'diffuseTexture', 'specularFactor', 'specularTexture', 'shininessFactor' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'commonLambert' :\r\n\t\t\t\tkeys.push( 'diffuseFactor', 'diffuseTexture' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'commonConstant' :\r\n\t\t\tdefault :\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tvar materialValues = {};\r\n\r\n\t\tkeys.forEach( function ( v ) {\r\n\r\n\t\t\tif ( khrMaterial[ v ] !== undefined ) materialValues[ v ] = khrMaterial[ v ];\r\n\r\n\t\t} );\r\n\r\n\t\tif ( materialValues.diffuseFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.color = new THREE.Color().fromArray( materialValues.diffuseFactor );\r\n\t\t\tmaterialParams.opacity = materialValues.diffuseFactor[ 3 ];\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialValues.diffuseTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'map', materialValues.diffuseTexture.index ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialValues.specularFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.specular = new THREE.Color().fromArray( materialValues.specularFactor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialValues.specularTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularMap', materialValues.specularTexture.index ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialValues.shininessFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.shininess = materialValues.shininessFactor;\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/* BINARY EXTENSION */\r\n\r\n\tvar BINARY_EXTENSION_BUFFER_NAME = 'binary_glTF';\r\n\tvar BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\r\n\tvar BINARY_EXTENSION_HEADER_LENGTH = 12;\r\n\tvar BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\r\n\r\n\tfunction GLTFBinaryExtension( data ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\r\n\t\tthis.content = null;\r\n\t\tthis.body = null;\r\n\r\n\t\tvar headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\r\n\r\n\t\tthis.header = {\r\n\t\t\tmagic: THREE.LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\r\n\t\t\tversion: headerView.getUint32( 4, true ),\r\n\t\t\tlength: headerView.getUint32( 8, true )\r\n\t\t};\r\n\r\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\r\n\r\n\t\t} else if ( this.header.version < 2.0 ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.' );\r\n\r\n\t\t}\r\n\r\n\t\tvar chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\r\n\t\tvar chunkIndex = 0;\r\n\r\n\t\twhile ( chunkIndex < chunkView.byteLength ) {\r\n\r\n\t\t\tvar chunkLength = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tvar chunkType = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\r\n\r\n\t\t\t\tvar contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\r\n\t\t\t\tthis.content = THREE.LoaderUtils.decodeText( contentArray );\r\n\r\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\r\n\r\n\t\t\t\tvar byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\r\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Clients must ignore chunks with unknown types.\r\n\r\n\t\t\tchunkIndex += chunkLength;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.content === null ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specular-Glossiness Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_pbrSpecularGlossiness\r\n\t */\r\n\tfunction GLTFMaterialsPbrSpecularGlossinessExtension() {\r\n\r\n\t\treturn {\r\n\r\n\t\t\tname: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\r\n\r\n\t\t\tspecularGlossinessParams: [\r\n\t\t\t\t'color',\r\n\t\t\t\t'map',\r\n\t\t\t\t'lightMap',\r\n\t\t\t\t'lightMapIntensity',\r\n\t\t\t\t'aoMap',\r\n\t\t\t\t'aoMapIntensity',\r\n\t\t\t\t'emissive',\r\n\t\t\t\t'emissiveIntensity',\r\n\t\t\t\t'emissiveMap',\r\n\t\t\t\t'bumpMap',\r\n\t\t\t\t'bumpScale',\r\n\t\t\t\t'normalMap',\r\n\t\t\t\t'displacementMap',\r\n\t\t\t\t'displacementScale',\r\n\t\t\t\t'displacementBias',\r\n\t\t\t\t'specularMap',\r\n\t\t\t\t'specular',\r\n\t\t\t\t'glossinessMap',\r\n\t\t\t\t'glossiness',\r\n\t\t\t\t'alphaMap',\r\n\t\t\t\t'envMap',\r\n\t\t\t\t'envMapIntensity',\r\n\t\t\t\t'refractionRatio',\r\n\t\t\t],\r\n\r\n\t\t\tgetMaterialType: function () {\r\n\r\n\t\t\t\treturn THREE.ShaderMaterial;\r\n\r\n\t\t\t},\r\n\r\n\t\t\textendParams: function ( params, material, parser ) {\r\n\r\n\t\t\t\tvar pbrSpecularGlossiness = material.extensions[ this.name ];\r\n\r\n\t\t\t\tvar shader = THREE.ShaderLib[ 'standard' ];\r\n\r\n\t\t\t\tvar uniforms = THREE.UniformsUtils.clone( shader.uniforms );\r\n\r\n\t\t\t\tvar specularMapParsFragmentChunk = [\r\n\t\t\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t\t\t'\tuniform sampler2D specularMap;',\r\n\t\t\t\t\t'#endif'\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar glossinessMapParsFragmentChunk = [\r\n\t\t\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t\t\t'\tuniform sampler2D glossinessMap;',\r\n\t\t\t\t\t'#endif'\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar specularMapFragmentChunk = [\r\n\t\t\t\t\t'vec3 specularFactor = specular;',\r\n\t\t\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\r\n\t\t\t\t\t'\ttexelSpecular = sRGBToLinear( texelSpecular );',\r\n\t\t\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\r\n\t\t\t\t\t'#endif'\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar glossinessMapFragmentChunk = [\r\n\t\t\t\t\t'float glossinessFactor = glossiness;',\r\n\t\t\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\r\n\t\t\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\r\n\t\t\t\t\t'#endif'\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar lightPhysicalFragmentChunk = [\r\n\t\t\t\t\t'PhysicalMaterial material;',\r\n\t\t\t\t\t'material.diffuseColor = diffuseColor.rgb;',\r\n\t\t\t\t\t'material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );',\r\n\t\t\t\t\t'material.specularColor = specularFactor.rgb;',\r\n\t\t\t\t].join( '\\n' );\r\n\r\n\t\t\t\tvar fragmentShader = shader.fragmentShader\r\n\t\t\t\t\t.replace( '#include <specularmap_fragment>', '' )\r\n\t\t\t\t\t.replace( 'uniform float roughness;', 'uniform vec3 specular;' )\r\n\t\t\t\t\t.replace( 'uniform float metalness;', 'uniform float glossiness;' )\r\n\t\t\t\t\t.replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\r\n\t\t\t\t\t.replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\r\n\t\t\t\t\t.replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\r\n\t\t\t\t\t.replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\r\n\t\t\t\t\t.replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\r\n\r\n\t\t\t\tdelete uniforms.roughness;\r\n\t\t\t\tdelete uniforms.metalness;\r\n\t\t\t\tdelete uniforms.roughnessMap;\r\n\t\t\t\tdelete uniforms.metalnessMap;\r\n\r\n\t\t\t\tuniforms.specular = { value: new THREE.Color().setHex( 0x111111 ) };\r\n\t\t\t\tuniforms.glossiness = { value: 0.5 };\r\n\t\t\t\tuniforms.specularMap = { value: null };\r\n\t\t\t\tuniforms.glossinessMap = { value: null };\r\n\r\n\t\t\t\tparams.vertexShader = shader.vertexShader;\r\n\t\t\t\tparams.fragmentShader = fragmentShader;\r\n\t\t\t\tparams.uniforms = uniforms;\r\n\t\t\t\tparams.defines = { 'STANDARD': '' };\r\n\r\n\t\t\t\tparams.color = new THREE.Color( 1.0, 1.0, 1.0 );\r\n\t\t\t\tparams.opacity = 1.0;\r\n\r\n\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\r\n\r\n\t\t\t\t\tvar array = pbrSpecularGlossiness.diffuseFactor;\r\n\r\n\t\t\t\t\tparams.color.fromArray( array );\r\n\t\t\t\t\tparams.opacity = array[ 3 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\r\n\r\n\t\t\t\t\tpending.push( parser.assignTexture( params, 'map', pbrSpecularGlossiness.diffuseTexture.index ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparams.emissive = new THREE.Color( 0.0, 0.0, 0.0 );\r\n\t\t\t\tparams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\r\n\t\t\t\tparams.specular = new THREE.Color( 1.0, 1.0, 1.0 );\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\r\n\r\n\t\t\t\t\tparams.specular.fromArray( pbrSpecularGlossiness.specularFactor );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\r\n\r\n\t\t\t\t\tvar specGlossIndex = pbrSpecularGlossiness.specularGlossinessTexture.index;\r\n\t\t\t\t\tpending.push( parser.assignTexture( params, 'glossinessMap', specGlossIndex ) );\r\n\t\t\t\t\tpending.push( parser.assignTexture( params, 'specularMap', specGlossIndex ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Promise.all( pending );\r\n\r\n\t\t\t},\r\n\r\n\t\t\tcreateMaterial: function ( params ) {\r\n\r\n\t\t\t\t// setup material properties based on MeshStandardMaterial for Specular-Glossiness\r\n\r\n\t\t\t\tvar material = new THREE.ShaderMaterial( {\r\n\t\t\t\t\tdefines: params.defines,\r\n\t\t\t\t\tvertexShader: params.vertexShader,\r\n\t\t\t\t\tfragmentShader: params.fragmentShader,\r\n\t\t\t\t\tuniforms: params.uniforms,\r\n\t\t\t\t\tfog: true,\r\n\t\t\t\t\tlights: true,\r\n\t\t\t\t\topacity: params.opacity,\r\n\t\t\t\t\ttransparent: params.transparent\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tmaterial.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n\t\t\t\tmaterial.color = params.color;\r\n\r\n\t\t\t\tmaterial.map = params.map === undefined ? null : params.map;\r\n\r\n\t\t\t\tmaterial.lightMap = null;\r\n\t\t\t\tmaterial.lightMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.aoMap = params.aoMap === undefined ? null : params.aoMap;\r\n\t\t\t\tmaterial.aoMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.emissive = params.emissive;\r\n\t\t\t\tmaterial.emissiveIntensity = 1.0;\r\n\t\t\t\tmaterial.emissiveMap = params.emissiveMap === undefined ? null : params.emissiveMap;\r\n\r\n\t\t\t\tmaterial.bumpMap = params.bumpMap === undefined ? null : params.bumpMap;\r\n\t\t\t\tmaterial.bumpScale = 1;\r\n\r\n\t\t\t\tmaterial.normalMap = params.normalMap === undefined ? null : params.normalMap;\r\n\t\t\t\tif ( params.normalScale ) material.normalScale = params.normalScale;\r\n\r\n\t\t\t\tmaterial.displacementMap = null;\r\n\t\t\t\tmaterial.displacementScale = 1;\r\n\t\t\t\tmaterial.displacementBias = 0;\r\n\r\n\t\t\t\tmaterial.specularMap = params.specularMap === undefined ? null : params.specularMap;\r\n\t\t\t\tmaterial.specular = params.specular;\r\n\r\n\t\t\t\tmaterial.glossinessMap = params.glossinessMap === undefined ? null : params.glossinessMap;\r\n\t\t\t\tmaterial.glossiness = params.glossiness;\r\n\r\n\t\t\t\tmaterial.alphaMap = null;\r\n\r\n\t\t\t\tmaterial.envMap = params.envMap === undefined ? null : params.envMap;\r\n\t\t\t\tmaterial.envMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.refractionRatio = 0.98;\r\n\r\n\t\t\t\tmaterial.extensions.derivatives = true;\r\n\r\n\t\t\t\treturn material;\r\n\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Clones a GLTFSpecularGlossinessMaterial instance. The ShaderMaterial.copy() method can\r\n\t\t\t * copy only properties it knows about or inherits, and misses many properties that would\r\n\t\t\t * normally be defined by MeshStandardMaterial.\r\n\t\t\t *\r\n\t\t\t * This method allows GLTFSpecularGlossinessMaterials to be cloned in the process of\r\n\t\t\t * loading a glTF model, but cloning later (e.g. by the user) would require these changes\r\n\t\t\t * AND also updating `.onBeforeRender` on the parent mesh.\r\n\t\t\t *\r\n\t\t\t * @param  {THREE.ShaderMaterial} source\r\n\t\t\t * @return {THREE.ShaderMaterial}\r\n\t\t\t */\r\n\t\t\tcloneMaterial: function ( source ) {\r\n\r\n\t\t\t\tvar target = source.clone();\r\n\r\n\t\t\t\ttarget.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n\t\t\t\tvar params = this.specularGlossinessParams;\r\n\r\n\t\t\t\tfor ( var i = 0, il = params.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\ttarget[ params[ i ] ] = source[ params[ i ] ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn target;\r\n\r\n\t\t\t},\r\n\r\n\t\t\t// Here's based on refreshUniformsCommon() and refreshUniformsStandard() in WebGLRenderer.\r\n\t\t\trefreshUniforms: function ( renderer, scene, camera, geometry, material, group ) {\r\n\r\n\t\t\t\tvar uniforms = material.uniforms;\r\n\t\t\t\tvar defines = material.defines;\r\n\r\n\t\t\t\tuniforms.opacity.value = material.opacity;\r\n\r\n\t\t\t\tuniforms.diffuse.value.copy( material.color );\r\n\t\t\t\tuniforms.emissive.value.copy( material.emissive ).multiplyScalar( material.emissiveIntensity );\r\n\r\n\t\t\t\tuniforms.map.value = material.map;\r\n\t\t\t\tuniforms.specularMap.value = material.specularMap;\r\n\t\t\t\tuniforms.alphaMap.value = material.alphaMap;\r\n\r\n\t\t\t\tuniforms.lightMap.value = material.lightMap;\r\n\t\t\t\tuniforms.lightMapIntensity.value = material.lightMapIntensity;\r\n\r\n\t\t\t\tuniforms.aoMap.value = material.aoMap;\r\n\t\t\t\tuniforms.aoMapIntensity.value = material.aoMapIntensity;\r\n\r\n\t\t\t\t// uv repeat and offset setting priorities\r\n\t\t\t\t// 1. color map\r\n\t\t\t\t// 2. specular map\r\n\t\t\t\t// 3. normal map\r\n\t\t\t\t// 4. bump map\r\n\t\t\t\t// 5. alpha map\r\n\t\t\t\t// 6. emissive map\r\n\r\n\t\t\t\tvar uvScaleMap;\r\n\r\n\t\t\t\tif ( material.map ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.map;\r\n\r\n\t\t\t\t} else if ( material.specularMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.specularMap;\r\n\r\n\t\t\t\t} else if ( material.displacementMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.displacementMap;\r\n\r\n\t\t\t\t} else if ( material.normalMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.normalMap;\r\n\r\n\t\t\t\t} else if ( material.bumpMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.bumpMap;\r\n\r\n\t\t\t\t} else if ( material.glossinessMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.glossinessMap;\r\n\r\n\t\t\t\t} else if ( material.alphaMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.alphaMap;\r\n\r\n\t\t\t\t} else if ( material.emissiveMap ) {\r\n\r\n\t\t\t\t\tuvScaleMap = material.emissiveMap;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( uvScaleMap !== undefined ) {\r\n\r\n\t\t\t\t\t// backwards compatibility\r\n\t\t\t\t\tif ( uvScaleMap.isWebGLRenderTarget ) {\r\n\r\n\t\t\t\t\t\tuvScaleMap = uvScaleMap.texture;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar offset;\r\n\t\t\t\t\tvar repeat;\r\n\r\n\t\t\t\t\tif ( uvScaleMap.matrix !== undefined ) {\r\n\r\n\t\t\t\t\t\t// > r88.\r\n\r\n\t\t\t\t\t\tif ( uvScaleMap.matrixAutoUpdate === true ) {\r\n\r\n\t\t\t\t\t\t\toffset = uvScaleMap.offset;\r\n\t\t\t\t\t\t\trepeat = uvScaleMap.repeat;\r\n\t\t\t\t\t\t\tvar rotation = uvScaleMap.rotation;\r\n\t\t\t\t\t\t\tvar center = uvScaleMap.center;\r\n\r\n\t\t\t\t\t\t\tuvScaleMap.matrix.setUvTransform( offset.x, offset.y, repeat.x, repeat.y, rotation, center.x, center.y );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tuniforms.uvTransform.value.copy( uvScaleMap.matrix );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// <= r87. Remove when reasonable.\r\n\r\n\t\t\t\t\t\toffset = uvScaleMap.offset;\r\n\t\t\t\t\t\trepeat = uvScaleMap.repeat;\r\n\r\n\t\t\t\t\t\tuniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuniforms.envMap.value = material.envMap;\r\n\t\t\t\tuniforms.envMapIntensity.value = material.envMapIntensity;\r\n\t\t\t\tuniforms.flipEnvMap.value = ( material.envMap && material.envMap.isCubeTexture ) ? - 1 : 1;\r\n\r\n\t\t\t\tuniforms.refractionRatio.value = material.refractionRatio;\r\n\r\n\t\t\t\tuniforms.specular.value.copy( material.specular );\r\n\t\t\t\tuniforms.glossiness.value = material.glossiness;\r\n\r\n\t\t\t\tuniforms.glossinessMap.value = material.glossinessMap;\r\n\r\n\t\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\r\n\t\t\t\tuniforms.bumpMap.value = material.bumpMap;\r\n\t\t\t\tuniforms.normalMap.value = material.normalMap;\r\n\r\n\t\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t\t\tif ( uniforms.glossinessMap.value !== null && defines.USE_GLOSSINESSMAP === undefined ) {\r\n\r\n\t\t\t\t\tdefines.USE_GLOSSINESSMAP = '';\r\n\t\t\t\t\t// set USE_ROUGHNESSMAP to enable vUv\r\n\t\t\t\t\tdefines.USE_ROUGHNESSMAP = '';\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( uniforms.glossinessMap.value === null && defines.USE_GLOSSINESSMAP !== undefined ) {\r\n\r\n\t\t\t\t\tdelete defines.USE_GLOSSINESSMAP;\r\n\t\t\t\t\tdelete defines.USE_ROUGHNESSMAP;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** INTERNALS ************/\r\n\t/*********************************/\r\n\r\n\t/* CONSTANTS */\r\n\r\n\tvar WEBGL_CONSTANTS = {\r\n\t\tFLOAT: 5126,\r\n\t\t//FLOAT_MAT2: 35674,\r\n\t\tFLOAT_MAT3: 35675,\r\n\t\tFLOAT_MAT4: 35676,\r\n\t\tFLOAT_VEC2: 35664,\r\n\t\tFLOAT_VEC3: 35665,\r\n\t\tFLOAT_VEC4: 35666,\r\n\t\tLINEAR: 9729,\r\n\t\tREPEAT: 10497,\r\n\t\tSAMPLER_2D: 35678,\r\n\t\tPOINTS: 0,\r\n\t\tLINES: 1,\r\n\t\tLINE_LOOP: 2,\r\n\t\tLINE_STRIP: 3,\r\n\t\tTRIANGLES: 4,\r\n\t\tTRIANGLE_STRIP: 5,\r\n\t\tTRIANGLE_FAN: 6,\r\n\t\tUNSIGNED_BYTE: 5121,\r\n\t\tUNSIGNED_SHORT: 5123\r\n\t};\r\n\r\n\tvar WEBGL_TYPE = {\r\n\t\t5126: Number,\r\n\t\t//35674: THREE.Matrix2,\r\n\t\t35675: THREE.Matrix3,\r\n\t\t35676: THREE.Matrix4,\r\n\t\t35664: THREE.Vector2,\r\n\t\t35665: THREE.Vector3,\r\n\t\t35666: THREE.Vector4,\r\n\t\t35678: THREE.Texture\r\n\t};\r\n\r\n\tvar WEBGL_COMPONENT_TYPES = {\r\n\t\t5120: Int8Array,\r\n\t\t5121: Uint8Array,\r\n\t\t5122: Int16Array,\r\n\t\t5123: Uint16Array,\r\n\t\t5125: Uint32Array,\r\n\t\t5126: Float32Array\r\n\t};\r\n\r\n\tvar WEBGL_FILTERS = {\r\n\t\t9728: THREE.NearestFilter,\r\n\t\t9729: THREE.LinearFilter,\r\n\t\t9984: THREE.NearestMipMapNearestFilter,\r\n\t\t9985: THREE.LinearMipMapNearestFilter,\r\n\t\t9986: THREE.NearestMipMapLinearFilter,\r\n\t\t9987: THREE.LinearMipMapLinearFilter\r\n\t};\r\n\r\n\tvar WEBGL_WRAPPINGS = {\r\n\t\t33071: THREE.ClampToEdgeWrapping,\r\n\t\t33648: THREE.MirroredRepeatWrapping,\r\n\t\t10497: THREE.RepeatWrapping\r\n\t};\r\n\r\n\tvar WEBGL_TEXTURE_FORMATS = {\r\n\t\t6406: THREE.AlphaFormat,\r\n\t\t6407: THREE.RGBFormat,\r\n\t\t6408: THREE.RGBAFormat,\r\n\t\t6409: THREE.LuminanceFormat,\r\n\t\t6410: THREE.LuminanceAlphaFormat\r\n\t};\r\n\r\n\tvar WEBGL_TEXTURE_DATATYPES = {\r\n\t\t5121: THREE.UnsignedByteType,\r\n\t\t32819: THREE.UnsignedShort4444Type,\r\n\t\t32820: THREE.UnsignedShort5551Type,\r\n\t\t33635: THREE.UnsignedShort565Type\r\n\t};\r\n\r\n\tvar WEBGL_SIDES = {\r\n\t\t1028: THREE.BackSide, // Culling front\r\n\t\t1029: THREE.FrontSide // Culling back\r\n\t\t//1032: THREE.NoSide   // Culling front and back, what to do?\r\n\t};\r\n\r\n\tvar WEBGL_DEPTH_FUNCS = {\r\n\t\t512: THREE.NeverDepth,\r\n\t\t513: THREE.LessDepth,\r\n\t\t514: THREE.EqualDepth,\r\n\t\t515: THREE.LessEqualDepth,\r\n\t\t516: THREE.GreaterEqualDepth,\r\n\t\t517: THREE.NotEqualDepth,\r\n\t\t518: THREE.GreaterEqualDepth,\r\n\t\t519: THREE.AlwaysDepth\r\n\t};\r\n\r\n\tvar WEBGL_BLEND_EQUATIONS = {\r\n\t\t32774: THREE.AddEquation,\r\n\t\t32778: THREE.SubtractEquation,\r\n\t\t32779: THREE.ReverseSubtractEquation\r\n\t};\r\n\r\n\tvar WEBGL_BLEND_FUNCS = {\r\n\t\t0: THREE.ZeroFactor,\r\n\t\t1: THREE.OneFactor,\r\n\t\t768: THREE.SrcColorFactor,\r\n\t\t769: THREE.OneMinusSrcColorFactor,\r\n\t\t770: THREE.SrcAlphaFactor,\r\n\t\t771: THREE.OneMinusSrcAlphaFactor,\r\n\t\t772: THREE.DstAlphaFactor,\r\n\t\t773: THREE.OneMinusDstAlphaFactor,\r\n\t\t774: THREE.DstColorFactor,\r\n\t\t775: THREE.OneMinusDstColorFactor,\r\n\t\t776: THREE.SrcAlphaSaturateFactor\r\n\t\t// The followings are not supported by Three.js yet\r\n\t\t//32769: CONSTANT_COLOR,\r\n\t\t//32770: ONE_MINUS_CONSTANT_COLOR,\r\n\t\t//32771: CONSTANT_ALPHA,\r\n\t\t//32772: ONE_MINUS_CONSTANT_COLOR\r\n\t};\r\n\r\n\tvar WEBGL_TYPE_SIZES = {\r\n\t\t'SCALAR': 1,\r\n\t\t'VEC2': 2,\r\n\t\t'VEC3': 3,\r\n\t\t'VEC4': 4,\r\n\t\t'MAT2': 4,\r\n\t\t'MAT3': 9,\r\n\t\t'MAT4': 16\r\n\t};\r\n\r\n\tvar PATH_PROPERTIES = {\r\n\t\tscale: 'scale',\r\n\t\ttranslation: 'position',\r\n\t\trotation: 'quaternion',\r\n\t\tweights: 'morphTargetInfluences'\r\n\t};\r\n\r\n\tvar INTERPOLATION = {\r\n\t\tCUBICSPLINE: THREE.InterpolateSmooth,\r\n\t\tLINEAR: THREE.InterpolateLinear,\r\n\t\tSTEP: THREE.InterpolateDiscrete\r\n\t};\r\n\r\n\tvar STATES_ENABLES = {\r\n\t\t2884: 'CULL_FACE',\r\n\t\t2929: 'DEPTH_TEST',\r\n\t\t3042: 'BLEND',\r\n\t\t3089: 'SCISSOR_TEST',\r\n\t\t32823: 'POLYGON_OFFSET_FILL',\r\n\t\t32926: 'SAMPLE_ALPHA_TO_COVERAGE'\r\n\t};\r\n\r\n\tvar ALPHA_MODES = {\r\n\t\tOPAQUE: 'OPAQUE',\r\n\t\tMASK: 'MASK',\r\n\t\tBLEND: 'BLEND'\r\n\t};\r\n\r\n\t/* UTILITY FUNCTIONS */\r\n\r\n\tfunction resolveURL( url, path ) {\r\n\r\n\t\t// Invalid URL\r\n\t\tif ( typeof url !== 'string' || url === '' ) return '';\r\n\r\n\t\t// Absolute URL http://,https://,//\r\n\t\tif ( /^(https?:)?\\/\\//i.test( url ) ) return url;\r\n\r\n\t\t// Data URI\r\n\t\tif ( /^data:.*,.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Blob URL\r\n\t\tif ( /^blob:.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Relative URL\r\n\t\treturn path + url;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\r\n\t */\r\n\tfunction createDefaultMaterial() {\r\n\r\n\t\treturn new THREE.MeshStandardMaterial( {\r\n\t\t\tcolor: 0xFFFFFF,\r\n\t\t\temissive: 0x000000,\r\n\t\t\tmetalness: 1,\r\n\t\t\troughness: 1,\r\n\t\t\ttransparent: false,\r\n\t\t\tdepthTest: true,\r\n\t\t\tside: THREE.FrontSide\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\r\n\t *\r\n\t * TODO: Implement support for morph targets on TANGENT attribute.\r\n\t *\r\n\t * @param {THREE.Mesh} mesh\r\n\t * @param {GLTF.Mesh} meshDef\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {Array<THREE.BufferAttribute>} accessors\r\n\t */\r\n\tfunction addMorphTargets( mesh, meshDef, primitiveDef, accessors ) {\r\n\r\n\t\tvar geometry = mesh.geometry;\r\n\t\tvar material = mesh.material;\r\n\r\n\t\tvar targets = primitiveDef.targets;\r\n\t\tvar morphAttributes = geometry.morphAttributes;\r\n\r\n\t\tmorphAttributes.position = [];\r\n\t\tmorphAttributes.normal = [];\r\n\r\n\t\tmaterial.morphTargets = true;\r\n\r\n\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar target = targets[ i ];\r\n\t\t\tvar attributeName = 'morphTarget' + i;\r\n\r\n\t\t\tvar positionAttribute, normalAttribute;\r\n\r\n\t\t\tif ( target.POSITION !== undefined ) {\r\n\r\n\t\t\t\t// Three.js morph formula is\r\n\t\t\t\t//   position\r\n\t\t\t\t//     + weight0 * ( morphTarget0 - position )\r\n\t\t\t\t//     + weight1 * ( morphTarget1 - position )\r\n\t\t\t\t//     ...\r\n\t\t\t\t// while the glTF one is\r\n\t\t\t\t//   position\r\n\t\t\t\t//     + weight0 * morphTarget0\r\n\t\t\t\t//     + weight1 * morphTarget1\r\n\t\t\t\t//     ...\r\n\t\t\t\t// then adding position to morphTarget.\r\n\t\t\t\t// So morphTarget value will depend on mesh's position, then cloning attribute\r\n\t\t\t\t// for the case if attribute is shared among two or more meshes.\r\n\r\n\t\t\t\tpositionAttribute = accessors[ target.POSITION ].clone();\r\n\t\t\t\tvar position = geometry.attributes.position;\r\n\r\n\t\t\t\tfor ( var j = 0, jl = positionAttribute.count; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tpositionAttribute.setXYZ(\r\n\t\t\t\t\t\tj,\r\n\t\t\t\t\t\tpositionAttribute.getX( j ) + position.getX( j ),\r\n\t\t\t\t\t\tpositionAttribute.getY( j ) + position.getY( j ),\r\n\t\t\t\t\t\tpositionAttribute.getZ( j ) + position.getZ( j )\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( geometry.attributes.position ) {\r\n\r\n\t\t\t\t// Copying the original position not to affect the final position.\r\n\t\t\t\t// See the formula above.\r\n\t\t\t\tpositionAttribute = geometry.attributes.position.clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( positionAttribute !== undefined ) {\r\n\r\n\t\t\t\tpositionAttribute.name = attributeName;\r\n\t\t\t\tmorphAttributes.position.push( positionAttribute );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( target.NORMAL !== undefined ) {\r\n\r\n\t\t\t\tmaterial.morphNormals = true;\r\n\r\n\t\t\t\t// see target.POSITION's comment\r\n\r\n\t\t\t\tnormalAttribute = accessors[ target.NORMAL ].clone();\r\n\t\t\t\tvar normal = geometry.attributes.normal;\r\n\r\n\t\t\t\tfor ( var j = 0, jl = normalAttribute.count; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tnormalAttribute.setXYZ(\r\n\t\t\t\t\t\tj,\r\n\t\t\t\t\t\tnormalAttribute.getX( j ) + normal.getX( j ),\r\n\t\t\t\t\t\tnormalAttribute.getY( j ) + normal.getY( j ),\r\n\t\t\t\t\t\tnormalAttribute.getZ( j ) + normal.getZ( j )\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( geometry.attributes.normal !== undefined ) {\r\n\r\n\t\t\t\tnormalAttribute = geometry.attributes.normal.clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( normalAttribute !== undefined ) {\r\n\r\n\t\t\t\tnormalAttribute.name = attributeName;\r\n\t\t\t\tmorphAttributes.normal.push( normalAttribute );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tmesh.updateMorphTargets();\r\n\r\n\t\tif ( meshDef.weights !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, il = meshDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction isPrimitiveEqual( a, b ) {\r\n\r\n\t\tif ( a.indices !== b.indices ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\tvar attribA = a.attributes || {};\r\n\t\tvar attribB = b.attributes || {};\r\n\t\tvar keysA = Object.keys( attribA );\r\n\t\tvar keysB = Object.keys( attribB );\r\n\r\n\t\tif ( keysA.length !== keysB.length ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = keysA.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar key = keysA[ i ];\r\n\r\n\t\t\tif ( attribA[ key ] !== attribB[ key ] ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tfunction getCachedGeometry( cache, newPrimitive ) {\r\n\r\n\t\tfor ( var i = 0, il = cache.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar cached = cache[ i ];\r\n\r\n\t\t\tif ( isPrimitiveEqual( cached.primitive, newPrimitive ) ) {\r\n\r\n\t\t\t\treturn cached.geometry;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t/* GLTF PARSER */\r\n\r\n\tfunction GLTFParser( json, extensions, options ) {\r\n\r\n\t\tthis.json = json || {};\r\n\t\tthis.extensions = extensions || {};\r\n\t\tthis.options = options || {};\r\n\r\n\t\t// loader object cache\r\n\t\tthis.cache = new GLTFRegistry();\r\n\r\n\t\t// BufferGeometry caching\r\n\t\tthis.primitiveCache = [];\r\n\r\n\t\tthis.textureLoader = new THREE.TextureLoader( this.options.manager );\r\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\r\n\r\n\t\tthis.fileLoader = new THREE.FileLoader( this.options.manager );\r\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\r\n\r\n\t}\r\n\r\n\tGLTFParser.prototype.parse = function ( onLoad, onError ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar parser = this;\r\n\r\n\t\t// Clear the loader cache\r\n\t\tthis.cache.removeAll();\r\n\r\n\t\t// Mark the special nodes/meshes in json for efficient parse\r\n\t\tthis.markDefs();\r\n\r\n\t\t// Fire the callback on complete\r\n\t\tthis.getMultiDependencies( [\r\n\r\n\t\t\t'scene',\r\n\t\t\t'animation',\r\n\t\t\t'camera'\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar scenes = dependencies.scenes || [];\r\n\t\t\tvar scene = scenes[ json.scene || 0 ];\r\n\t\t\tvar animations = dependencies.animations || [];\r\n\t\t\tvar asset = json.asset;\r\n\t\t\tvar cameras = dependencies.cameras || [];\r\n\r\n\t\t\tonLoad( scene, scenes, cameras, animations, asset );\r\n\r\n\t\t} ).catch( onError );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Marks the special nodes/meshes in json for efficient parse.\r\n\t */\r\n\tGLTFParser.prototype.markDefs = function () {\r\n\r\n\t\tvar nodeDefs = this.json.nodes || [];\r\n\t\tvar skinDefs = this.json.skins || [];\r\n\t\tvar meshDefs = this.json.meshes || [];\r\n\r\n\t\tvar meshReferences = {};\r\n\t\tvar meshUses = {};\r\n\r\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\r\n\t\t// Object3D. Use the skins' joint references to mark bones.\r\n\t\tfor ( var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\r\n\r\n\t\t\tvar joints = skinDefs[ skinIndex ].joints;\r\n\r\n\t\t\tfor ( var i = 0, il = joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Meshes can (and should) be reused by multiple nodes in a glTF asset. To\r\n\t\t// avoid having more than one THREE.Mesh with the same name, count\r\n\t\t// references and rename instances below.\r\n\t\t//\r\n\t\t// Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\r\n\t\tfor ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\r\n\r\n\t\t\tvar nodeDef = nodeDefs[ nodeIndex ];\r\n\r\n\t\t\tif ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tif ( meshReferences[ nodeDef.mesh ] === undefined ) {\r\n\r\n\t\t\t\t\tmeshReferences[ nodeDef.mesh ] = meshUses[ nodeDef.mesh ] = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmeshReferences[ nodeDef.mesh ] ++;\r\n\r\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\r\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\r\n\t\t\t\t// to mark SkinnedMesh if node has skin.\r\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\r\n\r\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.json.meshReferences = meshReferences;\r\n\t\tthis.json.meshUses = meshUses;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests the specified dependency asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @param {number} index\r\n\t * @return {Promise<Object>}\r\n\t */\r\n\tGLTFParser.prototype.getDependency = function ( type, index ) {\r\n\r\n\t\tvar cacheKey = type + ':' + index;\r\n\t\tvar dependency = this.cache.get( cacheKey );\r\n\r\n\t\tif ( ! dependency ) {\r\n\r\n\t\t\tvar fnName = 'load' + type.charAt( 0 ).toUpperCase() + type.slice( 1 );\r\n\t\t\tdependency = this[ fnName ]( index );\r\n\t\t\tthis.cache.add( cacheKey, dependency );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependency;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests all dependencies of the specified type asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @return {Promise<Array<Object>>}\r\n\t */\r\n\tGLTFParser.prototype.getDependencies = function ( type ) {\r\n\r\n\t\tvar dependencies = this.cache.get( type );\r\n\r\n\t\tif ( ! dependencies ) {\r\n\r\n\t\t\tvar parser = this;\r\n\t\t\tvar defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\r\n\r\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\r\n\r\n\t\t\t\treturn parser.getDependency( type, index );\r\n\r\n\t\t\t} ) );\r\n\r\n\t\t\tthis.cache.add( type, dependencies );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependencies;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests all multiple dependencies of the specified types asynchronously, with caching.\r\n\t * @param {Array<string>} types\r\n\t * @return {Promise<Object<Array<Object>>>}\r\n\t */\r\n\tGLTFParser.prototype.getMultiDependencies = function ( types ) {\r\n\r\n\t\tvar results = {};\r\n\t\tvar pendings = [];\r\n\r\n\t\tfor ( var i = 0, il = types.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar type = types[ i ];\r\n\t\t\tvar value = this.getDependencies( type );\r\n\r\n\t\t\tvalue = value.then( function ( key, value ) {\r\n\r\n\t\t\t\tresults[ key ] = value;\r\n\r\n\t\t\t}.bind( this, type + ( type === 'mesh' ? 'es' : 's' ) ) );\r\n\r\n\t\t\tpendings.push( value );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pendings ).then( function () {\r\n\r\n\t\t\treturn results;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBuffer = function ( bufferIndex ) {\r\n\r\n\t\tvar bufferDef = this.json.buffers[ bufferIndex ];\r\n\t\tvar loader = this.fileLoader;\r\n\r\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\r\n\r\n\t\t}\r\n\r\n\t\t// If present, GLB container is required to be the first buffer.\r\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\r\n\r\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\r\n\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\tloader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\r\n\r\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferViewIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBufferView = function ( bufferViewIndex ) {\r\n\r\n\t\tvar bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\r\n\r\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\r\n\r\n\t\t\tvar byteLength = bufferViewDef.byteLength || 0;\r\n\t\t\tvar byteOffset = bufferViewDef.byteOffset || 0;\r\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\r\n\t * @param {number} accessorIndex\r\n\t * @return {Promise<THREE.BufferAttribute|THREE.InterleavedBufferAttribute>}\r\n\t */\r\n\tGLTFParser.prototype.loadAccessor = function ( accessorIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar accessorDef = this.json.accessors[ accessorIndex ];\r\n\r\n\t\tvar pendingBufferViews = [];\r\n\r\n\t\tif ( accessorDef.bufferView !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tpendingBufferViews.push( null );\r\n\r\n\t\t}\r\n\r\n\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\r\n\r\n\t\t\tvar bufferView = bufferViews[ 0 ];\r\n\r\n\t\t\tvar itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\r\n\t\t\tvar TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\r\n\t\t\tvar elementBytes = TypedArray.BYTES_PER_ELEMENT;\r\n\t\t\tvar itemBytes = elementBytes * itemSize;\r\n\t\t\tvar byteStride = json.bufferViews[ accessorDef.bufferView ].byteStride;\r\n\t\t\tvar normalized = accessorDef.normalized === true;\r\n\t\t\tvar array, bufferAttribute;\r\n\r\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\r\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\r\n\r\n\t\t\t\t// Use the full buffer if it's interleaved.\r\n\t\t\t\tarray = new TypedArray( bufferView );\r\n\r\n\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\r\n\t\t\t\tvar ib = new THREE.InterleavedBuffer( array, byteStride / elementBytes );\r\n\r\n\t\t\t\tbufferAttribute = new THREE.InterleavedBufferAttribute( ib, itemSize, accessorDef.byteOffset / elementBytes, normalized );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( bufferView === null ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, accessorDef.byteOffset, accessorDef.count * itemSize );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new THREE.BufferAttribute( array, itemSize, normalized );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\r\n\t\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\t\tvar itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\r\n\t\t\t\tvar TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\r\n\r\n\t\t\t\tvar byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\r\n\t\t\t\tvar byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\r\n\r\n\t\t\t\tvar sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\r\n\t\t\t\tvar sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\r\n\r\n\t\t\t\tif ( bufferView !== null ) {\r\n\r\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\r\n\t\t\t\t\tbufferAttribute.setArray( bufferAttribute.array.slice() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var i = 0, il = sparseIndices.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar index = sparseIndices[ i ];\r\n\r\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\r\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\r\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\r\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\r\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn bufferAttribute;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\r\n\t * @param {number} textureIndex\r\n\t * @return {Promise<THREE.Texture>}\r\n\t */\r\n\tGLTFParser.prototype.loadTexture = function ( textureIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar options = this.options;\r\n\t\tvar textureLoader = this.textureLoader;\r\n\r\n\t\tvar URL = window.URL || window.webkitURL;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\t\tvar source = json.images[ textureDef.source ];\r\n\t\tvar sourceURI = source.uri;\r\n\t\tvar isObjectURL = false;\r\n\r\n\t\tif ( source.bufferView !== undefined ) {\r\n\r\n\t\t\t// Load binary image data from bufferView, if provided.\r\n\r\n\t\t\tsourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\r\n\r\n\t\t\t\tisObjectURL = true;\r\n\t\t\t\tvar blob = new Blob( [ bufferView ], { type: source.mimeType } );\r\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\r\n\t\t\t\treturn sourceURI;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve( sourceURI ).then( function ( sourceURI ) {\r\n\r\n\t\t\t// Load Texture resource.\r\n\r\n\t\t\tvar loader = THREE.Loader.Handlers.get( sourceURI ) || textureLoader;\r\n\r\n\t\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\t\tloader.load( resolveURL( sourceURI, options.path ), resolve, undefined, reject );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} ).then( function ( texture ) {\r\n\r\n\t\t\t// Clean up resources and configure Texture.\r\n\r\n\t\t\tif ( isObjectURL === true ) {\r\n\r\n\t\t\t\tURL.revokeObjectURL( sourceURI );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.flipY = false;\r\n\r\n\t\t\tif ( textureDef.name !== undefined ) texture.name = textureDef.name;\r\n\r\n\t\t\ttexture.format = textureDef.format !== undefined ? WEBGL_TEXTURE_FORMATS[ textureDef.format ] : THREE.RGBAFormat;\r\n\r\n\t\t\tif ( textureDef.internalFormat !== undefined && texture.format !== WEBGL_TEXTURE_FORMATS[ textureDef.internalFormat ] ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. ' +\r\n\t\t\t\t\t\t\t\t\t\t\t'internalFormat will be forced to be the same value as format.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.type = textureDef.type !== undefined ? WEBGL_TEXTURE_DATATYPES[ textureDef.type ] : THREE.UnsignedByteType;\r\n\r\n\t\t\tvar samplers = json.samplers || {};\r\n\t\t\tvar sampler = samplers[ textureDef.sampler ] || {};\r\n\r\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || THREE.LinearFilter;\r\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || THREE.LinearMipMapLinearFilter;\r\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || THREE.RepeatWrapping;\r\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || THREE.RepeatWrapping;\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Asynchronously assigns a texture to the given material parameters.\r\n\t * @param {Object} materialParams\r\n\t * @param {string} textureName\r\n\t * @param {number} textureIndex\r\n\t * @return {Promise}\r\n\t */\r\n\tGLTFParser.prototype.assignTexture = function ( materialParams, textureName, textureIndex ) {\r\n\r\n\t\treturn this.getDependency( 'texture', textureIndex ).then( function ( texture ) {\r\n\r\n\t\t\tmaterialParams[ textureName ] = texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\r\n\t * @param {number} materialIndex\r\n\t * @return {Promise<THREE.Material>}\r\n\t */\r\n\tGLTFParser.prototype.loadMaterial = function ( materialIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar materialDef = this.json.materials[ materialIndex ];\r\n\r\n\t\tvar materialType;\r\n\t\tvar materialParams = {};\r\n\t\tvar materialExtensions = materialDef.extensions || {};\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] ) {\r\n\r\n\t\t\tvar khcExtension = extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ];\r\n\t\t\tmaterialType = khcExtension.getMaterialType( materialDef );\r\n\t\t\tpending.push( khcExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\r\n\r\n\t\t\tvar sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\r\n\t\t\tmaterialType = sgExtension.getMaterialType( materialDef );\r\n\t\t\tpending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else if ( materialDef.pbrMetallicRoughness !== undefined ) {\r\n\r\n\t\t\t// Specification:\r\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\r\n\r\n\t\t\tmaterialType = THREE.MeshStandardMaterial;\r\n\r\n\t\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness;\r\n\r\n\t\t\tmaterialParams.color = new THREE.Color( 1.0, 1.0, 1.0 );\r\n\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture.index ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\r\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\r\n\r\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\r\n\r\n\t\t\t\tvar textureIndex = metallicRoughness.metallicRoughnessTexture.index;\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', textureIndex ) );\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', textureIndex ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterialType = THREE.MeshPhongMaterial;\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.doubleSided === true ) {\r\n\r\n\t\t\tmaterialParams.side = THREE.DoubleSide;\r\n\r\n\t\t}\r\n\r\n\t\tvar alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\r\n\r\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\r\n\r\n\t\t\tmaterialParams.transparent = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterialParams.transparent = false;\r\n\r\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\r\n\r\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.normalTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture.index ) );\r\n\r\n\t\t\tmaterialParams.normalScale = new THREE.Vector2( 1, 1 );\r\n\r\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.normalScale.set( materialDef.normalTexture.scale, materialDef.normalTexture.scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.occlusionTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture.index ) );\r\n\r\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveFactor !== undefined ) {\r\n\r\n\t\t\tif ( materialType === THREE.MeshBasicMaterial ) {\r\n\r\n\t\t\t\tmaterialParams.color = new THREE.Color().fromArray( materialDef.emissiveFactor );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterialParams.emissive = new THREE.Color().fromArray( materialDef.emissiveFactor );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveTexture !== undefined ) {\r\n\r\n\t\t\tif ( materialType === THREE.MeshBasicMaterial ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', materialDef.emissiveTexture.index ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture.index ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\tvar material;\r\n\r\n\t\t\tif ( materialType === THREE.ShaderMaterial ) {\r\n\r\n\t\t\t\tmaterial = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterial = new materialType( materialParams );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialDef.name !== undefined ) material.name = materialDef.name;\r\n\r\n\t\t\t// Normal map textures use OpenGL conventions:\r\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#materialnormaltexture\r\n\t\t\tif ( material.normalScale ) {\r\n\r\n\t\t\t\tmaterial.normalScale.x = - material.normalScale.x;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// emissiveTexture and baseColorTexture use sRGB encoding.\r\n\t\t\tif ( material.map ) material.map.encoding = THREE.sRGBEncoding;\r\n\t\t\tif ( material.emissiveMap ) material.emissiveMap.encoding = THREE.sRGBEncoding;\r\n\r\n\t\t\tif ( materialDef.extras ) material.userData = materialDef.extras;\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\r\n\t * @param {Array<Object>} primitives\r\n\t * @return {Promise<Array<THREE.BufferGeometry>>}\r\n\t */\r\n\tGLTFParser.prototype.loadGeometries = function ( primitives ) {\r\n\r\n\t\tvar cache = this.primitiveCache;\r\n\r\n\t\treturn this.getDependencies( 'accessor' ).then( function ( accessors ) {\r\n\r\n\t\t\tvar geometries = [];\r\n\r\n\t\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar primitive = primitives[ i ];\r\n\r\n\t\t\t\t// See if we've already created this geometry\r\n\t\t\t\tvar cached = getCachedGeometry( cache, primitive );\r\n\r\n\t\t\t\tif ( cached ) {\r\n\r\n\t\t\t\t\t// Use the cached geometry if it exists\r\n\t\t\t\t\tgeometries.push( cached );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Otherwise create a new geometry\r\n\t\t\t\t\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\t\t\t\t\tvar attributes = primitive.attributes;\r\n\r\n\t\t\t\t\tfor ( var attributeId in attributes ) {\r\n\r\n\t\t\t\t\t\tvar attributeEntry = attributes[ attributeId ];\r\n\r\n\t\t\t\t\t\tvar bufferAttribute = accessors[ attributeEntry ];\r\n\r\n\t\t\t\t\t\tswitch ( attributeId ) {\r\n\r\n\t\t\t\t\t\t\tcase 'POSITION':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'position', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'NORMAL':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'normal', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'TEXCOORD_0':\r\n\t\t\t\t\t\t\tcase 'TEXCOORD0':\r\n\t\t\t\t\t\t\tcase 'TEXCOORD':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'uv', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'TEXCOORD_1':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'uv2', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'COLOR_0':\r\n\t\t\t\t\t\t\tcase 'COLOR0':\r\n\t\t\t\t\t\t\tcase 'COLOR':\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'color', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'WEIGHTS_0':\r\n\t\t\t\t\t\t\tcase 'WEIGHT': // WEIGHT semantic deprecated.\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'skinWeight', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 'JOINTS_0':\r\n\t\t\t\t\t\t\tcase 'JOINT': // JOINT semantic deprecated.\r\n\r\n\t\t\t\t\t\t\t\tgeometry.addAttribute( 'skinIndex', bufferAttribute );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( primitive.indices !== undefined ) {\r\n\r\n\t\t\t\t\t\tgeometry.setIndex( accessors[ primitive.indices ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Cache this geometry\r\n\t\t\t\t\tcache.push( {\r\n\r\n\t\t\t\t\t\tprimitive: primitive,\r\n\t\t\t\t\t\tgeometry: geometry\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\tgeometries.push( geometry );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn geometries;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\r\n\t * @param {number} meshIndex\r\n\t * @return {Promise<THREE.Group|THREE.Mesh|THREE.SkinnedMesh>}\r\n\t */\r\n\tGLTFParser.prototype.loadMesh = function ( meshIndex ) {\r\n\r\n\t\tvar scope = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\tvar meshDef = this.json.meshes[ meshIndex ];\r\n\r\n\t\treturn this.getMultiDependencies( [\r\n\r\n\t\t\t'accessor',\r\n\t\t\t'material'\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar group = new THREE.Group();\r\n\r\n\t\t\tvar primitives = meshDef.primitives;\r\n\r\n\t\t\treturn scope.loadGeometries( primitives ).then( function ( geometries ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar primitive = primitives[ i ];\r\n\t\t\t\t\tvar geometry = geometries[ i ];\r\n\r\n\t\t\t\t\tvar material = primitive.material === undefined\r\n\t\t\t\t\t\t? createDefaultMaterial()\r\n\t\t\t\t\t\t: dependencies.materials[ primitive.material ];\r\n\r\n\t\t\t\t\tif ( material.aoMap\r\n\t\t\t\t\t\t\t&& geometry.attributes.uv2 === undefined\r\n\t\t\t\t\t\t\t&& geometry.attributes.uv !== undefined ) {\r\n\r\n\t\t\t\t\t\tconsole.log( 'THREE.GLTFLoader: Duplicating UVs to support aoMap.' );\r\n\t\t\t\t\t\tgeometry.addAttribute( 'uv2', new THREE.BufferAttribute( geometry.attributes.uv.array, 2 ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the material will be modified later on, clone it now.\r\n\t\t\t\t\tvar useVertexColors = geometry.attributes.color !== undefined;\r\n\t\t\t\t\tvar useFlatShading = geometry.attributes.normal === undefined;\r\n\t\t\t\t\tvar useSkinning = meshDef.isSkinnedMesh === true;\r\n\t\t\t\t\tvar useMorphTargets = primitive.targets !== undefined;\r\n\r\n\t\t\t\t\tif ( useVertexColors || useFlatShading || useSkinning || useMorphTargets ) {\r\n\r\n\t\t\t\t\t\tif ( material.isGLTFSpecularGlossinessMaterial ) {\r\n\r\n\t\t\t\t\t\t\tvar specGlossExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\r\n\t\t\t\t\t\t\tmaterial = specGlossExtension.cloneMaterial( material );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tmaterial = material.clone();\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( useVertexColors ) {\r\n\r\n\t\t\t\t\t\tmaterial.vertexColors = THREE.VertexColors;\r\n\t\t\t\t\t\tmaterial.needsUpdate = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( useFlatShading ) {\r\n\r\n\t\t\t\t\t\tmaterial.flatShading = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar mesh;\r\n\r\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\r\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\r\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\r\n\t\t\t\t\t\tprimitive.mode === undefined ) {\r\n\r\n\t\t\t\t\t\tif ( useSkinning ) {\r\n\r\n\t\t\t\t\t\t\tmesh = new THREE.SkinnedMesh( geometry, material );\r\n\t\t\t\t\t\t\tmaterial.skinning = true;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tmesh = new THREE.Mesh( geometry, material );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\r\n\r\n\t\t\t\t\t\t\tmesh.drawMode = THREE.TriangleStripDrawMode;\r\n\r\n\t\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\r\n\r\n\t\t\t\t\t\t\tmesh.drawMode = THREE.TriangleFanDrawMode;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\r\n\r\n\t\t\t\t\t\tmesh = new THREE.LineSegments( geometry, material );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\r\n\r\n\t\t\t\t\t\tmesh = new THREE.Line( geometry, material );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\r\n\r\n\t\t\t\t\t\tmesh = new THREE.LineLoop( geometry, material );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\r\n\r\n\t\t\t\t\t\tmesh = new THREE.Points( geometry, material );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmesh.name = meshDef.name || ( 'mesh_' + meshIndex );\r\n\r\n\t\t\t\t\tif ( useMorphTargets ) {\r\n\r\n\t\t\t\t\t\taddMorphTargets( mesh, meshDef, primitive, dependencies.accessors );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( meshDef.extras !== undefined ) mesh.userData = meshDef.extras;\r\n\t\t\t\t\tif ( primitive.extras !== undefined ) mesh.geometry.userData = primitive.extras;\r\n\r\n\t\t\t\t\t// for Specular-Glossiness.\r\n\t\t\t\t\tif ( material.isGLTFSpecularGlossinessMaterial === true ) {\r\n\r\n\t\t\t\t\t\tmesh.onBeforeRender = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].refreshUniforms;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( primitives.length > 1 ) {\r\n\r\n\t\t\t\t\t\tmesh.name += '_' + i;\r\n\r\n\t\t\t\t\t\tgroup.add( mesh );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\treturn mesh;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn group;\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\r\n\t * @param {number} cameraIndex\r\n\t * @return {Promise<THREE.Camera>}\r\n\t */\r\n\tGLTFParser.prototype.loadCamera = function ( cameraIndex ) {\r\n\r\n\t\tvar camera;\r\n\t\tvar cameraDef = this.json.cameras[ cameraIndex ];\r\n\t\tvar params = cameraDef[ cameraDef.type ];\r\n\r\n\t\tif ( ! params ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.type === 'perspective' ) {\r\n\r\n\t\t\tvar aspectRatio = params.aspectRatio || 1;\r\n\t\t\tvar xfov = params.yfov * aspectRatio;\r\n\r\n\t\t\tcamera = new THREE.PerspectiveCamera( THREE.Math.radToDeg( xfov ), aspectRatio, params.znear || 1, params.zfar || 2e6 );\r\n\r\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\r\n\r\n\t\t\tcamera = new THREE.OrthographicCamera( params.xmag / - 2, params.xmag / 2, params.ymag / 2, params.ymag / - 2, params.znear, params.zfar );\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.name !== undefined ) camera.name = cameraDef.name;\r\n\t\tif ( cameraDef.extras ) camera.userData = cameraDef.extras;\r\n\r\n\t\treturn Promise.resolve( camera );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\r\n\t * @param {number} skinIndex\r\n\t * @return {Promise<Object>}\r\n\t */\r\n\tGLTFParser.prototype.loadSkin = function ( skinIndex ) {\r\n\r\n\t\tvar skinDef = this.json.skins[ skinIndex ];\r\n\r\n\t\tvar skinEntry = { joints: skinDef.joints };\r\n\r\n\t\tif ( skinDef.inverseBindMatrices === undefined ) {\r\n\r\n\t\t\treturn Promise.resolve( skinEntry );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\r\n\r\n\t\t\tskinEntry.inverseBindMatrices = accessor;\r\n\r\n\t\t\treturn skinEntry;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\r\n\t * @param {number} animationIndex\r\n\t * @return {Promise<THREE.AnimationClip>}\r\n\t */\r\n\tGLTFParser.prototype.loadAnimation = function ( animationIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar animationDef = this.json.animations[ animationIndex ];\r\n\r\n\t\treturn this.getMultiDependencies( [\r\n\r\n\t\t\t'accessor',\r\n\t\t\t'node'\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tfor ( var i = 0, il = animationDef.channels.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar channel = animationDef.channels[ i ];\r\n\t\t\t\tvar sampler = animationDef.samplers[ channel.sampler ];\r\n\r\n\t\t\t\tif ( sampler ) {\r\n\r\n\t\t\t\t\tvar target = channel.target;\r\n\t\t\t\t\tvar name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\r\n\t\t\t\t\tvar input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\r\n\t\t\t\t\tvar output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\r\n\r\n\t\t\t\t\tvar inputAccessor = dependencies.accessors[ input ];\r\n\t\t\t\t\tvar outputAccessor = dependencies.accessors[ output ];\r\n\r\n\t\t\t\t\tvar node = dependencies.nodes[ name ];\r\n\r\n\t\t\t\t\tif ( node ) {\r\n\r\n\t\t\t\t\t\tnode.updateMatrix();\r\n\t\t\t\t\t\tnode.matrixAutoUpdate = true;\r\n\r\n\t\t\t\t\t\tvar TypedKeyframeTrack;\r\n\r\n\t\t\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\r\n\r\n\t\t\t\t\t\t\tcase PATH_PROPERTIES.weights:\r\n\r\n\t\t\t\t\t\t\t\tTypedKeyframeTrack = THREE.NumberKeyframeTrack;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase PATH_PROPERTIES.rotation:\r\n\r\n\t\t\t\t\t\t\t\tTypedKeyframeTrack = THREE.QuaternionKeyframeTrack;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase PATH_PROPERTIES.position:\r\n\t\t\t\t\t\t\tcase PATH_PROPERTIES.scale:\r\n\t\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\t\tTypedKeyframeTrack = THREE.VectorKeyframeTrack;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar targetName = node.name ? node.name : node.uuid;\r\n\r\n\t\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\r\n\r\n\t\t\t\t\t\t\tvar itemSize = outputAccessor.itemSize;\r\n\t\t\t\t\t\t\tvar TypedArray = outputAccessor.array.constructor;\r\n\t\t\t\t\t\t\tvar outputAccessorValues = new TypedArray( outputAccessor.count * itemSize / 3 );\r\n\r\n\t\t\t\t\t\t\t// Layout of keyframe output values for CUBICSPLINE animations:\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\t//   [ inTangent1, splineVertex1, outTangent1, inTangent2, splineVertex2, ... ]\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\t// THREE.KeyframeTrack infers tangents from the spline vertices when interpolating:\r\n\t\t\t\t\t\t\t// those values are extracted below. This still guarantees smooth curves, but does\r\n\t\t\t\t\t\t\t// throw away more precise information in the tangents. In the future, consider\r\n\t\t\t\t\t\t\t// re-sampling at a higher framerate using the tangents provided.\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\t// See: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\r\n\r\n\t\t\t\t\t\t\tfor ( var j = 0, jl = outputAccessor.count; j < jl; j += 3 ) {\r\n\r\n\t\t\t\t\t\t\t\toutputAccessorValues[ j * itemSize / 3 ] = outputAccessor.getX( j + 1 );\r\n\t\t\t\t\t\t\t\tif ( itemSize > 1 ) outputAccessorValues[ j * itemSize / 3 + 1 ] = outputAccessor.getY( j + 1 );\r\n\t\t\t\t\t\t\t\tif ( itemSize > 2 ) outputAccessorValues[ j * itemSize / 3 + 2 ] = outputAccessor.getZ( j + 1 );\r\n\t\t\t\t\t\t\t\tif ( itemSize > 3 ) outputAccessorValues[ j * itemSize / 3 + 3 ] = outputAccessor.getW( j + 1 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\toutputAccessor = new THREE.BufferAttribute( outputAccessorValues, itemSize / 3, outputAccessor.normalized );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : THREE.InterpolateLinear;\r\n\r\n\t\t\t\t\t\tvar targetNames = [];\r\n\r\n\t\t\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\r\n\r\n\t\t\t\t\t\t\t// node should be THREE.Group here but\r\n\t\t\t\t\t\t\t// PATH_PROPERTIES.weights(morphTargetInfluences) should be\r\n\t\t\t\t\t\t\t// the property of a mesh object under node.\r\n\t\t\t\t\t\t\t// So finding targets here.\r\n\r\n\t\t\t\t\t\t\tnode.traverse( function ( object ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( object.isMesh === true && object.material.morphTargets === true ) {\r\n\r\n\t\t\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\ttargetNames.push( targetName );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// KeyframeTrack.optimize() will modify given 'times' and 'values'\r\n\t\t\t\t\t\t// buffers before creating a truncated copy to keep. Because buffers may\r\n\t\t\t\t\t\t// be reused by other tracks, make copies here.\r\n\t\t\t\t\t\tfor ( var j = 0, jl = targetNames.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t\ttracks.push( new TypedKeyframeTrack(\r\n\t\t\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\r\n\t\t\t\t\t\t\t\tTHREE.AnimationUtils.arraySlice( inputAccessor.array, 0 ),\r\n\t\t\t\t\t\t\t\tTHREE.AnimationUtils.arraySlice( outputAccessor.array, 0 ),\r\n\t\t\t\t\t\t\t\tinterpolation\r\n\t\t\t\t\t\t\t) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar name = animationDef.name !== undefined ? animationDef.name : 'animation_' + animationIndex;\r\n\r\n\t\t\treturn new THREE.AnimationClip( name, undefined, tracks );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\r\n\t * @param {number} nodeIndex\r\n\t * @return {Promise<THREE.Object3D>}\r\n\t */\r\n\tGLTFParser.prototype.loadNode = function ( nodeIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\tvar meshReferences = this.json.meshReferences;\r\n\t\tvar meshUses = this.json.meshUses;\r\n\r\n\t\tvar nodeDef = this.json.nodes[ nodeIndex ];\r\n\r\n\t\treturn this.getMultiDependencies( [\r\n\r\n\t\t\t'mesh',\r\n\t\t\t'skin',\r\n\t\t\t'camera'\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar node;\r\n\r\n\t\t\tif ( nodeDef.isBone === true ) {\r\n\r\n\t\t\t\tnode = new THREE.Bone();\r\n\r\n\t\t\t} else if ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tvar mesh = dependencies.meshes[ nodeDef.mesh ];\r\n\r\n\t\t\t\tnode = mesh.clone();\r\n\r\n\t\t\t\t// for Specular-Glossiness\r\n\t\t\t\tif ( mesh.isGroup === true ) {\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = mesh.children.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar child = mesh.children[ i ];\r\n\r\n\t\t\t\t\t\tif ( child.material && child.material.isGLTFSpecularGlossinessMaterial === true ) {\r\n\r\n\t\t\t\t\t\t\tnode.children[ i ].onBeforeRender = child.onBeforeRender;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( mesh.material && mesh.material.isGLTFSpecularGlossinessMaterial === true ) {\r\n\r\n\t\t\t\t\t\tnode.onBeforeRender = mesh.onBeforeRender;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( meshReferences[ nodeDef.mesh ] > 1 ) {\r\n\r\n\t\t\t\t\tnode.name += '_instance_' + meshUses[ nodeDef.mesh ] ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( nodeDef.camera !== undefined ) {\r\n\r\n\t\t\t\tnode = dependencies.cameras[ nodeDef.camera ];\r\n\r\n\t\t\t} else if ( nodeDef.extensions\r\n\t\t\t\t\t && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\r\n\t\t\t\t\t && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\r\n\r\n\t\t\t\tvar lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\r\n\t\t\t\tnode = lights[ nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnode = new THREE.Object3D();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.name !== undefined ) {\r\n\r\n\t\t\t\tnode.name = THREE.PropertyBinding.sanitizeNodeName( nodeDef.name );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.extras ) node.userData = nodeDef.extras;\r\n\r\n\t\t\tif ( nodeDef.matrix !== undefined ) {\r\n\r\n\t\t\t\tvar matrix = new THREE.Matrix4();\r\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\r\n\t\t\t\tnode.applyMatrix( matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\r\n\r\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\r\n\t * @param {number} sceneIndex\r\n\t * @return {Promise<THREE.Scene>}\r\n\t */\r\n\tGLTFParser.prototype.loadScene = function () {\r\n\r\n\t\t// scene node hierachy builder\r\n\r\n\t\tfunction buildNodeHierachy( nodeId, parentObject, json, allNodes, skins ) {\r\n\r\n\t\t\tvar node = allNodes[ nodeId ];\r\n\t\t\tvar nodeDef = json.nodes[ nodeId ];\r\n\r\n\t\t\t// build skeleton here as well\r\n\r\n\t\t\tif ( nodeDef.skin !== undefined ) {\r\n\r\n\t\t\t\tvar meshes = node.isGroup === true ? node.children : [ node ];\r\n\r\n\t\t\t\tfor ( var i = 0, il = meshes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar mesh = meshes[ i ];\r\n\t\t\t\t\tvar skinEntry = skins[ nodeDef.skin ];\r\n\r\n\t\t\t\t\tvar bones = [];\r\n\t\t\t\t\tvar boneInverses = [];\r\n\r\n\t\t\t\t\tfor ( var j = 0, jl = skinEntry.joints.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\tvar jointId = skinEntry.joints[ j ];\r\n\t\t\t\t\t\tvar jointNode = allNodes[ jointId ];\r\n\r\n\t\t\t\t\t\tif ( jointNode ) {\r\n\r\n\t\t\t\t\t\t\tbones.push( jointNode );\r\n\r\n\t\t\t\t\t\t\tvar mat = new THREE.Matrix4();\r\n\r\n\t\t\t\t\t\t\tif ( skinEntry.inverseBindMatrices !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tmat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tboneInverses.push( mat );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', jointId );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmesh.bind( new THREE.Skeleton( bones, boneInverses ), mesh.matrixWorld );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// build node hierachy\r\n\r\n\t\t\tparentObject.add( node );\r\n\r\n\t\t\tif ( nodeDef.children ) {\r\n\r\n\t\t\t\tvar children = nodeDef.children;\r\n\r\n\t\t\t\tfor ( var i = 0, il = children.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar child = children[ i ];\r\n\t\t\t\t\tbuildNodeHierachy( child, node, json, allNodes, skins );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn function loadScene( sceneIndex ) {\r\n\r\n\t\t\tvar json = this.json;\r\n\t\t\tvar extensions = this.extensions;\r\n\t\t\tvar sceneDef = this.json.scenes[ sceneIndex ];\r\n\r\n\t\t\treturn this.getMultiDependencies( [\r\n\r\n\t\t\t\t'node',\r\n\t\t\t\t'skin'\r\n\r\n\t\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\t\tvar scene = new THREE.Scene();\r\n\t\t\t\tif ( sceneDef.name !== undefined ) scene.name = sceneDef.name;\r\n\r\n\t\t\t\tif ( sceneDef.extras ) scene.userData = sceneDef.extras;\r\n\r\n\t\t\t\tvar nodeIds = sceneDef.nodes || [];\r\n\r\n\t\t\t\tfor ( var i = 0, il = nodeIds.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tbuildNodeHierachy( nodeIds[ i ], scene, json, dependencies.nodes, dependencies.skins );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Ambient lighting, if present, is always attached to the scene root.\r\n\t\t\t\tif ( sceneDef.extensions\r\n\t\t\t\t\t\t && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\r\n\t\t\t\t\t\t && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\r\n\r\n\t\t\t\t\tvar lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\r\n\t\t\t\t\tscene.add( lights[ sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn scene;\r\n\r\n\t\t\t} );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\treturn GLTFLoader;\r\n\r\n} )();\r\n\r\nexport default GLTFLoader\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./static/js/GLTFLoader.js\n// module id = xkEE\n// module chunks = 1"],"sourceRoot":""}